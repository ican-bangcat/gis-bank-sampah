import"./modulepreload-polyfill-B5Qt9EMX.js";const Pe={ADD:"add",REMOVE:"remove"},cn={PROPERTYCHANGE:"propertychange"},z={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class ur{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function nd(n,e,t){let i,s;t=t||It;let r=0,o=n.length,a=!1;for(;r<o;)i=r+(o-r>>1),s=+t(n[i],e),s<0?r=i+1:(o=i,a=!s);return a?r:~r}function It(n,e){return n>e?1:n<e?-1:0}function sd(n,e){return n<e?1:n>e?-1:0}function na(n,e,t){if(n[0]<=e)return 0;const i=n.length;if(e<=n[i-1])return i-1;if(typeof t=="function"){for(let s=1;s<i;++s){const r=n[s];if(r===e)return s;if(r<e)return t(e,n[s-1],r)>0?s-1:s}return i-1}if(t>0){for(let s=1;s<i;++s)if(n[s]<e)return s-1;return i-1}if(t<0){for(let s=1;s<i;++s)if(n[s]<=e)return s;return i-1}for(let s=1;s<i;++s){if(n[s]==e)return s;if(n[s]<e)return n[s-1]-e<e-n[s]?s-1:s}return i-1}function rd(n,e,t){for(;e<t;){const i=n[e];n[e]=n[t],n[t]=i,++e,--t}}function yt(n,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let s=0;s<i;s++)n[n.length]=t[s]}function ei(n,e){const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function od(n,e,t){const i=e||It;return n.every(function(s,r){if(r===0)return!0;const o=i(n[r-1],s);return!(o>0||o===0)})}function Xn(){return!0}function dr(){return!1}function Yn(){}function ec(n){let e,t,i;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==i||!ei(s,t))&&(i=this,t=s,e=n.apply(this,arguments)),e}}function ad(n){function e(){let t;try{t=n()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function fs(n){for(const e in n)delete n[e]}function bi(n){let e;for(e in n)return!1;return!e}class Mt{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class fr extends ur{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),s=i[e]||(i[e]=[]);s.includes(t)||s.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,s=this.listeners_&&this.listeners_[i];if(!s)return;const r=t?new Mt(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?l=s[h].handleEvent(r):l=s[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,Yn);delete o[i]}return l}disposeInternal(){this.listeners_&&fs(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const s=i.indexOf(t);s!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[s]=Yn,++this.pendingRemovals_[e]):(i.splice(s,1),i.length===0&&delete this.listeners_[e]))}}function H(n,e,t,i,s){if(s){const o=t;t=function(a){return n.removeEventListener(e,t),o.call(i??this,a)}}else i&&i!==n&&(t=t.bind(i));const r={target:n,type:e,listener:t};return n.addEventListener(e,t),r}function Ks(n,e,t,i){return H(n,e,t,i,!0)}function se(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),fs(n))}class gs extends fr{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(z.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=H(this,e[r],t);return s}return H(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const s=e.length;i=new Array(s);for(let r=0;r<s;++r)i[r]=Ks(this,e[r],t)}else i=Ks(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)ld(i);else if(Array.isArray(e))for(let s=0,r=e.length;s<r;++s)this.removeEventListener(e[s],t);else this.removeEventListener(e,t)}}gs.prototype.on;gs.prototype.once;gs.prototype.un;function ld(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)se(n[e]);else se(n)}function $(){throw new Error("Unimplemented abstract method.")}let hd=0;function Z(n){return n.ol_uid||(n.ol_uid=String(++hd))}class fl extends Mt{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class ct extends gs{constructor(e){super(),this.on,this.once,this.un,Z(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new fl(i,e,t)),i=cn.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new fl(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const s=this.values_||(this.values_={});if(i)s[e]=t;else{const r=s[e];s[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],bi(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const gl={LENGTH:"length"};class Ts extends Mt{constructor(e,t,i){super(e),this.element=t,this.index=i}}class mt extends ct{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,s=this.array_.length;i<s;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,s=t.length;i<s;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(gl.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Ts(Pe.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,s=t.length;i<s;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Ts(Pe.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const s=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Ts(Pe.REMOVE,s,e)),this.dispatchEvent(new Ts(Pe.ADD,t,e))}updateLength_(){this.set(gl.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,s=this.array_.length;i<s;++i)if(this.array_[i]===e&&i!==t)throw new Error("Duplicate item added to a unique collection")}}function Q(n,e){if(!n)throw new Error(e)}class vn extends ct{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new vn(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(se(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=H(e,z.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?cd(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function cd(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(Q(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}const pe={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function _l(n){const e=Qe();for(let t=0,i=n.length;t<i;++t)zn(e,n[t]);return e}function sa(n,e,t){return t?(t[0]=n[0]-e,t[1]=n[1]-e,t[2]=n[2]+e,t[3]=n[3]+e,t):[n[0]-e,n[1]-e,n[2]+e,n[3]+e]}function tc(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function Ri(n,e,t){let i,s;return e<n[0]?i=n[0]-e:n[2]<e?i=e-n[2]:i=0,t<n[1]?s=n[1]-t:n[3]<t?s=t-n[3]:s=0,i*i+s*s}function un(n,e){return ra(n,e[0],e[1])}function tn(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function ra(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function Co(n,e){const t=n[0],i=n[1],s=n[2],r=n[3],o=e[0],a=e[1];let l=pe.UNKNOWN;return o<t?l=l|pe.LEFT:o>s&&(l=l|pe.RIGHT),a<i?l=l|pe.BELOW:a>r&&(l=l|pe.ABOVE),l===pe.UNKNOWN&&(l=pe.INTERSECTING),l}function Qe(){return[1/0,1/0,-1/0,-1/0]}function kt(n,e,t,i,s){return s?(s[0]=n,s[1]=e,s[2]=t,s[3]=i,s):[n,e,t,i]}function _s(n){return kt(1/0,1/0,-1/0,-1/0,n)}function ic(n,e){const t=n[0],i=n[1];return kt(t,i,t,i,e)}function oa(n,e,t,i,s){const r=_s(s);return sc(r,n,e,t,i)}function qn(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function nc(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function zn(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function sc(n,e,t,i,s){for(;t<i;t+=s)ud(n,e[t],e[t+1]);return n}function ud(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function aa(n,e){let t;return t=e(gr(n)),t||(t=e(_r(n)),t)||(t=e(mr(n)),t)||(t=e(Ti(n)),t)?t:!1}function Ro(n){let e=0;return pr(n)||(e=te(n)*ke(n)),e}function gr(n){return[n[0],n[1]]}function _r(n){return[n[2],n[1]]}function Jt(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function dd(n,e){let t;if(e==="bottom-left")t=gr(n);else if(e==="bottom-right")t=_r(n);else if(e==="top-left")t=Ti(n);else if(e==="top-right")t=mr(n);else throw new Error("Invalid corner");return t}function To(n,e,t,i,s){const[r,o,a,l,h,c,u,d]=rc(n,e,t,i);return kt(Math.min(r,a,h,u),Math.min(o,l,c,d),Math.max(r,a,h,u),Math.max(o,l,c,d),s)}function rc(n,e,t,i){const s=e*i[0]/2,r=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),l=s*o,h=s*a,c=r*o,u=r*a,d=n[0],f=n[1];return[d-l+u,f-h-c,d-l-u,f-h+c,d+l-u,f+h+c,d+l+u,f+h-c,d-l+u,f-h-c]}function ke(n){return n[3]-n[1]}function vi(n,e,t){const i=t||Qe();return Oe(n,e)?(n[0]>e[0]?i[0]=n[0]:i[0]=e[0],n[1]>e[1]?i[1]=n[1]:i[1]=e[1],n[2]<e[2]?i[2]=n[2]:i[2]=e[2],n[3]<e[3]?i[3]=n[3]:i[3]=e[3]):_s(i),i}function Ti(n){return[n[0],n[3]]}function mr(n){return[n[2],n[3]]}function te(n){return n[2]-n[0]}function Oe(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function pr(n){return n[2]<n[0]||n[3]<n[1]}function fd(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function gd(n,e,t){let i=!1;const s=Co(n,e),r=Co(n,t);if(s===pe.INTERSECTING||r===pe.INTERSECTING)i=!0;else{const o=n[0],a=n[1],l=n[2],h=n[3],c=e[0],u=e[1],d=t[0],f=t[1],g=(f-u)/(d-c);let _,m;r&pe.ABOVE&&!(s&pe.ABOVE)&&(_=d-(f-h)/g,i=_>=o&&_<=l),!i&&r&pe.RIGHT&&!(s&pe.RIGHT)&&(m=f-(d-l)*g,i=m>=a&&m<=h),!i&&r&pe.BELOW&&!(s&pe.BELOW)&&(_=d-(f-a)/g,i=_>=o&&_<=l),!i&&r&pe.LEFT&&!(s&pe.LEFT)&&(m=f-(d-o)*g,i=m>=a&&m<=h)}return i}function oc(n,e){const t=e.getExtent(),i=Jt(n);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const s=te(t),o=Math.floor((i[0]-t[0])/s)*s;n[0]-=o,n[2]-=o}return n}function ac(n,e,t){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];oc(n,e);const s=te(i);if(te(n)>s&&!t)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+s,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-s,n[3]]]}return[n]}function oe(n,e,t){return Math.min(Math.max(n,e),t)}function _d(n,e,t,i,s,r){const o=s-t,a=r-i;if(o!==0||a!==0){const l=((n-t)*o+(e-i)*a)/(o*o+a*a);l>1?(t=s,i=r):l>0&&(t+=o*l,i+=a*l)}return Ei(n,e,t,i)}function Ei(n,e,t,i){const s=t-n,r=i-e;return s*s+r*r}function md(n){const e=n.length;for(let i=0;i<e;i++){let s=i,r=Math.abs(n[i][i]);for(let a=i+1;a<e;a++){const l=Math.abs(n[a][i]);l>r&&(r=l,s=a)}if(r===0)return null;const o=n[s];n[s]=n[i],n[i]=o;for(let a=i+1;a<e;a++){const l=-n[a][i]/n[i][i];for(let h=i;h<e+1;h++)i==h?n[a][h]=0:n[a][h]+=l*n[i][h]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=n[i][e]/n[i][i];for(let s=i-1;s>=0;s--)n[s][e]-=n[s][i]*t[i]}return t}function ml(n){return n*180/Math.PI}function Ht(n){return n*Math.PI/180}function rn(n,e){const t=n%e;return t*e<0?t+e:t}function Ue(n,e,t){return n+t*(e-n)}function yr(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function Is(n,e){return Math.floor(yr(n,e))}function As(n,e){return Math.ceil(yr(n,e))}function Io(n,e,t){if(n>=e&&n<t)return n;const i=t-e;return((n-e)%i+i)%i+e}const pd=63710088e-1;function pl(n,e,t){t=t||pd;const i=Ht(n[1]),s=Ht(e[1]),r=(s-i)/2,o=Ht(e[0]-n[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(s);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function lc(...n){console.warn(...n)}function yd(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function Vs(n,e){let t=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=e[i]){t=!1;break}return t}function la(n,e){const t=Math.cos(e),i=Math.sin(e),s=n[0]*t-n[1]*i,r=n[1]*t+n[0]*i;return n[0]=s,n[1]=r,n}function wd(n,e){return n[0]*=e,n[1]*=e,n}function hc(n,e){if(e.canWrapX()){const t=te(e.getExtent()),i=vd(n,e,t);i&&(n[0]-=i*t)}return n}function vd(n,e,t){const i=e.getExtent();let s=0;return e.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(t=t||te(i),s=Math.floor((n[0]-i[0])/t)),s}const ha={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class ca{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ha[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const ms=6378137,nn=Math.PI*ms,Ed=[-nn,-nn,nn,nn],bd=[-180,-85,180,85],Os=ms*Math.log(Math.tan(Math.PI/2));class Di extends ca{constructor(e){super({code:e,units:"m",extent:Ed,global:!0,worldExtent:bd,getPointResolution:function(t,i){return t/Math.cosh(i[1]/ms)}})}}const yl=[new Di("EPSG:3857"),new Di("EPSG:102100"),new Di("EPSG:102113"),new Di("EPSG:900913"),new Di("http://www.opengis.net/def/crs/EPSG/0/3857"),new Di("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Sd(n,e,t,i){const s=n.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=n.slice():e=new Array(s));for(let r=0;r<s;r+=i){e[r]=nn*n[r]/180;let o=ms*Math.log(Math.tan(Math.PI*(+n[r+1]+90)/360));o>Os?o=Os:o<-Os&&(o=-Os),e[r+1]=o}return e}function xd(n,e,t,i){const s=n.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=n.slice():e=new Array(s));for(let r=0;r<s;r+=i)e[r]=180*n[r]/nn,e[r+1]=360*Math.atan(Math.exp(n[r+1]/ms))/Math.PI-90;return e}const Cd=6378137,wl=[-180,-90,180,90],Rd=Math.PI*Cd/180;class ri extends ca{constructor(e,t){super({code:e,units:"degrees",extent:wl,axisOrientation:t,global:!0,metersPerUnit:Rd,worldExtent:wl})}}const vl=[new ri("CRS:84"),new ri("EPSG:4326","neu"),new ri("urn:ogc:def:crs:OGC:1.3:CRS84"),new ri("urn:ogc:def:crs:OGC:2:84"),new ri("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ri("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ri("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ao={};function Td(n){return Ao[n]||Ao[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Id(n,e){Ao[n]=e}let on={};function Hn(n,e,t){const i=n.getCode(),s=e.getCode();i in on||(on[i]={}),on[i][s]=t}function zr(n,e){return n in on&&e in on[n]?on[n][e]:null}const Xs=.9996,Je=.00669438,wr=Je*Je,vr=wr*Je,_i=Je/(1-Je),El=Math.sqrt(1-Je),dn=(1-El)/(1+El),cc=dn*dn,ua=cc*dn,da=ua*dn,uc=da*dn,dc=1-Je/4-3*wr/64-5*vr/256,Ad=3*Je/8+3*wr/32+45*vr/1024,Od=15*wr/256+45*vr/1024,kd=35*vr/3072,Pd=3/2*dn-27/32*ua+269/512*uc,Ld=21/16*cc-55/32*da,Md=151/96*ua-417/128*uc,Dd=1097/512*da,Ys=6378137;function Fd(n,e,t){const i=n-5e5,o=(t.north?e:e-1e7)/Xs/(Ys*dc),a=o+Pd*Math.sin(2*o)+Ld*Math.sin(4*o)+Md*Math.sin(6*o)+Dd*Math.sin(8*o),l=Math.sin(a),h=l*l,c=Math.cos(a),u=l/c,d=u*u,f=d*d,g=1-Je*h,_=Math.sqrt(1-Je*h),m=Ys/_,p=(1-Je)/g,y=_i*c**2,v=y*y,w=i/(m*Xs),E=w*w,b=E*w,x=b*w,C=x*w,R=C*w,I=a-u/p*(E/2-x/24*(5+3*d+10*y-4*v-9*_i))+R/720*(61+90*d+298*y+45*f-252*_i-3*v);let G=(w-b/6*(1+2*d+y)+C/120*(5-2*y+28*d-3*v+8*_i+24*f))/c;return G=Io(G+Ht(fc(t.number)),-Math.PI,Math.PI),[ml(G),ml(I)]}const bl=-80,Sl=84,Nd=-180,jd=180;function Gd(n,e,t){n=Io(n,Nd,jd),e<bl?e=bl:e>Sl&&(e=Sl);const i=Ht(e),s=Math.sin(i),r=Math.cos(i),o=s/r,a=o*o,l=a*a,h=Ht(n),c=fc(t.number),u=Ht(c),d=Ys/Math.sqrt(1-Je*s**2),f=_i*r**2,g=r*Io(h-u,-Math.PI,Math.PI),_=g*g,m=_*g,p=m*g,y=p*g,v=y*g,w=Ys*(dc*i-Ad*Math.sin(2*i)+Od*Math.sin(4*i)-kd*Math.sin(6*i)),E=Xs*d*(g+m/6*(1-a+f)+y/120*(5-18*a+l+72*f-58*_i))+5e5;let b=Xs*(w+d*o*(_/2+p/24*(5-a+9*f+4*f**2)+v/720*(61-58*a+l+600*f-330*_i)));return t.north||(b+=1e7),[E,b]}function fc(n){return(n-1)*6-180+3}const Ud=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function gc(n){let e=0;for(const s of Ud){const r=n.match(s);if(r){e=parseInt(r[1]);break}}if(!e)return null;let t=0,i=!1;return e>32700&&e<32761?t=e-32700:e>32600&&e<32661&&(i=!0,t=e-32600),t?{number:t,north:i}:null}function xl(n,e){return function(t,i,s,r){const o=t.length;s=s>1?s:2,r=r??s,i||(s>2?i=t.slice():i=new Array(o));for(let a=0;a<o;a+=r){const l=t[a],h=t[a+1],c=n(l,h,e);i[a]=c[0],i[a+1]=c[1]}return i}}function $d(n){return gc(n)?new ca({code:n,units:"m"}):null}function Bd(n){const e=gc(n.getCode());return e?{forward:xl(Gd,e),inverse:xl(Fd,e)}:null}const zd=[Bd],Wd=[$d];let Oo=!0;function _c(n){Oo=!1}function fa(n,e){if(e!==void 0){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];e=e}else e=n.slice();return e}function ko(n){Id(n.getCode(),n),Hn(n,n,fa)}function Kd(n){n.forEach(ko)}function ce(n){if(typeof n!="string")return n;const e=Td(n);if(e)return e;for(const t of Wd){const i=t(n);if(i)return i}return null}function Cl(n,e,t,i){n=ce(n);let s;const r=n.getPointResolutionFunc();if(r)s=r(e,t);else{const o=n.getUnits();if(o=="degrees"&&!i||i=="degrees")s=e;else{const a=_a(n,ce("EPSG:4326"));if(!a&&o!=="degrees")s=e*n.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=pl(h.slice(0,2),h.slice(2,4)),u=pl(h.slice(4,6),h.slice(6,8));s=(c+u)/2}const l=n.getMetersPerUnit();l!==void 0&&(s/=l)}}return s}function Rl(n){Kd(n),n.forEach(function(e){n.forEach(function(t){e!==t&&Hn(e,t,fa)})})}function Vd(n,e,t,i){n.forEach(function(s){e.forEach(function(r){Hn(s,r,t),Hn(r,s,i)})})}function ga(n,e){return n?typeof n=="string"?ce(n):n:ce(e)}function Xd(n){return function(e,t,i,s){const r=e.length;i=i!==void 0?i:2,s=s??i,t=t!==void 0?t:new Array(r);for(let o=0;o<r;o+=s){const a=n(e.slice(o,o+i)),l=a.length;for(let h=0,c=s;h<c;++h)t[o+h]=h>=l?e[o+h]:a[h]}return t}}function fn(n,e){return _c(),ma(n,"EPSG:4326","EPSG:3857")}function Ws(n,e){if(n===e)return!0;const t=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||_a(n,e)===fa)&&t}function _a(n,e){const t=n.getCode(),i=e.getCode();let s=zr(t,i);if(s)return s;let r=null,o=null;for(const l of zd)r||(r=l(n)),o||(o=l(e));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)s=Wr(r.inverse,o.forward);else{const l=zr(t,a);l&&(s=Wr(l,o.forward))}else{const l=zr(a,i);l&&(s=Wr(r.inverse,l))}return s&&(ko(n),ko(e),Hn(n,e,s)),s}function Wr(n,e){return function(t,i,s,r){return i=n(t,i,s,r),e(i,i,s,r)}}function Zn(n,e){const t=ce(n),i=ce(e);return _a(t,i)}function ma(n,e,t){const i=Zn(e,t);if(!i){const s=ce(e).getCode(),r=ce(t).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return i(n,void 0,n.length)}function Po(n,e){return n}function xt(n,e){return Oo&&!Vs(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(Oo=!1,lc("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function mc(n,e){return n}function Xt(n,e){return n}function Yd(){Rl(yl),Rl(vl),Vd(vl,yl,Sd,xd)}Yd();new Array(6);function ot(){return[1,0,0,1,0,0]}function qd(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function ye(n,e){const t=e[0],i=e[1];return e[0]=n[0]*t+n[2]*i+n[4],e[1]=n[1]*t+n[3]*i+n[5],e}function Pt(n,e,t,i,s,r,o,a){const l=Math.sin(r),h=Math.cos(r);return n[0]=i*h,n[1]=s*l,n[2]=-i*l,n[3]=s*h,n[4]=o*i*h-a*i*l+e,n[5]=o*s*l+a*s*h+t,n}function pc(n,e){const t=Hd(e);Q(t!==0,"Transformation matrix cannot be inverted");const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5];return n[0]=o/t,n[1]=-s/t,n[2]=-r/t,n[3]=i/t,n[4]=(r*l-o*a)/t,n[5]=-(i*l-s*a)/t,n}function Hd(n){return n[0]*n[3]-n[1]*n[2]}const Zd=[1e5,1e5,1e5,1e5,2,2];function Jd(n){return"matrix("+n.join(", ")+")"}function Tl(n){return n.substring(7,n.length-1).split(",").map(parseFloat)}function Qd(n,e){const t=Tl(n),i=Tl(e);for(let s=0;s<6;++s)if(Math.round((t[s]-i[s])*Zd[s])!==0)return!1;return!0}function Zt(n,e,t,i,s,r,o){r=r||[],o=o||2;let a=0;for(let l=e;l<t;l+=i){const h=n[l],c=n[l+1];r[a++]=s[0]*h+s[2]*c+s[4],r[a++]=s[1]*h+s[3]*c+s[5];for(let u=2;u<o;u++)r[a++]=n[l+u]}return r&&r.length!=a&&(r.length=a),r}function pa(n,e,t,i,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),h=r[0],c=r[1];let u=0;for(let d=e;d<t;d+=i){const f=n[d]-h,g=n[d+1]-c;o[u++]=h+f*a-g*l,o[u++]=c+f*l+g*a;for(let _=d+2;_<d+i;++_)o[u++]=n[_]}return o&&o.length!=u&&(o.length=u),o}function ef(n,e,t,i,s,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=i){const d=n[u]-l,f=n[u+1]-h;a[c++]=l+s*d,a[c++]=h+r*f;for(let g=u+2;g<u+i;++g)a[c++]=n[g]}return a&&a.length!=c&&(a.length=c),a}function tf(n,e,t,i,s,r,o){o=o||[];let a=0;for(let l=e;l<t;l+=i){o[a++]=n[l]+s,o[a++]=n[l+1]+r;for(let h=l+2;h<l+i;++h)o[a++]=n[h]}return o&&o.length!=a&&(o.length=a),o}const Il=ot(),nf=[NaN,NaN];class yc extends ct{constructor(){super(),this.extent_=Qe(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=ec((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const s=this.clone();return s.applyTransform(i),s.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return $()}closestPointXY(e,t,i,s){return $()}containsXY(e,t){return this.closestPointXY(e,t,nf,Number.MIN_VALUE)===0}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return $()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&_s(t),this.extentRevision_=this.getRevision()}return fd(this.extent_,e)}rotate(e,t){$()}scale(e,t,i){$()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return $()}getType(){return $()}applyTransform(e){$()}intersectsExtent(e){return $()}translate(e,t){$()}transform(e,t){const i=ce(e),s=i.getUnits()=="tile-pixels"?function(r,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=ke(h)/ke(l);Pt(Il,h[0],h[3],c,-c,0,0,0);const u=Zt(r,0,r.length,a,Il,o),d=Zn(i,t);return d?d(u,u,a):u}:Zn(i,t);return this.applyTransform(s),this}}class ti extends yc{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return oa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return $()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Al(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){$()}setLayout(e,t,i){let s;if(e)s=Al(e);else{for(let r=0;r<i;++r){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}s=t.length,e=Ii(s)}this.layout=e,this.stride=s}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const s=this.getStride();pa(i,0,i.length,s,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=Jt(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();ef(s,0,s.length,r,e,t,i,s),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const s=this.getStride();tf(i,0,i.length,s,e,t,i),this.changed()}}}function Ii(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function Al(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function sf(n,e,t){const i=n.getFlatCoordinates();if(!i)return null;const s=n.getStride();return Zt(i,0,i.length,s,e,t)}function wc(n,e,t,i){let s=0;const r=n[t-i],o=n[t-i+1];let a=0,l=0;for(;e<t;e+=i){const h=n[e]-r,c=n[e+1]-o;s+=l*h-a*c,a=h,l=c}return s/2}function vc(n,e,t,i){let s=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];s+=wc(n,e,a,i),e=a}return s}function rf(n,e,t,i){let s=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];s+=vc(n,e,a,i),e=a[a.length-1]}return s}function Ol(n,e,t,i,s,r,o){const a=n[e],l=n[e+1],h=n[t]-a,c=n[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((s-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let f=0;f<i;++f)o[f]=Ue(n[e+f],n[t+f],d);o.length=i;return}else u=e}for(let d=0;d<i;++d)o[d]=n[u+d];o.length=i}function ya(n,e,t,i,s){let r=n[e],o=n[e+1];for(e+=i;e<t;e+=i){const a=n[e],l=n[e+1],h=Ei(r,o,a,l);h>s&&(s=h),r=a,o=l}return s}function wa(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];s=ya(n,e,a,i,s),e=a}return s}function of(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];s=wa(n,e,a,i,s),e=a[a.length-1]}return s}function va(n,e,t,i,s,r,o,a,l,h,c){if(e==t)return h;let u,d;if(s===0){if(d=Ei(o,a,n[e],n[e+1]),d<h){for(u=0;u<i;++u)l[u]=n[e+u];return l.length=i,d}return h}c=c||[NaN,NaN];let f=e+i;for(;f<t;)if(Ol(n,f-i,f,i,o,a,c),d=Ei(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i,f+=i}else f+=i*Math.max((Math.sqrt(d)-Math.sqrt(h))/s|0,1);if(r&&(Ol(n,t-i,e,i,o,a,c),d=Ei(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<i;++u)l[u]=c[u];l.length=i}return h}function Ea(n,e,t,i,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=va(n,e,f,i,s,r,o,a,l,h,c),e=f}return h}function af(n,e,t,i,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=Ea(n,e,f,i,s,r,o,a,l,h,c),e=f[f.length-1]}return h}function Ec(n,e,t,i){for(let s=0,r=t.length;s<r;++s)n[e++]=t[s];return e}function Er(n,e,t,i){for(let s=0,r=t.length;s<r;++s){const o=t[s];for(let a=0;a<i;++a)n[e++]=o[a]}return e}function ps(n,e,t,i,s){s=s||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=Er(n,e,t[o],i);s[r++]=l,e=l}return s.length=r,s}function bc(n,e,t,i,s){s=s||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=ps(n,e,t[o],i,s[r]);l.length===0&&(l[0]=e),s[r++]=l,e=l[l.length-1]}return s.length=r,s}function Yt(n,e,t,i,s){s=s!==void 0?s:[];let r=0;for(let o=e;o<t;o+=i)s[r++]=n.slice(o,o+i);return s.length=r,s}function Jn(n,e,t,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];s[r++]=Yt(n,e,l,i,s[r]),e=l}return s.length=r,s}function Lo(n,e,t,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];s[r++]=l.length===1&&l[0]===e?[]:Jn(n,e,l,i,s[r]),e=l[l.length-1]}return s.length=r,s}function br(n,e,t,i,s,r,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)r[o++]=n[e],r[o++]=n[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-i];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const g=n[d],_=n[d+1],m=n[u],p=n[u+1];for(let y=d+i;y<u;y+=i){const v=n[y],w=n[y+1],E=_d(v,w,g,_,m,p);E>f&&(c=y,f=E)}f>s&&(l[(c-e)/i]=1,d+i<c&&h.push(d,c),c+i<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=n[e+u*i],r[o++]=n[e+u*i+1]);return o}function Sc(n,e,t,i,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=br(n,e,c,i,s,r,o),a.push(o),e=c}return o}function hi(n,e){return e*Math.round(n/e)}function lf(n,e,t,i,s,r,o){if(e==t)return o;let a=hi(n[e],s),l=hi(n[e+1],s);e+=i,r[o++]=a,r[o++]=l;let h,c;do if(h=hi(n[e],s),c=hi(n[e+1],s),e+=i,e==t)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=hi(n[e],s),d=hi(n[e+1],s);if(e+=i,u==h&&d==c)continue;const f=h-a,g=c-l,_=u-a,m=d-l;if(f*m==g*_&&(f<0&&_<f||f==_||f>0&&_>f)&&(g<0&&m<g||g==m||g>0&&m>g)){h=u,c=d;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=d}return r[o++]=h,r[o++]=c,o}function ba(n,e,t,i,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=lf(n,e,c,i,s,r,o),a.push(o),e=c}return o}function hf(n,e,t,i,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l],u=[];o=ba(n,e,c,i,s,r,o,u),a.push(u),e=c[c.length-1]}return o}class Qn extends ti{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Qn(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,s){return s<Ri(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ya(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),va(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,s))}getArea(){return wc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Yt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=br(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Qn(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Er(this.flatCoordinates,0,e,this.stride),this.changed()}}class Si extends ti{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Si(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const r=this.flatCoordinates,o=Ei(e,t,r[0],r[1]);if(o<s){const a=this.stride;for(let l=0;l<a;++l)i[l]=r[l];return i.length=a,o}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return ic(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return ra(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ec(this.flatCoordinates,0,e,this.stride),this.changed()}}function cf(n,e,t,i,s){return!aa(s,function(o){return!mi(n,e,t,i,o[0],o[1])})}function mi(n,e,t,i,s,r){let o=0,a=n[t-i],l=n[t-i+1];for(;e<t;e+=i){const h=n[e],c=n[e+1];l<=r?c>r&&(h-a)*(r-l)-(s-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(s-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Sa(n,e,t,i,s,r){if(t.length===0||!mi(n,e,t[0],i,s,r))return!1;for(let o=1,a=t.length;o<a;++o)if(mi(n,t[o-1],t[o],i,s,r))return!1;return!0}function uf(n,e,t,i,s,r){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(Sa(n,e,l,i,s,r))return!0;e=l[l.length-1]}return!1}function xa(n,e,t,i,s,r,o){let a,l,h,c,u,d,f;const g=s[r+1],_=[];for(let y=0,v=t.length;y<v;++y){const w=t[y];for(c=n[w-i],d=n[w-i+1],a=e;a<w;a+=i)u=n[a],f=n[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(u-c)+c,_.push(h)),c=u,d=f}let m=NaN,p=-1/0;for(_.sort(It),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const y=Math.abs(u-c);y>p&&(h=(c+u)/2,Sa(n,e,t,i,h,g)&&(m=h,p=y)),c=u}return isNaN(m)&&(m=s[r]),o?(o.push(m,g,p),o):[m,g,p]}function xc(n,e,t,i,s){let r=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];r=xa(n,e,l,i,s,2*o,r),e=l[l.length-1]}return r}function Cc(n,e,t,i,s){let r;for(e+=i;e<t;e+=i)if(r=s(n.slice(e-i,e),n.slice(e,e+i)),r)return r;return!1}function Sr(n,e,t,i,s,r){return r=r??sc(Qe(),n,e,t,i),Oe(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:Cc(n,e,t,i,function(o,a){return gd(s,o,a)}):!1}function df(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){if(Sr(n,e,t[r],i,s))return!0;e=t[r]}return!1}function Rc(n,e,t,i,s){return!!(Sr(n,e,t,i,s)||mi(n,e,t,i,s[0],s[1])||mi(n,e,t,i,s[0],s[3])||mi(n,e,t,i,s[2],s[1])||mi(n,e,t,i,s[2],s[3]))}function Tc(n,e,t,i,s){if(!Rc(n,e,t[0],i,s))return!1;if(t.length===1)return!0;for(let r=1,o=t.length;r<o;++r)if(cf(n,t[r-1],t[r],i,s)&&!Sr(n,t[r-1],t[r],i,s))return!1;return!0}function ff(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(Tc(n,e,a,i,s))return!0;e=a[a.length-1]}return!1}function gf(n,e,t,i){for(;e<t-i;){for(let s=0;s<i;++s){const r=n[e+s];n[e+s]=n[t-i+s],n[t-i+s]=r}e+=i,t-=i}}function Ca(n,e,t,i){let s=0,r=n[t-i],o=n[t-i+1];for(;e<t;e+=i){const a=n[e],l=n[e+1];s+=(a-r)*(l+o),r=a,o=l}return s===0?void 0:s>0}function Ra(n,e,t,i,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=Ca(n,e,a,i);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;e=a}return!0}function Ic(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(!Ra(n,e,a,i,s))return!1;a.length&&(e=a[a.length-1])}return!0}function qs(n,e,t,i,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=Ca(n,e,a,i);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&gf(n,e,a,i),e=a}return e}function Mo(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r)e=qs(n,e,t[r],i,s);return e}function _f(n,e){const t=[];let i=0,s=0,r;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=Ca(n,i,l,2);if(r===void 0&&(r=h),h===r)t.push(e.slice(s,o+1));else{if(t.length===0)continue;t[t.length-1].push(e[s])}s=o+1,i=l}return t}class Qt extends ti{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?yt(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Qt(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<Ri(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(wa(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ea(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,s))}containsXY(e,t){return Sa(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return vc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),qs(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Jn(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Jt(this.getExtent());this.flatInteriorPoint_=xa(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Si(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Qn(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new Qn(t.slice(r,l),e);s.push(h),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Ra(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=qs(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=ba(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new Qt(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return Tc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ps(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function kl(n){if(pr(n))throw new Error("Cannot create polygon from empty extent");const e=n[0],t=n[1],i=n[2],s=n[3],r=[e,t,e,s,i,s,i,t,e,t];return new Qt(r,"XY",[r.length])}function Hs(n,e,t,i,s,r,o){let a,l;const h=(t-e)/i;if(h===1)a=e;else if(h===2)a=e,l=s;else if(h!==0){let c=n[e],u=n[e+1],d=0;const f=[0];for(let m=e+i;m<t;m+=i){const p=n[m],y=n[m+1];d+=Math.sqrt((p-c)*(p-c)+(y-u)*(y-u)),f.push(d),c=p,u=y}const g=s*d,_=nd(f,g);_<0?(l=(g-f[-_-2])/(f[-_-1]-f[-_-2]),a=e+(-_-2)*i):a=e+_*i}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?n[a+c]:Ue(n[a+c],n[a+i+c],l);return r}function Do(n,e,t,i,s,r){if(t==e)return null;let o;if(s<n[e+i-1])return r?(o=n.slice(e,e+i),o[i-1]=s,o):null;if(n[t-1]<s)return r?(o=n.slice(t-i,t),o[i-1]=s,o):null;if(s==n[e+i-1])return n.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const d=a+l>>1;s<n[(d+1)*i-1]?l=d:a=d+1}const h=n[a*i-1];if(s==h)return n.slice((a-1)*i,(a-1)*i+i);const c=n[(a+1)*i-1],u=(s-h)/(c-h);o=[];for(let d=0;d<i-1;++d)o.push(Ue(n[(a-1)*i+d],n[a*i+d],u));return o.push(s),o}function mf(n,e,t,i,s,r,o){if(o)return Do(n,e,t[t.length-1],i,s,r);let a;if(s<n[i-1])return r?(a=n.slice(0,i),a[i-1]=s,a):null;if(n[n.length-1]<s)return r?(a=n.slice(n.length-i),a[i-1]=s,a):null;for(let l=0,h=t.length;l<h;++l){const c=t[l];if(e!=c){if(s<n[e+i-1])return null;if(s<=n[c-1])return Do(n,e,c,i,s,!1);e=c}}return null}function Ta(n,e,t,i){let s=n[e],r=n[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=n[a],h=n[a+1];o+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return o}class gn extends ti{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){yt(this.flatCoordinates,e),this.changed()}clone(){const e=new gn(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<Ri(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ya(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),va(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,s))}forEachSegment(e){return Cc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,Do(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return Yt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return Hs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return Ta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=br(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new gn(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Sr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Er(this.flatCoordinates,0,e,this.stride),this.changed()}}const He={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},xi=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",pf=xi.includes("safari")&&!xi.includes("chrom");pf&&(xi.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(xi));const yf=xi.includes("webkit")&&!xi.includes("edge"),Ac=xi.includes("macintosh"),wf=typeof devicePixelRatio<"u"?devicePixelRatio:1,Ia=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Oc=typeof Image<"u"&&Image.prototype.decode,kc=function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n}(),K={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function _e(n,e,t,i){let s;return t&&t.length?s=t.shift():Ia?s=new OffscreenCanvas(n||300,e||300):s=document.createElement("canvas"),n&&(s.width=n),e&&(s.height=e),s.getContext("2d",i)}let Kr;function Zs(){return Kr||(Kr=_e(1,1)),Kr}function xr(n){const e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function vf(n){let e=n.offsetWidth;const t=getComputedStyle(n);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function Ef(n){let e=n.offsetHeight;const t=getComputedStyle(n);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function Pl(n,e){const t=e.parentNode;t&&t.replaceChild(n,e)}function Pc(n){for(;n.lastChild;)n.lastChild.remove()}function bf(n,e){const t=n.childNodes;for(let i=0;;++i){const s=t[i],r=e[i];if(!s&&!r)break;if(s!==r){if(!s){n.appendChild(r);continue}if(!r){n.removeChild(s),--i;continue}n.insertBefore(r,s)}}}const Aa=[NaN,NaN,NaN,0];let Vr;function Sf(){return Vr||(Vr=_e(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),Vr}const xf=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Cf=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Rf=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Tf=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function ks(n,e){return n.endsWith("%")?Number(n.substring(0,n.length-1))/e:Number(n)}function Wn(n){throw new Error('failed to parse "'+n+'" as color')}function Lc(n){if(n.toLowerCase().startsWith("rgb")){const r=n.match(Cf)||n.match(xf)||n.match(Rf);if(r){const o=r[4],a=100/255;return[oe(ks(r[1],a)+.5|0,0,255),oe(ks(r[2],a)+.5|0,0,255),oe(ks(r[3],a)+.5|0,0,255),o!==void 0?oe(ks(o,100),0,1):1]}Wn(n)}if(n.startsWith("#")){if(Tf.test(n)){const r=n.substring(1),o=r.length<=4?1:2,a=[0,0,0,255];for(let l=0,h=r.length;l<h;l+=o){let c=parseInt(r.substring(l,l+o),16);o===1&&(c+=c<<4),a[l/o]=c}return a[3]=a[3]/255,a}Wn(n)}const e=Sf();e.fillStyle="#abcdef";let t=e.fillStyle;e.fillStyle=n,e.fillStyle===t&&(e.fillStyle="#fedcba",t=e.fillStyle,e.fillStyle=n,e.fillStyle===t&&Wn(n));const i=e.fillStyle;if(i.startsWith("#")||i.startsWith("rgba"))return Lc(i);e.clearRect(0,0,1,1),e.fillRect(0,0,1,1);const s=Array.from(e.getImageData(0,0,1,1).data);return s[3]=yr(s[3]/255,3),s}function If(n){return typeof n=="string"?n:ka(n)}const Af=1024,kn={};let Xr=0;function Of(n){if(n.length===4)return n;const e=n.slice();return e[3]=1,e}function Yr(n){return n>.0031308?Math.pow(n,1/2.4)*269.025-14.025:n*3294.6}function qr(n){return n>.2068965?Math.pow(n,3):(n-4/29)*(108/841)}function Hr(n){return n>10.314724?Math.pow((n+14.025)/269.025,2.4):n/3294.6}function Zr(n){return n>.0088564?Math.pow(n,1/3):n/(108/841)+4/29}function Ll(n){const e=Hr(n[0]),t=Hr(n[1]),i=Hr(n[2]),s=Zr(e*.222488403+t*.716873169+i*.06060791),r=500*(Zr(e*.452247074+t*.399439023+i*.148375274)-s),o=200*(s-Zr(e*.016863605+t*.117638439+i*.865350722)),a=Math.atan2(o,r)*(180/Math.PI);return[116*s-16,Math.sqrt(r*r+o*o),a<0?a+360:a,n[3]]}function kf(n){const e=(n[0]+16)/116,t=n[1],i=n[2]*Math.PI/180,s=qr(e),r=qr(e+t/500*Math.cos(i)),o=qr(e-t/200*Math.sin(i)),a=Yr(r*3.021973625-s*1.617392459-o*.404875592),l=Yr(r*-.943766287+s*1.916279586+o*.027607165),h=Yr(r*.069407491-s*.22898585+o*1.159737864);return[oe(a+.5|0,0,255),oe(l+.5|0,0,255),oe(h+.5|0,0,255),n[3]]}function Oa(n){if(n==="none")return Aa;if(kn.hasOwnProperty(n))return kn[n];if(Xr>=Af){let t=0;for(const i in kn)(t++&3)===0&&(delete kn[i],--Xr)}const e=Lc(n);e.length!==4&&Wn(n);for(const t of e)isNaN(t)&&Wn(n);return kn[n]=e,++Xr,e}function _n(n){return Array.isArray(n)?n:Oa(n)}function ka(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const s=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+e+","+t+","+i+","+s+")"}function Pf(n,e,t){const i=n;let s=!0,r=!1,o=!1;const a=[Ks(i,z.LOAD,function(){o=!0,r||e()})];return i.src&&Oc?(r=!0,i.decode().then(function(){s&&e()}).catch(function(l){s&&(o?e():t())})):a.push(Ks(i,z.ERROR,t)),function(){s=!1,a.forEach(se)}}function Lf(n,e){return new Promise((t,i)=>{function s(){o(),t(n)}function r(){o(),i(new Error("Image load error"))}function o(){n.removeEventListener("load",s),n.removeEventListener("error",r)}n.addEventListener("load",s),n.addEventListener("error",r)})}function Mf(n,e){return e&&(n.src=e),n.src&&Oc?new Promise((t,i)=>n.decode().then(()=>t(n)).catch(s=>n.complete&&n.width?t(n):i(s))):Lf(n)}class Df{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];(e++&3)===0&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,i){const s=Jr(e,t,i);return s in this.cache_?this.cache_[s]:null}getPattern(e,t,i){const s=Jr(e,t,i);return s in this.patternCache_?this.patternCache_[s]:null}set(e,t,i,s,r){const o=Jr(e,t,i),a=o in this.cache_;this.cache_[o]=s,r&&(s.getImageState()===K.IDLE&&s.load(),s.getImageState()===K.LOADING?s.ready().then(()=>{this.patternCache_[o]=Zs().createPattern(s.getImage(1),"repeat")}):this.patternCache_[o]=Zs().createPattern(s.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function Jr(n,e,t){const i=t?_n(t):"null";return e+":"+n+":"+i}const Ze=new Df;let Pn=null;class Mc extends fr{constructor(e,t,i,s,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=s===void 0?K.IDLE:s,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===K.LOADED){Pn||(Pn=_e(1,1,void 0,{willReadFrequently:!0})),Pn.drawImage(this.image_,0,0);try{Pn.getImageData(0,0,1,1),this.tainted_=!1}catch{Pn=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(z.CHANGE)}handleImageError_(){this.imageState_=K.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=K.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=_e(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===K.IDLE){this.image_||this.initializeImage_(),this.imageState_=K.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Mf(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==K.LOADED)return;const t=this.image_,i=_e(Math.ceil(t.width*e),Math.ceil(t.height*e)),s=i.canvas;i.scale(e,e),i.drawImage(t,0,0),i.globalCompositeOperation="multiply",i.fillStyle=If(this.color_),i.fillRect(0,0,s.width/e,s.height/e),i.globalCompositeOperation="destination-in",i.drawImage(t,0,0),this.canvas_[e]=s}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===K.LOADED||this.imageState_===K.ERROR)e();else{const t=()=>{(this.imageState_===K.LOADED||this.imageState_===K.ERROR)&&(this.removeEventListener(z.CHANGE,t),e())};this.addEventListener(z.CHANGE,t)}})),this.ready_}}function Pa(n,e,t,i,s,r){let o=e===void 0?void 0:Ze.get(e,t,s);return o||(o=new Mc(n,n&&"src"in n?n.src||void 0:e,t,i,s),Ze.set(e,t,s,o,r)),r&&o&&!Ze.getPattern(e,t,s)&&Ze.set(e,t,s,o,r),o}function pt(n){return n?Array.isArray(n)?ka(n):typeof n=="object"&&"src"in n?Ff(n):n:null}function Ff(n){if(!n.offset||!n.size)return Ze.getPattern(n.src,"anonymous",n.color);const e=n.src+":"+n.offset,t=Ze.getPattern(e,void 0,n.color);if(t)return t;const i=Ze.get(n.src,"anonymous",null);if(i.getImageState()!==K.LOADED)return null;const s=_e(n.size[0],n.size[1]);return s.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),Pa(s.canvas,e,void 0,K.LOADED,n.color,!0),Ze.getPattern(e,void 0,n.color)}class Dc{drawCustom(e,t,i,s,r){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const Ps="ol-hidden",Nf="ol-selectable",Cr="ol-unselectable",La="ol-control",Ml="ol-collapsed",jf=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Dl=["style","variant","weight","size","lineHeight","family"],Fo={normal:400,bold:700},No=function(n){const e=n.match(jf);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let i=0,s=Dl.length;i<s;++i){const r=e[i+1];r!==void 0&&(t[Dl[i]]=typeof r=="string"?r.trim():r)}return isNaN(Number(t.weight))&&t.weight in Fo&&(t.weight=Fo[t.weight]),t.families=t.family.split(/,\s?/).map(i=>i.trim().replace(/^['"]|['"]$/g,"")),t},Fc="10px sans-serif",Le="#000",mn="round",At=[],Ot=0,pn="round",es=10,ts="#000",is="center",Js="middle",pi=[0,0,0,0],ns=1,Yi=new ct;let Ln=null,Fl;const jo={},Gf=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function Uf(n,e,t){return`${n} ${e} 16px "${t}"`}const $f=function(){let e,t;async function i(r){await t.ready;const o=await t.load(r);if(o.length===0)return!1;const a=No(r),l=a.families[0].toLowerCase(),h=a.weight;return o.some(c=>{const u=c.family.replace(/^['"]|['"]$/g,"").toLowerCase(),d=Fo[c.weight]||c.weight;return u===l&&c.style===a.style&&d==h})}async function s(){await t.ready;let r=!0;const o=Yi.getProperties(),a=Object.keys(o).filter(l=>o[l]<100);for(let l=a.length-1;l>=0;--l){const h=a[l];let c=o[h];c<100&&(await i(h)?(fs(jo),Yi.set(h,100)):(c+=10,Yi.set(h,c,!0),c<100&&(r=!1)))}e=void 0,r||(e=setTimeout(s,100))}return async function(r){t||(t=Ia?self.fonts:document.fonts);const o=No(r);if(!o)return;const a=o.families;let l=!1;for(const h of a){if(Gf.has(h))continue;const c=Uf(o.style,o.weight,h);Yi.get(c)===void 0&&(Yi.set(c,0,!0),l=!0)}l&&(clearTimeout(e),e=setTimeout(s,100))}}(),Bf=function(){let n;return function(e){let t=jo[e];if(t==null){if(Ia){const i=No(e),s=Nc(e,"g");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),t=n.offsetHeight,document.body.removeChild(n);jo[e]=t}return t}}();function Nc(n,e){return Ln||(Ln=_e(1,1)),n!=Fl&&(Ln.font=n,Fl=Ln.font),Ln.measureText(e)}function jc(n,e){return Nc(n,e).width}function Nl(n,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((s,r)=>Math.max(s,jc(n,r)),0);return t[e]=i,i}function zf(n,e){const t=[],i=[],s=[];let r=0,o=0,a=0,l=0;for(let h=0,c=e.length;h<=c;h+=2){const u=e[h];if(u===`
`||h===c){r=Math.max(r,o),s.push(o),o=0,a+=l,l=0;continue}const d=e[h+1]||n.font,f=jc(d,u);t.push(f),o+=f;const g=Bf(d);i.push(g),l=Math.max(l,g)}return{width:r,height:a,widths:t,heights:i,lineWidths:s}}function Wf(n,e,t,i,s,r,o,a,l,h,c){n.save(),t!==1&&(n.globalAlpha===void 0?n.globalAlpha=u=>u.globalAlpha*=t:n.globalAlpha*=t),e&&n.transform.apply(n,e),i.contextInstructions?(n.translate(l,h),n.scale(c[0],c[1]),Kf(i,n)):c[0]<0||c[1]<0?(n.translate(l,h),n.scale(c[0],c[1]),n.drawImage(i,s,r,o,a,0,0,o,a)):n.drawImage(i,s,r,o,a,l,h,o*c[0],a*c[1]),n.restore()}function Kf(n,e){const t=n.contextInstructions;for(let i=0,s=t.length;i<s;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class Vf extends Dc{constructor(e,t,i,s,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=s,this.transformRotation_=s?yr(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=ot()}drawImages_(e,t,i,s){if(!this.image_)return;const r=Zt(e,t,i,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,_=f+this.imageAnchorY_;Pt(a,g,_,1,1,h,-g,-_),o.save(),o.transform.apply(o,a),o.translate(g,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=Zt(e,t,i,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=s){const l=r[t]+this.textOffsetX_,h=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,i,s,r){const o=this.context_,a=Zt(e,t,i,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),i}drawRings_(e,t,i,s){for(let r=0,o=i.length;r<o;++r)t=this.moveToLineTo_(e,t,i[r],s,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Oe(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=sf(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],s=t[3]-t[1],r=Math.sqrt(i*i+s*s),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,s=t.length;i<s;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Oe(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(Oe(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(s,r,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Oe(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Oe(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let s=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];s=this.drawRings_(i,s,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),ei(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,s=e.textAlign?e.textAlign:is;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=s&&(i.textAlign=s,t.textAlign=s),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=s,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:s,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:pt(i||Le)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),s=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),c=r||At;this.strokeState_={lineCap:s!==void 0?s:mn,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||Ot)*this.pixelRatio_,lineJoin:a!==void 0?a:pn,lineWidth:(l!==void 0?l:ns)*this.pixelRatio_,miterLimit:h!==void 0?h:es,strokeStyle:pt(i||ts)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),s=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:pt(f||Le)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),g=i.getLineCap(),_=i.getLineDash(),m=i.getLineDashOffset(),p=i.getLineJoin(),y=i.getWidth(),v=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:mn,lineDash:_||At,lineDashOffset:m||Ot,lineJoin:p!==void 0?p:pn,lineWidth:y!==void 0?y:ns,miterLimit:v!==void 0?v:es,strokeStyle:pt(f||ts)}}const s=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),c=e.getText(),u=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:s!==void 0?s:Fc,textAlign:u!==void 0?u:is,textBaseline:d!==void 0?d:Js},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,g,_)=>f+=_%2?" ":g,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const Xf=.5,Gc={Point:tg,LineString:Jf,Polygon:ng,MultiPoint:ig,MultiLineString:Qf,MultiPolygon:eg,GeometryCollection:Zf,Circle:qf};function Yf(n,e){return parseInt(Z(n),10)-parseInt(Z(e),10)}function jl(n,e){const t=Uc(n,e);return t*t}function Uc(n,e){return Xf*n/e}function qf(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=n.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(e,i,s)}const a=t.getText();if(a&&a.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function Gl(n,e,t,i,s,r,o,a){const l=[],h=t.getImage();if(h){let d=!0;const f=h.getImageState();f==K.LOADED||f==K.ERROR?d=!1:f==K.IDLE&&h.load(),d&&l.push(h.ready())}const c=t.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>s(null)),Hf(n,e,t,i,r,o,a),u}function Hf(n,e,t,i,s,r,o){const a=t.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(i,s);if(t.getRenderer())$c(n,l,t,e,o);else{const c=Gc[l.getType()];c(n,l,t,e,o,r)}}function $c(n,e,t,i,s){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,l=o.length;a<l;++a)$c(n,o[a],t,i,s);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),s)}function Zf(n,e,t,i,s,r){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=Gc[o[a].getType()];h(n,o[a],t,i,s,r)}}function Jf(n,e,t,i,s){const r=t.getStroke();if(r){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,i,s)}const o=t.getText();if(o&&o.getText()){const a=n.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,s)}}function Qf(n,e,t,i,s){const r=t.getStroke();if(r){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,i,s)}const o=t.getText();if(o&&o.getText()){const a=n.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,s)}}function eg(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(o||r){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(e,i,s)}const a=t.getText();if(a&&a.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,s)}}function tg(n,e,t,i,s,r){const o=t.getImage(),a=t.getText(),l=a&&a.getText(),h=r&&o&&l?{}:void 0;if(o){if(o.getImageState()!=K.LOADED)return;const c=n.getBuilder(t.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(e,i,s)}if(l){const c=n.getBuilder(t.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(e,i,s)}}function ig(n,e,t,i,s,r){const o=t.getImage(),a=o&&o.getOpacity()!==0,l=t.getText(),h=l&&l.getText(),c=r&&a&&h?{}:void 0;if(a){if(o.getImageState()!=K.LOADED)return;const u=n.getBuilder(t.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(e,i,s)}if(h){const u=n.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(e,i,s)}}function ng(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(e,i,s)}const a=t.getText();if(a&&a.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,s)}}let sg=!1;function rg(n,e,t,i,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(t,i,s):n,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=sg,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();try{let c;h=="text"||h=="json"?c=a.responseText:h=="xml"?c=a.responseXML||a.responseText:h=="arraybuffer"&&(c=a.response),c?r(e.readFeatures(c,{extent:t,featureProjection:s}),e.readProjection(c)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function Ul(n,e){return function(t,i,s,r,o){rg(n,e,t,i,s,(a,l)=>{this.addFeatures(a),r!==void 0&&r(a)},()=>{this.changed(),o!==void 0&&o()})}}function og(n,e){return[[-1/0,-1/0,1/0,1/0]]}function Bc(n,e,t,i){const s=[];let r=Qe();for(let o=0,a=t.length;o<a;++o){const l=t[o];r=oa(n,e,l[0],i),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=l[l.length-1]}return s}class Ma extends ti{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Ma(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const r=this.flatCoordinates,o=e-r[0],a=t-r[1],l=o*o+a*a;if(l<s){if(l===0)for(let h=0;h<this.stride;++h)i[h]=r[h];else{const h=this.getRadius()/Math.sqrt(l);i[0]=r[0]+h*o,i[1]=r[1]+h*a;for(let c=2;c<this.stride;++c)i[c]=r[c]}return i.length=this.stride,l}return s}containsXY(e,t){const i=this.flatCoordinates,s=e-i[0],r=t-i[1];return s*s+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return kt(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Oe(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:aa(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+i;for(let r=1;r<t;++r)s[t+r]=e[r];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let r=Ec(s,0,e,this.stride);s[r++]=s[0]+t;for(let o=1,a=this.stride;o<a;++o)s[r++]=s[o];s.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),s=this.getStride();this.setCenter(pa(i,0,i.length,s,e,t,i)),this.changed()}}class Qs extends yc{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(se),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push(H(e[t],z.CHANGE,this.changed,this))}clone(){const e=new Qs(Qr(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,s){if(s<Ri(this.getExtent(),e,t))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(e,t,i,s);return s}containsXY(e,t){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)if(i[s].containsXY(e,t))return!0;return!1}computeExtent(e){_s(e);const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)nc(e,t[i].getExtent());return e}getGeometries(){return Qr(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let s=!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(s=!0)}return s?new Qs(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].rotate(e,t);this.changed()}scale(e,t,i){i||(i=Jt(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(Qr(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,s=t.length;i<s;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Qr(n){return n.map(e=>e.clone())}class er extends ti{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const s=e,r=[],o=[];for(let l=0,h=s.length;l<h;++l){const c=s[l];yt(r,c.getFlatCoordinates()),o.push(r.length)}const a=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(e){yt(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new er(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<Ri(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(wa(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ea(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,s))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,mf(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return Jn(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new gn(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,s=[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=new gn(e.slice(r,l),i);s.push(h),r=l}return s}getLength(){const e=this.ends_;let t=0,i=0;for(let s=0,r=e.length;s<r;++s)i+=Ta(this.flatCoordinates,t,e[s],this.stride),t=e[s];return i}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=Hs(t,i,l,r,.5);yt(e,h),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=Sc(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new er(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return df(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ps(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class Rr extends ti{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){yt(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new Rr(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){if(s<Ri(this.getExtent(),e,t))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=Ei(e,t,r[a],r[a+1]);if(h<s){s=h;for(let c=0;c<o;++c)i[c]=r[a+c];i.length=o}}return s}getCoordinates(){return Yt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new Si(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,s=[];for(let r=0,o=e.length;r<o;r+=i){const a=new Si(e.slice(r,r+i),t);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let s=0,r=t.length;s<r;s+=i){const o=t[s],a=t[s+1];if(ra(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Er(this.flatCoordinates,0,e,this.stride),this.changed()}}class tr extends ti{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const s=e,r=[],o=[];for(let a=0,l=s.length;a<l;++a){const h=s[a],c=r.length,u=h.getEnds();for(let d=0,f=u.length;d<f;++d)u[d]+=c;yt(r,h.getFlatCoordinates()),o.push(u)}t=s.length===0?this.getLayout():s[0].getLayout(),e=r,i=o}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;yt(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let s=0,r=t.length;s<r;++s)t[s]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let s=0;s<e;++s)t[s]=this.endss_[s].slice();const i=new tr(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,s){return s<Ri(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(of(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),af(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,s))}containsXY(e,t){return uf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return rf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Mo(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Lo(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=Bc(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=xc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Rr(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Ic(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Mo(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=hf(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new tr(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const i=this.endss_[e].slice(),s=i[i.length-1];if(t!==0)for(let r=0,o=i.length;r<o;++r)i[r]-=t;return new Qt(this.flatCoordinates.slice(t,s),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const c=new Qt(t.slice(r,h),e,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(e){return ff(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=bc(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const $l=ot();class $e{constructor(e,t,i,s,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?ic(this.flatCoordinates_):oa(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Jt(this.getExtent());this.flatInteriorPoints_=xa(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=_f(this.flatCoordinates_,this.ends_),t=Bc(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=xc(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Hs(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let s=0,r=i.length;s<r;++s){const o=i[s],a=Hs(e,t,o,2,.5);yt(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=ce(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const s=ke(i)/ke(t);Pt($l,i[0],i[3],s,-s,0,0,0),Zt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,$l,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new $e(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=ec((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":i.length=br(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),s=[i.length];break;case"MultiLineString":s=[],i.length=Sc(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,s);break;case"Polygon":s=[],i.length=ba(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,s);break}return s&&(this.simplifiedGeometry_=new $e(this.type_,i,s,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}$e.prototype.getFlatCoordinates=$e.prototype.getOrientedFlatCoordinates;function ag(n,e,t,i,s){zc(n,e,t||0,i||n.length-1,s||lg)}function zc(n,e,t,i,s){for(;i>t;){if(i-t>600){var r=i-t+1,o=e-t+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1),c=Math.max(t,Math.floor(e-o*l/r+h)),u=Math.min(i,Math.floor(e+(r-o)*l/r+h));zc(n,e,c,u,s)}var d=n[e],f=t,g=i;for(Mn(n,t,e),s(n[i],d)>0&&Mn(n,t,i);f<g;){for(Mn(n,f,g),f++,g--;s(n[f],d)<0;)f++;for(;s(n[g],d)>0;)g--}s(n[t],d)===0?Mn(n,t,g):(g++,Mn(n,g,i)),g<=e&&(t=g+1),e<=g&&(i=g-1)}}function Mn(n,e,t){var i=n[e];n[e]=n[t],n[t]=i}function lg(n,e){return n<e?-1:n>e?1:0}let Wc=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!Ms(e,t))return i;const s=this.toBBox,r=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?s(a):a;Ms(e,l)&&(t.leaf?i.push(a):to(e,l)?this._all(a,i):r.push(a))}t=r.pop()}return i}collides(e){let t=this.data;if(!Ms(e,t))return!1;const i=[];for(;t;){for(let s=0;s<t.children.length;s++){const r=t.children[s],o=t.leaf?this.toBBox(r):r;if(Ms(e,o)){if(t.leaf||to(e,o))return!0;i.push(r)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=qi([]),this}remove(e,t){if(!e)return this;let i=this.data;const s=this.toBBox(e),r=[],o=[];let a,l,h;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),i.leaf){const c=hg(e,i.children,t);if(c!==-1)return i.children.splice(c,1),r.push(i),this._condense(r),this}!h&&!i.leaf&&to(i,s)?(r.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,s){const r=i-t+1;let o=this._maxEntries,a;if(r<=o)return a=qi(e.slice(t,i+1)),Fi(a,this.toBBox),a;s||(s=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,s-1))),a=qi([]),a.leaf=!1,a.height=s;const l=Math.ceil(r/o),h=l*Math.ceil(Math.sqrt(o));Bl(e,t,i,h,this.compareMinX);for(let c=t;c<=i;c+=h){const u=Math.min(c+h-1,i);Bl(e,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const f=Math.min(d+l-1,u);a.children.push(this._build(e,d,f,s-1))}}return Fi(a,this.toBBox),a}_chooseSubtree(e,t,i,s){for(;s.push(t),!(t.leaf||s.length-1===i);){let r=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],c=eo(h),u=dg(e,h)-c;u<o?(o=u,r=c<r?c:r,a=h):u===o&&c<r&&(r=c,a=h)}t=a||t.children[0]}return t}_insert(e,t,i){const s=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(s,this.data,t,r);for(o.children.push(e),Nn(o,s);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(s,r,t)}_split(e,t){const i=e[t],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);const o=this._chooseSplitIndex(i,r,s),a=qi(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Fi(i,this.toBBox),Fi(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=qi([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Fi(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let s,r=1/0,o=1/0;for(let a=t;a<=i-t;a++){const l=Fn(e,0,a,this.toBBox),h=Fn(e,a,i,this.toBBox),c=fg(l,h),u=eo(l)+eo(h);c<r?(r=c,s=a,o=u<o?u:o):c===r&&u<o&&(o=u,s=a)}return s||i-t}_chooseSplitAxis(e,t,i){const s=e.leaf?this.compareMinX:cg,r=e.leaf?this.compareMinY:ug,o=this._allDistMargin(e,t,i,s),a=this._allDistMargin(e,t,i,r);o<a&&e.children.sort(s)}_allDistMargin(e,t,i,s){e.children.sort(s);const r=this.toBBox,o=Fn(e,0,t,r),a=Fn(e,i-t,i,r);let l=Ls(o)+Ls(a);for(let h=t;h<i-t;h++){const c=e.children[h];Nn(o,e.leaf?r(c):c),l+=Ls(o)}for(let h=i-t-1;h>=t;h--){const c=e.children[h];Nn(a,e.leaf?r(c):c),l+=Ls(a)}return l}_adjustParentBBoxes(e,t,i){for(let s=i;s>=0;s--)Nn(t[s],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():Fi(e[t],this.toBBox)}};function hg(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function Fi(n,e){Fn(n,0,n.children.length,e,n)}function Fn(n,e,t,i,s){s||(s=qi(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=e;r<t;r++){const o=n.children[r];Nn(s,n.leaf?i(o):o)}return s}function Nn(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function cg(n,e){return n.minX-e.minX}function ug(n,e){return n.minY-e.minY}function eo(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Ls(n){return n.maxX-n.minX+(n.maxY-n.minY)}function dg(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function fg(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),s=Math.min(n.maxX,e.maxX),r=Math.min(n.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,r-i)}function to(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function Ms(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function qi(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Bl(n,e,t,i,s){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;ag(n,o,e,t,s),r.push(e,o,o,t)}}class zl{constructor(e){this.rbush_=new Wc(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[Z(t)]=i}load(e,t){const i=new Array(t.length);for(let s=0,r=t.length;s<r;s++){const o=e[s],a=t[s],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[s]=l,this.items_[Z(a)]=l}this.rbush_.load(i)}remove(e){const t=Z(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[Z(t)],s=[i.minX,i.minY,i.maxX,i.maxY];qn(s,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(s){return s.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let s=0,r=e.length;s<r;s++)if(i=t(e[s]),i)return i;return i}isEmpty(){return bi(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return kt(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}class Kc extends ct{constructor(e){super(),this.projection=ce(e.projection),this.attributions_=Wl(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,s){t.viewResolver=i,t.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Wl(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Wl(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),e=>n):null}const qe={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class jt extends Mt{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class Da extends Kc{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Yn,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(Q(this.format_,"`format` must be set when `url` is set"),this.loader_=Ul(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:og;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new zl:null,this.loadedExtentsRtree_=new zl,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(e.features)?s=e.features:e.features&&(i=e.features,s=i.getArray()),!t&&i===void 0&&(i=new mt(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=Z(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new jt(qe.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof $e||(this.featureChangeKeys_[e]=[H(t,z.CHANGE,this.handleFeatureChange_,this),H(t,cn.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const s=String(t.getId());if(!(s in this.idIndex_))this.idIndex_[s]=t;else if(t instanceof $e){const r=this.idIndex_[s];r instanceof $e?Array.isArray(r)?r.push(t):this.idIndex_[s]=[r,t]:i=!1}else i=!1}return i&&(Q(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],s=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=Z(a);this.addToIndex_(l,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],l=Z(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();t.push(c),s.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,s),this.hasListener(qe.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new jt(qe.ADDFEATURE,i[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(qe.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(qe.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(Pe.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(Pe.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(se);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new jt(qe.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(s){const r=s.getGeometry();if(r instanceof $e||r.intersectsCoordinate(e))return t(s)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const s=i.getGeometry();if(s instanceof $e||s.intersectsExtent(e)){const r=t(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),bi(this.nullGeometryFeatures_)||yt(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const s=ac(e,t);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],s=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||Xn,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const c=h.getGeometry(),u=a;if(a=c instanceof $e?0:c.closestPointXY(i,s,o,a),a<u){r=h;const d=Math.sqrt(a);l[0]=i-d,l[1]=s-d,l[2]=i+d,l[3]=s+d}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=Z(t),s=t.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new jt(qe.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:Z(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&bi(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const s=this.loadedExtentsRtree_,r=this.strategy_(e,t,i);for(let o=0,a=r.length;o<a;++o){const l=r[o];s.forEachInExtent(l,function(c){return tn(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new jt(qe.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new jt(qe.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new jt(qe.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,i=t.forEachInExtent(e,function(s){if(qn(s.extent,e))return s});i&&t.remove(i)}removeFeatures(e){let t=!1;for(let i=0,s=e.length;i<s;++i)t=this.removeFeatureInternal(e[i])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=Z(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.featureChangeKeys_[t]?.forEach(se),delete this.featureChangeKeys_[t];const s=e.getId();if(s!==void 0){const r=s.toString(),o=this.idIndex_[r];o===e?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(e),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[t],this.hasListener(qe.REMOVEFEATURE)&&this.dispatchEvent(new jt(qe.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){Q(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(Ul(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}class lt{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new lt({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=Pa(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===K.IDLE&&t.load(),t.getImageState()===K.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?Z(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:_n(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class Dt{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Dt({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}function Kl(n){return n[0]>0&&n[1]>0}function gg(n,e,t){return t===void 0&&(t=[0,0]),t[0]=n[0]*e+.5|0,t[1]=n[1]*e+.5|0,t}function Fe(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}class Tr{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Fe(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Tr({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return $()}getImage(e){return $()}getHitDetectionImage(){return $()}getPixelRatio(e){return 1}getImageState(){return $()}getImageSize(){return $()}getOrigin(){return $()}getSize(){return $()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Fe(e)}listenImageChange(e){$()}load(){$()}unlistenImageChange(e){$()}ready(){return Promise.resolve()}}class Ir extends Tr{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?K.LOADING:K.LOADED,this.imageState_===K.LOADING&&this.ready().then(()=>this.imageState_=K.LOADED),this.render()}clone(){const e=this.getScale(),t=new Ir({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){const t=this.fill_?.getKey(),i=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let s=Ze.get(i,null,null)?.getImage(1);if(!s){const r=this.renderOptions_,o=Math.ceil(r.size*e),a=_e(o,o);this.draw_(r,a,e),s=a.canvas,Ze.set(i,null,null,new Mc(s,void 0,null,K.LOADED,null))}return s}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let s=this.radius,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const b=s;s=r,r=b}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=s-h,u=Math.sqrt(l*l+c*c),d=u/l;if(e==="miter"&&d<=i)return d*t;const f=t/2/d,g=t/2*(c/u),m=Math.sqrt((s+f)*(s+f)+g*g)-s;if(this.radius2_===void 0||e==="bevel")return m*2;const p=s*Math.sin(a),y=Math.sqrt(s*s-p*p),v=r-y,E=Math.sqrt(p*p+v*v)/p;if(E<=i){const b=E*t/2-r-s;return 2*Math.max(m,b)}return m*2}createRenderOptions(){let e=mn,t=pn,i=0,s=null,r=0,o,a=0;this.stroke_&&(o=pt(this.stroke_.getColor()??ts),a=this.stroke_.getWidth()??ns,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??pn,e=this.stroke_.getLineCap()??mn,i=this.stroke_.getMiterLimit()??es);const l=this.calculateLineJoinSize_(t,a,i),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:e,lineDash:s,lineDashOffset:r,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let s=this.fill_.getColor();s===null&&(s=Le),t.fillStyle=pt(s),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),s=0;typeof i=="string"&&(i=_n(i)),i===null?s=1:Array.isArray(i)&&(s=i.length===4?i[3]:1),s===0&&(t=_e(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const s=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=r+a*o,h=a%2===0?i:s;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=Le,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Ai extends Ir{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Ai({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius=e,this.render()}}class We{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Vl,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new We({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Vl,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function _g(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(Q(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[n]),e=function(){return t}}return e}let io=null;function Vc(n,e){if(!io){const t=new lt({color:"rgba(255,255,255,0.4)"}),i=new Dt({color:"#3399CC",width:1.25});io=[new We({image:new Ai({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return io}function Vl(n){return n.getGeometry()}const mg="#333";class Ar{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=Fe(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new lt({color:mg}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Ar({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Fe(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const Re={ANIMATING:0,INTERACTING:1},L={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Ds=[L.FILL],qt=[L.STROKE],yi=[L.BEGIN_PATH],Xl=[L.CLOSE_PATH];class ys extends Dc{constructor(e,t,i,s){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=e.length;a<l;a+=t)s[0]=e[a],s[1]=e[a+1],un(i,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(e,t,i,s,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=s);let c=e[t],u=e[t+1];const d=this.tmpCoordinate_;let f=!0,g,_,m;for(g=t+s;g<i;g+=s)d[0]=e[g],d[1]=e[g+1],m=Co(h,d),m!==_?(f&&(a[l++]=c,a[l++]=u,f=!1),a[l++]=d[0],a[l++]=d[1]):m===pe.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,c=d[0],u=d[1],_=m;return(r&&f||g===t+s)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(e,t,i,s,r){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(e,t,l,s,!1,!1);r.push(h),t=l}return t}drawCustom(e,t,i,s,r){this.beginGeometry(e,t,r);const o=e.getType(),a=e.getStride(),l=this.coordinates.length;let h,c,u,d,f;switch(o){case"MultiPolygon":h=e.getOrientedFlatCoordinates(),d=[];const g=e.getEndss();f=0;for(let _=0,m=g.length;_<m;++_){const p=[];f=this.drawCustomCoordinates_(h,f,g[_],a,p),d.push(p)}this.instructions.push([L.CUSTOM,l,d,e,i,Lo,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,d,e,s||i,Lo,r]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),f=this.drawCustomCoordinates_(h,0,e.getEnds(),a,u),this.instructions.push([L.CUSTOM,l,u,e,i,Jn,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,u,e,s||i,Jn,r]);break;case"LineString":case"Circle":h=e.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([L.CUSTOM,l,c,e,i,Yt,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,c,e,s||i,Yt,r]);break;case"MultiPoint":h=e.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([L.CUSTOM,l,c,e,i,Yt,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,c,e,s||i,Yt,r]));break;case"Point":h=e.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([L.CUSTOM,l,c,e,i,void 0,r]),this.hitDetectionInstructions.push([L.CUSTOM,l,c,e,s||i,void 0,r]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[L.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[L.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let s,r,o=-1;for(t=0;t<i;++t)s=e[t],r=s[0],r==L.END_GEOMETRY?o=t:r==L.BEGIN_GEOMETRY&&(s[2]=t,rd(this.hitDetectionInstructions,o,t),o=-1)}fillStyleToState(e,t={}){if(e){const i=e.getColor();t.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,t.fillStyle=pt(i||Le)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){const i=e.getColor();t.strokeStyle=pt(i||ts);const s=e.getLineCap();t.lineCap=s!==void 0?s:mn;const r=e.getLineDash();t.lineDash=r?r.slice():At;const o=e.getLineDashOffset();t.lineDashOffset=o||Ot;const a=e.getLineJoin();t.lineJoin=a!==void 0?a:pn;const l=e.getWidth();t.lineWidth=l!==void 0?l:ns;const h=e.getMiterLimit();t.miterLimit=h!==void 0?h:es,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){const i=this.state;this.fillStyleToState(e,i),this.strokeStyleToState(t,i)}createFill(e){const t=e.fillStyle,i=[L.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[L.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,s=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=s||r!=e.currentLineDash&&!ei(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=s,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[L.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=tc(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;sa(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class pg extends ys{constructor(e,t,i,s){super(e,t,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!un(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const s=e.getFlatCoordinates(),r=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,r);this.instructions.push([L.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([L.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const s=e.getFlatCoordinates(),r=[];for(let l=0,h=s.length;l<h;l+=e.getStride())(!this.maxExtent||un(this.maxExtent,s.slice(l,l+2)))&&r.push(s[l],s[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([L.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([L.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),s=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=s[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class yg extends ys{constructor(e,t,i,s){super(e,t,i,s)}drawFlatCoordinates_(e,t,i,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,s,!1,!1),a=[L.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t,i){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,At,Ot],yi);const a=e.getFlatCoordinates(),l=e.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(qt),this.endGeometry(t)}drawMultiLineString(e,t,i){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,At,Ot],yi);const a=e.getEnds(),l=e.getFlatCoordinates(),h=e.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(qt),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(qt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(qt),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(yi)}}class Yl extends ys{constructor(e,t,i,s){super(e,t,i,s)}drawFlatCoordinatess_(e,t,i,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=i.length;this.instructions.push(yi),this.hitDetectionInstructions.push(yi);for(let h=0;h<l;++h){const c=i[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,c,s,!0,!a),f=[L.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(Xl),this.hitDetectionInstructions.push(Xl)),t=c}return o&&(this.instructions.push(Ds),this.hitDetectionInstructions.push(Ds)),a&&(this.instructions.push(qt),this.hitDetectionInstructions.push(qt)),t}drawCircle(e,t,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_FILL_STYLE,Le]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,At,Ot]);const a=e.getFlatCoordinates(),l=e.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[L.CIRCLE,h];this.instructions.push(yi,c),this.hitDetectionInstructions.push(yi,c),s.fillStyle!==void 0&&(this.instructions.push(Ds),this.hitDetectionInstructions.push(Ds)),s.strokeStyle!==void 0&&(this.instructions.push(qt),this.hitDetectionInstructions.push(qt)),this.endGeometry(t)}drawPolygon(e,t,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_FILL_STYLE,Le]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,At,Ot]);const a=e.getEnds(),l=e.getOrientedFlatCoordinates(),h=e.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(t)}drawMultiPolygon(e,t,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_FILL_STYLE,Le]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([L.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,At,Ot]);const a=e.getEndss(),l=e.getOrientedFlatCoordinates(),h=e.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,s=t.length;i<s;++i)t[i]=hi(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}}function wg(n,e,t,i,s){const r=[];let o=t,a=0,l=e.slice(t,2);for(;a<n&&o+s<i;){const[h,c]=l.slice(-2),u=e[o+s],d=e[o+s+1],f=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=f,a>=n){const g=(n-a+f)/f,_=Ue(h,u,g),m=Ue(c,d,g);l.push(_,m),r.push(l),l=[_,m],a==n&&(o+=s),a=0}else if(a<n)l.push(e[o+s],e[o+s+1]),o+=s;else{const g=f-a,_=Ue(h,u,g/f),m=Ue(c,d,g/f);l.push(_,m),r.push(l),l=[_,m],a=0,o+=s}}return a>0&&r.push(l),r}function vg(n,e,t,i,s){let r=t,o=t,a=0,l=0,h=t,c,u,d,f,g,_,m,p,y,v;for(u=t;u<i;u+=s){const w=e[u],E=e[u+1];g!==void 0&&(y=w-g,v=E-_,f=Math.sqrt(y*y+v*v),m!==void 0&&(l+=d,c=Math.acos((m*y+p*v)/(d*f)),c>n&&(l>a&&(a=l,r=h,o=u),l=0,h=u-s)),d=f,m=y,p=v),g=w,_=E}return l+=f,l>a?[h,u]:[r,o]}const ir={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Eg extends ys{constructor(e,t,i,s){super(e,t,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Le]={fillStyle:Le},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const s=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!s&&!r)return;const a=this.coordinates;let l=a.length;const h=e.getType();let c=null,u=e.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Oe(this.maxExtent,e.getExtent()))return;let d;if(c=e.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=e.getEnds();else if(h=="Polygon")d=e.getEnds().slice(0,1);else if(h=="MultiPolygon"){const m=e.getEndss();d=[];for(let p=0,y=m.length;p<y;++p)d.push(m[p][0])}this.beginGeometry(e,t,i);const f=o.repeat,g=f?void 0:o.textAlign;let _=0;for(let m=0,p=d.length;m<p;++m){let y;f?y=wg(f*this.resolution,c,_,d[m],u):y=[c.slice(_,d[m])];for(let v=0,w=y.length;v<w;++v){const E=y[v];let b=0,x=E.length;if(g==null){const R=vg(o.maxAngle,E,0,E.length,2);b=R[0],x=R[1]}for(let R=b;R<x;R+=u)a.push(E[R],E[R+1]);const C=a.length;_=d[m],this.drawChars_(l,C),l=C}}this.endGeometry(t)}else{let d=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=e.getFlatCoordinates();break;case"LineString":c=e.getFlatMidpoint();break;case"Circle":c=e.getCenter();break;case"MultiLineString":c=e.getFlatMidpoints(),u=2;break;case"Polygon":c=e.getFlatInteriorPoint(),o.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const w=e.getFlatInteriorPoints();c=[];for(let E=0,b=w.length;E<b;E+=3)o.overflow||d.push(w[E+2]/this.resolution),c.push(w[E],w[E+1]);if(c.length===0)return;u=2;break}const f=this.appendFlatPointCoordinates(c,u);if(f===l)return;if(d&&(f-l)/2!==c.length/u){let w=l/2;d=d.filter((E,b)=>{const x=a[(w+b)*2]===c[b*u]&&a[(w+b)*2+1]===c[b*u+1];return x||--w,x})}this.saveTextStates_();const g=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,_=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(e,t,i);let m=o.padding;if(m!=pi&&(o.scale[0]<0||o.scale[1]<0)){let w=o.padding[0],E=o.padding[1],b=o.padding[2],x=o.padding[3];o.scale[0]<0&&(E=-E,x=-x),o.scale[1]<0&&(w=-w,b=-b),m=[w,E,b,x]}const p=this.pixelRatio;this.instructions.push([L.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,m==pi?pi:m.map(function(w){return w*p}),g,_,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const y=1/p,v=g?g.slice(0):null;v&&(v[1]=Le),this.hitDetectionInstructions.push([L.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,this.declutterMode_,this.declutterImageWithText_,m,v,_,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Le:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,s=this.strokeKey_;e&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||is,justify:t.justify,textBaseline:t.textBaseline||Js,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=ir[s.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([L.DRAW_CHARS,e,t,h,s.overflow,a,s.maxAngle,l,c,r,d*l,u,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([L.DRAW_CHARS,e,t,h,s.overflow,a&&Le,s.maxAngle,l,c,r,d*l,u,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let i,s,r;if(!e)this.text_="";else{const o=e.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=pt(o.getColor()||Le)):(s=null,this.textFillState_=s);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const _=a.getLineDash(),m=a.getLineDashOffset(),p=a.getWidth(),y=a.getMiterLimit();r.lineCap=a.getLineCap()||mn,r.lineDash=_?_.slice():At,r.lineDashOffset=m===void 0?Ot:m,r.lineJoin=a.getLineJoin()||pn,r.lineWidth=p===void 0?ns:p,r.miterLimit=y===void 0?es:y,r.strokeStyle=pt(a.getColor()||ts)}i=this.textState_;const l=e.getFont()||Fc;$f(l);const h=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||Js,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||pi,i.scale=h===void 0?[1,1]:h;const c=e.getOffsetX(),u=e.getOffsetY(),d=e.getRotateWithView(),f=e.getKeepUpright(),g=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=f===void 0?!0:f,this.textRotation_=g===void 0?0:g,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:Z(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+Z(s.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const bg={Circle:Yl,Default:ys,Image:pg,LineString:yg,Polygon:Yl,Text:Eg};class Sg{constructor(e,t,i,s){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const s in i){const r=i[s].finish();e[t][s]=r}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let r=s[t];if(r===void 0){const o=bg[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[t]=r}return r}}function xg(n,e,t,i,s,r,o,a,l,h,c,u,d=!0){let f=n[e],g=n[e+1],_=0,m=0,p=0,y=0;function v(){_=f,m=g,e+=i,f=n[e],g=n[e+1],y+=p,p=Math.sqrt((f-_)*(f-_)+(g-m)*(g-m))}do v();while(e<t-i&&y+p<r);let w=p===0?0:(r-y)/p;const E=Ue(_,f,w),b=Ue(m,g,w),x=e-i,C=y,R=r+a*l(h,s,c);for(;e<t-i&&y+p<R;)v();w=p===0?0:(R-y)/p;const I=Ue(_,f,w),G=Ue(m,g,w);let P=!1;if(d)if(u){const B=[E,b,I,G];pa(B,0,4,2,u,B,B),P=B[0]>B[2]}else P=E>I;const A=Math.PI,k=[],V=x+i===e;e=x,p=0,y=C,f=n[e],g=n[e+1];let F;if(V){v(),F=Math.atan2(g-m,f-_),P&&(F+=F>0?-A:A);const B=(I+E)/2,D=(G+b)/2;return k[0]=[B,D,(R-r)/2,F,s],k}s=s.replace(/\n/g," ");for(let B=0,D=s.length;B<D;){v();let X=Math.atan2(g-m,f-_);if(P&&(X+=X>0?-A:A),F!==void 0){let ue=X-F;if(ue+=ue>A?-2*A:ue<-A?2*A:0,Math.abs(ue)>o)return null}F=X;const Y=B;let ie=0;for(;B<D;++B){const ue=P?D-B-1:B,Ne=a*l(h,s[ue],c);if(e+i<t&&y+p<r+ie+Ne/2)break;ie+=Ne}if(B===Y)continue;const T=P?s.substring(D-Y,D-B):s.substring(Y,B);w=p===0?0:(r+ie/2-y)/p;const be=Ue(_,f,w),Te=Ue(m,g,w);k.push([be,Te,ie/2,X,T]),r+=ie}return k}class Xc{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Zs(),{get:(e,t)=>{if(typeof Zs()[t]=="function")return this.push_(t),this.pushMethodArgs_},set:(e,t,i)=>(this.push_(t,i),!0)})}push_(...e){const t=this.instructions_,i=this.zIndex+this.offset_;t[i]||(t[i]=[]),t[i].push(...e)}pushMethodArgs_=(...e)=>(this.push_(e),this);pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,s=t.length;i<s;++i){const r=t[i];if(typeof r=="function"){r(e);continue}const o=t[++i];if(typeof e[r]=="function")e[r](...o);else{if(typeof o=="function"){e[r]=o(e);continue}e[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Ni=Qe(),Gt=[],bt=[],St=[],Ut=[];function ql(n){return n[3].declutterBox}const Hl=new RegExp("[-----]");function no(n,e){return e==="start"?e=Hl.test(n)?"right":"left":e==="end"&&(e=Hl.test(n)?"left":"right"),ir[e]}function Cg(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}function Rg(n,e,t){return t%2===0&&(n+=e),n}class Tg{constructor(e,t,i,s,r){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=ot(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new Xc:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,s){const r=e+t+i+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=l.justify?ir[l.justify]:no(Array.isArray(e)?e[0]:e,l.textAlign||is),d=s&&o.lineWidth?o.lineWidth:0,f=Array.isArray(e)?e:String(e).split(`
`).reduce(Cg,[]),{width:g,height:_,widths:m,heights:p,lineWidths:y}=zf(l,f),v=g+d,w=[],E=(v+2)*c[0],b=(_+d)*c[1],x={width:E<0?Math.floor(E):Math.ceil(E),height:b<0?Math.floor(b):Math.ceil(b),contextInstructions:w};(c[0]!=1||c[1]!=1)&&w.push("scale",c),s&&(w.push("strokeStyle",o.strokeStyle),w.push("lineWidth",d),w.push("lineCap",o.lineCap),w.push("lineJoin",o.lineJoin),w.push("miterLimit",o.miterLimit),w.push("setLineDash",[o.lineDash]),w.push("lineDashOffset",o.lineDashOffset)),i&&w.push("fillStyle",a.fillStyle),w.push("textBaseline","middle"),w.push("textAlign","center");const C=.5-u;let R=u*v+C*d;const I=[],G=[];let P=0,A=0,k=0,V=0,F;for(let B=0,D=f.length;B<D;B+=2){const X=f[B];if(X===`
`){A+=P,P=0,R=u*v+C*d,++V;continue}const Y=f[B+1]||l.font;Y!==F&&(s&&I.push("font",Y),i&&G.push("font",Y),F=Y),P=Math.max(P,p[k]);const ie=[X,R+C*m[k]+u*(m[k]-y[V]),.5*(d+P)+A];R+=m[k],s&&I.push("strokeText",ie),i&&G.push("fillText",ie),++k}return Array.prototype.push.apply(w,I),Array.prototype.push.apply(w,G),this.labels_[r]=x,x}replayTextBackground_(e,t,i,s,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,s),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],e.fillStyle=o[1],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,s,r,o,a,l,h,c,u,d,f,g,_,m){a*=d[0],l*=d[1];let p=i-a,y=s-l;const v=r+h>e?e-h:r,w=o+c>t?t-c:o,E=g[3]+v*d[0]+g[1],b=g[0]+w*d[1]+g[2],x=p-g[3],C=y-g[0];(_||u!==0)&&(Gt[0]=x,Ut[0]=x,Gt[1]=C,bt[1]=C,bt[0]=x+E,St[0]=bt[0],St[1]=C+b,Ut[1]=St[1]);let R;return u!==0?(R=Pt(ot(),i,s,1,1,u,-i,-s),ye(R,Gt),ye(R,bt),ye(R,St),ye(R,Ut),kt(Math.min(Gt[0],bt[0],St[0],Ut[0]),Math.min(Gt[1],bt[1],St[1],Ut[1]),Math.max(Gt[0],bt[0],St[0],Ut[0]),Math.max(Gt[1],bt[1],St[1],Ut[1]),Ni)):kt(Math.min(x,x+E),Math.min(C,C+b),Math.max(x,x+E),Math.max(C,C+b),Ni),f&&(p=Math.round(p),y=Math.round(y)),{drawImageX:p,drawImageY:y,drawImageW:v,drawImageH:w,originX:h,originY:c,declutterBox:{minX:Ni[0],minY:Ni[1],maxX:Ni[2],maxY:Ni[3],value:m},canvasTransform:R,scale:d}}replayImageOrLabel_(e,t,i,s,r,o,a){const l=!!(o||a),h=s.declutterBox,c=a?a[2]*s.scale[0]/2:0;return h.minX-c<=t[0]&&h.maxX+c>=0&&h.minY-c<=t[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(e,Gt,bt,St,Ut,o,a),Wf(e,s.canvasTransform,r,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=ye(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;e.save(),e.translate(i[0]%s,i[1]%s),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],t[1]&&(e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6]))}drawLabelWithPointPlacement_(e,t,i,s){const r=this.textStates[t],o=this.createLabel(e,t,s,i),a=this.strokeStates[i],l=this.pixelRatio,h=no(Array.isArray(e)?e[0]:e,r.textAlign||is),c=ir[r.textBaseline||Js],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*r.scale[0],f=h*d+2*(.5-h)*u,g=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:f,anchorY:g}}execute_(e,t,i,s,r,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&ei(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=Zt(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),qd(this.renderedTransform_,i));let u=0;const d=s.length;let f=0,g,_,m,p,y,v,w,E,b,x,C,R,I,G=0,P=0;const A=this.coordinateCache_,k=this.viewRotation_,V=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,F={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:k},B=this.instructions!=s||this.overlaps?0:200;let D,X,Y,ie;for(;u<d;){const T=s[u];switch(T[0]){case L.BEGIN_GEOMETRY:D=T[1],ie=T[3],D.getGeometry()?a!==void 0&&!Oe(a,ie.getExtent())?u=T[2]+1:++u:u=T[2],h&&(h.zIndex=T[4]);break;case L.BEGIN_PATH:G>B&&(this.fill_(e),G=0),P>B&&(e.stroke(),P=0),!G&&!P&&(e.beginPath(),y=NaN,v=NaN),++u;break;case L.CIRCLE:f=T[1];const Te=c[f],ue=c[f+1],Ne=c[f+2],Se=c[f+3],ut=Ne-Te,et=Se-ue,je=Math.sqrt(ut*ut+et*et);e.moveTo(Te+je,ue),e.arc(Te,ue,je,0,2*Math.PI,!0),++u;break;case L.CLOSE_PATH:e.closePath(),++u;break;case L.CUSTOM:f=T[1],g=T[2];const xs=T[3],Nr=T[4],Rn=T[5];F.geometry=xs,F.feature=D,u in A||(A[u]=[]);const ii=A[u];Rn?Rn(c,f,g,2,ii):(ii[0]=c[f],ii[1]=c[f+1],ii.length=2),h&&(h.zIndex=T[6]),Nr(ii,F),++u;break;case L.DRAW_IMAGE:f=T[1],g=T[2],b=T[3],_=T[4],m=T[5];let Ke=T[6];const dt=T[7],ki=T[8],Pi=T[9],Tn=T[10];let ni=T[11];const Li=T[12];let Mi=T[13];p=T[14]||"declutter";const me=T[15];if(!b&&T.length>=20){x=T[19],C=T[20],R=T[21],I=T[22];const Ve=this.drawLabelWithPointPlacement_(x,C,R,I);b=Ve.label,T[3]=b;const si=T[23];_=(Ve.anchorX-si)*this.pixelRatio,T[4]=_;const Xe=T[24];m=(Ve.anchorY-Xe)*this.pixelRatio,T[5]=m,Ke=b.height,T[6]=Ke,Mi=b.width,T[13]=Mi}let jr;T.length>25&&(jr=T[25]);let Gr,Cs,Rs;T.length>17?(Gr=T[16],Cs=T[17],Rs=T[18]):(Gr=pi,Cs=null,Rs=null),Tn&&V?ni+=k:!Tn&&!V&&(ni-=k);let Ju=0;for(;f<g;f+=2){if(jr&&jr[Ju++]<Mi/this.pixelRatio)continue;const Ve=this.calculateImageOrLabelDimensions_(b.width,b.height,c[f],c[f+1],Mi,Ke,_,m,ki,Pi,ni,Li,r,Gr,!!Cs||!!Rs,D),si=[e,t,b,Ve,dt,Cs,Rs];if(l){let Xe,ft,Ye;if(me){const ae=g-f;if(!me[ae]){me[ae]={args:si,declutterMode:p};continue}const Ie=me[ae];Xe=Ie.args,ft=Ie.declutterMode,delete me[ae],Ye=ql(Xe)}let wt,vt;if(Xe&&(ft!=="declutter"||!l.collides(Ye))&&(wt=!0),(p!=="declutter"||!l.collides(Ve.declutterBox))&&(vt=!0),ft==="declutter"&&p==="declutter"){const ae=wt&&vt;wt=ae,vt=ae}wt&&(ft!=="none"&&l.insert(Ye),this.replayImageOrLabel_.apply(this,Xe)),vt&&(p!=="none"&&l.insert(Ve.declutterBox),this.replayImageOrLabel_.apply(this,si))}else this.replayImageOrLabel_.apply(this,si)}++u;break;case L.DRAW_CHARS:const ol=T[1],al=T[2],Ur=T[3],Qu=T[4];I=T[5];const ed=T[6],ll=T[7],hl=T[8];R=T[9];const $r=T[10];x=T[11],Array.isArray(x)&&(x=x.reduce(Rg,"")),C=T[12];const cl=[T[13],T[13]];p=T[14]||"declutter";const td=T[15],Br=this.textStates[C],In=Br.font,An=[Br.scale[0]*ll,Br.scale[1]*ll];let On;In in this.widths_?On=this.widths_[In]:(On={},this.widths_[In]=On);const ul=Ta(c,ol,al,2),dl=Math.abs(An[0])*Nl(In,x,On);if(Qu||dl<=ul){const Ve=this.textStates[C].textAlign,si=(ul-dl)*no(x,Ve),Xe=xg(c,ol,al,2,x,si,ed,Math.abs(An[0]),Nl,In,On,V?0:this.viewRotation_,td);e:if(Xe){const ft=[];let Ye,wt,vt,ae,Ie;if(R)for(Ye=0,wt=Xe.length;Ye<wt;++Ye){Ie=Xe[Ye],vt=Ie[4],ae=this.createLabel(vt,C,"",R),_=Ie[2]+(An[0]<0?-$r:$r),m=Ur*ae.height+(.5-Ur)*2*$r*An[1]/An[0]-hl;const Et=this.calculateImageOrLabelDimensions_(ae.width,ae.height,Ie[0],Ie[1],ae.width,ae.height,_,m,0,0,Ie[3],cl,!1,pi,!1,D);if(l&&p==="declutter"&&l.collides(Et.declutterBox))break e;ft.push([e,t,ae,Et,1,null,null])}if(I)for(Ye=0,wt=Xe.length;Ye<wt;++Ye){Ie=Xe[Ye],vt=Ie[4],ae=this.createLabel(vt,C,I,""),_=Ie[2],m=Ur*ae.height-hl;const Et=this.calculateImageOrLabelDimensions_(ae.width,ae.height,Ie[0],Ie[1],ae.width,ae.height,_,m,0,0,Ie[3],cl,!1,pi,!1,D);if(l&&p==="declutter"&&l.collides(Et.declutterBox))break e;ft.push([e,t,ae,Et,1,null,null])}l&&p!=="none"&&l.load(ft.map(ql));for(let Et=0,id=ft.length;Et<id;++Et)this.replayImageOrLabel_.apply(this,ft[Et])}}++u;break;case L.END_GEOMETRY:if(o!==void 0){D=T[1];const Ve=o(D,ie,p);if(Ve)return Ve}++u;break;case L.FILL:B?G++:this.fill_(e),++u;break;case L.MOVE_TO_LINE_TO:for(f=T[1],g=T[2],X=c[f],Y=c[f+1],e.moveTo(X,Y),y=X+.5|0,v=Y+.5|0,f+=2;f<g;f+=2)X=c[f],Y=c[f+1],w=X+.5|0,E=Y+.5|0,(f==g-2||w!==y||E!==v)&&(e.lineTo(X,Y),y=w,v=E);++u;break;case L.SET_FILL_STYLE:this.alignAndScaleFill_=T[2],G&&(this.fill_(e),G=0,P&&(e.stroke(),P=0)),e.fillStyle=T[1],++u;break;case L.SET_STROKE_STYLE:P&&(e.stroke(),P=0),this.setStrokeStyle_(e,T),++u;break;case L.STROKE:B?P++:e.stroke(),++u;break;default:++u;break}}G&&this.fill_(e),P&&e.stroke()}execute(e,t,i,s,r,o){this.viewRotation_=s,this.execute_(e,t,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,i,s,r){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,s,r)}}const di=["Polygon","Circle","LineString","Image","Text","Default"],Yc=["Image","Text"],Ig=di.filter(n=>!Yc.includes(n));class Ag{constructor(e,t,i,s,r,o,a){this.maxExtent_=e,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=ot(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let s=this.executorsByZIndex_[i];s===void 0&&(s={},this.executorsByZIndex_[i]=s);const r=e[i];for(const o in r){const a=r[o];s[o]=new Tg(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let s=0,r=e.length;s<r;++s)if(e[s]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,s,r,o){s=Math.round(s);const a=s*2+1,l=Pt(this.hitDetectionTransform_,s+.5,s+.5,1/t,-1/t,-i,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=_e(a,a));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Qe(),zn(u,e),sa(u,t*(this.renderBuffer_+s),u));const d=Og(s);let f;function g(E,b,x){const C=c.getImageData(0,0,a,a).data;for(let R=0,I=d.length;R<I;R++)if(C[d[R]]>0){if(!o||x==="none"||f!=="Image"&&f!=="Text"||o.includes(E)){const G=(d[R]-3)/4,P=s-G%a,A=s-(G/a|0),k=r(E,b,P*P+A*A);if(k)return k}c.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(It);let m,p,y,v,w;for(m=_.length-1;m>=0;--m){const E=_[m].toString();for(y=this.executorsByZIndex_[E],p=di.length-1;p>=0;--p)if(f=di[p],v=y[f],v!==void 0&&(w=v.executeHitDetection(c,l,i,g,u),w))return w}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],s=t[1],r=t[2],o=t[3],a=[i,s,i,o,r,o,r,s];return Zt(a,0,8,2,e,a),a}isEmpty(){return bi(this.executorsByZIndex_)}execute(e,t,i,s,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?sd:It),o=o||di;const h=di.length;for(let c=0,u=l.length;c<u;++c){const d=l[c].toString(),f=this.executorsByZIndex_[d];for(let g=0,_=o.length;g<_;++g){const m=o[g],p=f[m];if(p!==void 0){const y=a===null?void 0:p.getZIndexContext(),v=y?y.getContext():e,w=this.maxExtent_&&m!=="Image"&&m!=="Text";if(w&&(v.save(),this.clip(v,i)),!y||m==="Text"||m==="Image"?p.execute(v,t,i,s,r,a):y.pushFunction(E=>p.execute(E,t,i,s,r,a)),w&&v.restore(),y){y.offset();const E=l[c]*h+di.indexOf(m);this.deferredZIndexContexts_[E]||(this.deferredZIndexContexts_[E]=[]),this.deferredZIndexContexts_[E].push(y)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(It);for(let i=0,s=t.length;i<s;++i)e[t[i]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),e[t[i]].length=0}}const so={};function Og(n){if(so[n]!==void 0)return so[n];const e=n*2+1,t=n*n,i=new Array(t+1);for(let r=0;r<=n;++r)for(let o=0;o<=n;++o){const a=r*r+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((n+r)*e+(n+o))*4+3),r>0&&l.push(((n-r)*e+(n+o))*4+3),o>0&&(l.push(((n+r)*e+(n-o))*4+3),r>0&&l.push(((n-r)*e+(n-o))*4+3))}const s=[];for(let r=0,o=i.length;r<o;++r)i[r]&&s.push(...i[r]);return so[n]=s,s}function Zl(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class ws extends Tr{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,s=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:s,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;Q(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||Z(o)),Q(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Q(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=K.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?K.LOADED:K.IDLE:l=K.LOADING:l=K.LOADED),this.color_=e.color!==void 0?_n(e.color):null,this.iconImage_=Pa(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let h,c;if(e.size)[h,c]=e.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(Zl(f[0],f[1],e.width,e.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(Zl(h,c,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new ws({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=s[0]),this.anchorYUnits_=="fraction"&&(e[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+s[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==K.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==K.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(z.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(z.CHANGE,e)}ready(){return this.iconImage_.ready()}}const gt=.5;function kg(n,e,t,i,s,r,o,a,l){const h=s,c=n[0]*gt,u=n[1]*gt,d=_e(c,u);d.imageSmoothingEnabled=!1;const f=d.canvas,g=new Vf(d,gt,s,null,o,a,null),_=t.length,m=Math.floor((256*256*256-1)/_),p={};for(let v=1;v<=_;++v){const w=t[v-1],E=w.getStyleFunction()||i;if(!E)continue;let b=E(w,r);if(!b)continue;Array.isArray(b)||(b=[b]);const C=(v*m).toString(16).padStart(7,"#00000");for(let R=0,I=b.length;R<I;++R){const G=b[R],P=G.getGeometryFunction()(w);if(!P||!Oe(h,P.getExtent()))continue;const A=G.clone(),k=A.getFill();k&&k.setColor(C);const V=A.getStroke();V&&(V.setColor(C),V.setLineDash(null)),A.setText(void 0);const F=G.getImage();if(F){const Y=F.getImageSize();if(!Y)continue;const ie=_e(Y[0],Y[1],void 0,{alpha:!1}),T=ie.canvas;ie.fillStyle=C,ie.fillRect(0,0,T.width,T.height),A.setImage(new ws({img:T,anchor:F.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:F.getOrigin(),opacity:1,size:F.getSize(),scale:F.getScale(),rotation:F.getRotation(),rotateWithView:F.getRotateWithView()}))}const B=A.getZIndex()||0;let D=p[B];D||(D={},p[B]=D,D.Polygon=[],D.Circle=[],D.LineString=[],D.Point=[]);const X=P.getType();if(X==="GeometryCollection"){const Y=P.getGeometriesArrayRecursive();for(let ie=0,T=Y.length;ie<T;++ie){const be=Y[ie];D[be.getType().replace("Multi","")].push(be,A)}}else D[X.replace("Multi","")].push(P,A)}}const y=Object.keys(p).map(Number).sort(It);for(let v=0,w=y.length;v<w;++v){const E=p[y[v]];for(const b in E){const x=E[b];for(let C=0,R=x.length;C<R;C+=2){g.setStyle(x[C+1]);for(let I=0,G=e.length;I<G;++I)g.setTransform(e[I]),g.drawGeometry(x[C])}}}return d.getImageData(0,0,f.width,f.height)}function Pg(n,e,t){const i=[];if(t){const s=Math.floor(Math.round(n[0])*gt),r=Math.floor(Math.round(n[1])*gt),o=(oe(s,0,t.width-1)+oe(r,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],c=t.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/e.length);c&&c%u===0&&i.push(e[c/u-1])}return i}class qc extends Mt{constructor(e,t,i,s){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=s}}const Lg=5;class Mg extends gs{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=Lg}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return $()}getData(e){return null}prepareFrame(e){return $()}renderFrame(e,t){return $()}forEachFeatureAtCoordinate(e,t,i,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===K.LOADED||t.getState()===K.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=K.LOADED&&t!=K.ERROR&&e.addEventListener(z.CHANGE,this.boundHandleImageChange_),t==K.IDLE&&(e.load(),t=e.getState()),t==K.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Jl=[];let Hi=null;function Dg(){Hi=_e(1,1,void 0,{willReadFrequently:!0})}class Hc extends Mg{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=ot(),this.pixelTransform=ot(),this.inversePixelTransform=ot(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,i){Hi||Dg(),Hi.clearRect(0,0,1,1);let s;try{Hi.drawImage(e,t,i,1,1,0,0,1,1),s=Hi.getImageData(0,0,1,1).data}catch{return Hi=null,null}return s}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const s=this.getLayer().getClassName();let r,o;if(e&&e.className===s&&(!i||e&&e.style.backgroundColor&&ei(_n(e.style.backgroundColor),_n(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&Qd(o.canvas.style.transform,t)?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=_e();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const s=Ti(i),r=mr(i),o=_r(i),a=gr(i);ye(t.coordinateToPixelTransform,s),ye(t.coordinateToPixelTransform,r),ye(t.coordinateToPixelTransform,o),ye(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;ye(l,s),ye(l,r),ye(l,o),ye(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const i=e.extent,s=e.viewState.resolution,r=e.viewState.rotation,o=e.pixelRatio,a=Math.round(te(i)/s*o),l=Math.round(ke(i)/s*o);Pt(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/o,1/o,r,-a/2,-l/2),pc(this.inversePixelTransform,this.pixelTransform);const h=Jd(this.pixelTransform);if(this.useContainer(t,h,this.getBackground(e)),!this.containerReused){const c=this.context.canvas;c.width!=a||c.height!=l?(c.width=a,c.height=l):this.context.clearRect(0,0,a,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(e,t,i){const s=this.getLayer();if(s.hasListener(e)){const r=new qc(e,this.inversePixelTransform,i,t);s.dispatchEvent(r)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(He.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(He.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new Xc),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(He.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(He.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,s,r,o,a){const l=r/2,h=o/2,c=s/t,u=-c,d=-e[0]+a,f=-e[1];return Pt(this.tempTransform,l,h,c,u,-i,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class Fg extends Hc{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Qe(),this.wrappedRenderedExtent_=Qe(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,i){const s=t.extent,r=t.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),f=t.pixelRatio,g=t.viewHints,_=!(g[Re.ANIMATING]||g[Re.INTERACTING]),m=this.context,p=Math.round(te(s)/a*f),y=Math.round(ke(s)/a*f),v=u.getWrapX()&&l.canWrapX(),w=v?te(c):null,E=v?Math.ceil((s[2]-c[2])/w)+1:1;let b=v?Math.floor((s[0]-c[0])/w):0;do{let x=this.getRenderTransform(o,a,0,f,p,y,b*w);t.declutter&&(x=x.slice(0)),e.execute(m,[m.canvas.width,m.canvas.height],x,h,_,i===void 0?di:i?Yc:Ig,i?d&&t.declutter[d]:void 0)}while(++b<E)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=_e(this.context.canvas.width,this.context.canvas.height,Jl))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,xr(this.context),Jl.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex];this.opacity_=i.opacity;const s=e.viewState;this.prepareContainer(e,t);const r=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(He.PRERENDER)||this.getLayer().hasListener(He.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(r,e),s.projection,this.clipped_=!1,a&&i.extent&&this.clipping){const l=Xt(i.extent);a=Oe(l,e.extent),this.clipped_=a&&!tn(l,e.extent),this.clipped_&&this.clipUnrotated(r,e,l)}return a&&this.renderWorlds(o,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&r.restore(),this.postRender(r,e),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=i[0]*gt,d=i[1]*gt;c.push(this.getRenderTransform(s,r,o,gt,u,d,0).slice());const f=h.getSource(),g=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!tn(g,l)){let _=l[0];const m=te(g);let p=0,y;for(;_<g[0];)--p,y=m*p,c.push(this.getRenderTransform(s,r,o,gt,u,d,y).slice()),_+=m;for(p=0,_=l[2];_>g[2];)++p,y=m*p,c.push(this.getRenderTransform(s,r,o,gt,u,d,y).slice()),_-=m}this.hitDetectionImageData_=kg(i,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o,jl(r,this.renderedPixelRatio_))}t(Pg(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,s,r){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},c=function(d,f,g){const _=Z(d),m=h[_];if(m){if(m!==!0&&g<m.distanceSq){if(g===0)return h[_]=!0,r.splice(r.lastIndexOf(m),1),s(d,l,f);m.geometry=f,m.distanceSq=g}}else{if(g===0)return h[_]=!0,s(d,l,f);r.push(h[_]={feature:d,layer:l,geometry:f,distanceSq:g,callback:s})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a,i,c,u?t.declutter?.[u]?.all().map(d=>d.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const s=e.viewHints[Re.ANIMATING],r=e.viewHints[Re.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,c=h.projection,u=h.resolution,d=e.pixelRatio,f=t.getRevision(),g=t.getRenderBuffer();let _=t.getRenderOrder();_===void 0&&(_=Yf);const m=h.center.slice(),p=sa(l,g*u),y=p.slice(),v=[p.slice()],w=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!tn(w,e.extent)){const k=te(w),V=Math.max(te(p)/2,k);p[0]=w[0]-V,p[2]=w[2]+V,hc(m,c);const F=oc(v[0],c);F[0]<w[0]&&F[2]<w[2]?v.push([F[0]+k,F[1],F[2]+k,F[3]]):F[0]>w[0]&&F[2]>w[2]&&v.push([F[0]-k,F[1],F[2]-k,F[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==_&&this.renderedFrameDeclutter_===!!e.declutter&&tn(this.wrappedRenderedExtent_,p))return ei(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const E=new Sg(Uc(u,d),p,u,d);let b;for(let k=0,V=v.length;k<V;++k)i.loadFeatures(v[k],u,c);const x=jl(u,d);let C=!0;const R=(k,V)=>{let F;const B=k.getStyleFunction()||t.getStyleFunction();if(B&&(F=B(k,u)),F){const D=this.renderFeature(k,x,F,E,b,this.getLayer().getDeclutter(),V);C=C&&!D}},I=mc(p),G=i.getFeaturesInExtent(I);_&&G.sort(_);for(let k=0,V=G.length;k<V;++k)R(G[k],k);this.renderedFeatures_=G,this.ready=C;const P=E.finish(),A=new Ag(p,u,d,i.getOverlaps(),P,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=_,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=p,this.renderedCenter_=m,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=A,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,s,r,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,c=i.length;h<c;++h)l=Gl(s,e,i[h],t,this.boundHandleStyleImageChange_,r,o,a)||l;else l=Gl(s,e,i,t,this.boundHandleStyleImageChange_,r,o,a);return l}}let Oi=0;const Ae=1<<Oi++,q=1<<Oi++,Me=1<<Oi++,rt=1<<Oi++,Ci=1<<Oi++,jn=1<<Oi++,Fs=Math.pow(2,Oi)-1,Fa={[Ae]:"boolean",[q]:"number",[Me]:"string",[rt]:"color",[Ci]:"number[]",[jn]:"size"},Ng=Object.keys(Fa).map(Number).sort(It);function jg(n){return n in Fa}function Gn(n){const e=[];for(const t of Ng)Un(n,t)&&e.push(Fa[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function Un(n,e){return(n&e)===e}function $t(n,e){return n===e}class ge{constructor(e,t){if(!jg(e))throw new Error(`literal expressions must have a specific type, got ${Gn(e)}`);this.type=e,this.value=t}}class Gg{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function Zc(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Ee(n,e,t){switch(typeof n){case"boolean":{if($t(e,Me))return new ge(Me,n?"true":"false");if(!Un(e,Ae))throw new Error(`got a boolean, but expected ${Gn(e)}`);return new ge(Ae,n)}case"number":{if($t(e,jn))return new ge(jn,Fe(n));if($t(e,Ae))return new ge(Ae,!!n);if($t(e,Me))return new ge(Me,n.toString());if(!Un(e,q))throw new Error(`got a number, but expected ${Gn(e)}`);return new ge(q,n)}case"string":{if($t(e,rt))return new ge(rt,Oa(n));if($t(e,Ae))return new ge(Ae,!!n);if(!Un(e,Me))throw new Error(`got a string, but expected ${Gn(e)}`);return new ge(Me,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return Hg(n,e,t);for(const i of n)if(typeof i!="number")throw new Error("expected an array of numbers");if($t(e,jn)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new ge(jn,n)}if($t(e,rt)){if(n.length===3)return new ge(rt,[...n,1]);if(n.length===4)return new ge(rt,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!Un(e,Ci))throw new Error(`got an array of numbers, but expected ${Gn(e)}`);return new ge(Ci,n)}const S={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Ug={[S.Get]:U(W(1,1/0),Ql),[S.Var]:U(W(1,1),$g),[S.Has]:U(W(1,1/0),Ql),[S.Id]:U(Bg,ji),[S.Concat]:U(W(2,1/0),J(Me)),[S.GeometryType]:U(zg,ji),[S.LineMetric]:U(ji),[S.Resolution]:U(ro,ji),[S.Zoom]:U(ro,ji),[S.Time]:U(ro,ji),[S.Any]:U(W(2,1/0),J(Ae)),[S.All]:U(W(2,1/0),J(Ae)),[S.Not]:U(W(1,1),J(Ae)),[S.Equal]:U(W(2,2),J(Fs)),[S.NotEqual]:U(W(2,2),J(Fs)),[S.GreaterThan]:U(W(2,2),J(q)),[S.GreaterThanOrEqualTo]:U(W(2,2),J(q)),[S.LessThan]:U(W(2,2),J(q)),[S.LessThanOrEqualTo]:U(W(2,2),J(q)),[S.Multiply]:U(W(2,1/0),eh),[S.Coalesce]:U(W(2,1/0),eh),[S.Divide]:U(W(2,2),J(q)),[S.Add]:U(W(2,1/0),J(q)),[S.Subtract]:U(W(2,2),J(q)),[S.Clamp]:U(W(3,3),J(q)),[S.Mod]:U(W(2,2),J(q)),[S.Pow]:U(W(2,2),J(q)),[S.Abs]:U(W(1,1),J(q)),[S.Floor]:U(W(1,1),J(q)),[S.Ceil]:U(W(1,1),J(q)),[S.Round]:U(W(1,1),J(q)),[S.Sin]:U(W(1,1),J(q)),[S.Cos]:U(W(1,1),J(q)),[S.Atan]:U(W(1,2),J(q)),[S.Sqrt]:U(W(1,1),J(q)),[S.Match]:U(W(4,1/0),th,Kg),[S.Between]:U(W(3,3),J(q)),[S.Interpolate]:U(W(6,1/0),th,Vg),[S.Case]:U(W(3,1/0),Wg,Xg),[S.In]:U(W(2,2),Yg),[S.Number]:U(W(1,1/0),J(Fs)),[S.String]:U(W(1,1/0),J(Fs)),[S.Array]:U(W(1,1/0),J(q)),[S.Color]:U(W(1,4),J(q)),[S.Band]:U(W(1,3),J(q)),[S.Palette]:U(W(2,2),qg),[S.ToString]:U(W(1,1),J(Ae|q|Me|rt))};function Ql(n,e,t){const i=n.length-1,s=new Array(i);for(let r=0;r<i;++r){const o=n[r+1];switch(typeof o){case"number":{s[r]=new ge(q,o);break}case"string":{s[r]=new ge(Me,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}r===0&&t.properties.add(String(o))}return s}function $g(n,e,t){const i=n[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return t.variables.add(i),[new ge(Me,i)]}function Bg(n,e,t){t.featureId=!0}function zg(n,e,t){t.geometryType=!0}function ro(n,e,t){t.mapState=!0}function ji(n,e,t){const i=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function W(n,e){return function(t,i,s){const r=t[0],o=t.length-1;if(n===e){if(o!==n){const a=n===1?"":"s";throw new Error(`expected ${n} argument${a} for ${r}, got ${o}`)}}else if(o<n||o>e){const a=e===1/0?`${n} or more`:`${n} to ${e}`;throw new Error(`expected ${a} arguments for ${r}, got ${o}`)}}}function eh(n,e,t){const i=n.length-1,s=new Array(i);for(let r=0;r<i;++r){const o=Ee(n[r+1],e,t);s[r]=o}return s}function J(n){return function(e,t,i){const s=e.length-1,r=new Array(s);for(let o=0;o<s;++o){const a=Ee(e[o+1],n,i);r[o]=a}return r}}function Wg(n,e,t){const i=n[0],s=n.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${s} instead`)}function th(n,e,t){const i=n[0],s=n.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${s} instead`)}function Kg(n,e,t){const i=n.length-1,s=Me|q|Ae,r=Ee(n[1],s,t),o=Ee(n[n.length-1],e,t),a=new Array(i-2);for(let l=0;l<i-2;l+=2){try{const h=Ee(n[l+2],r.type,t);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=Ee(n[l+3],o.type,t);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[r,...a,o]}function Vg(n,e,t){const i=n[1];let s;switch(i[0]){case"linear":s=1;break;case"exponential":const l=i[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);s=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const r=new ge(q,s);let o;try{o=Ee(n[2],q,t)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(n.length-3);for(let l=0;l<a.length;l+=2){try{const h=Ee(n[l+3],q,t);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=Ee(n[l+4],e,t);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[r,o,...a]}function Xg(n,e,t){const i=Ee(n[n.length-1],e,t),s=new Array(n.length-1);for(let r=0;r<s.length-1;r+=2){try{const o=Ee(n[r+1],Ae,t);s[r]=o}catch(o){throw new Error(`failed to parse argument ${r} of case expression: ${o.message}`)}try{const o=Ee(n[r+2],i.type,t);s[r+1]=o}catch(o){throw new Error(`failed to parse argument ${r+1} of case expression: ${o.message}`)}}return s[s.length-1]=i,s}function Yg(n,e,t){let i=n[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],s=Me}else s=q;const r=new Array(i.length);for(let a=0;a<r.length;a++)try{const l=Ee(i[a],s,t);r[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[Ee(n[1],s,t),...r]}function qg(n,e,t){let i;try{i=Ee(n[1],q,t)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const s=n[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const r=new Array(s.length);for(let o=0;o<r.length;o++){let a;try{a=Ee(s[o],rt,t)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof ge))throw new Error(`the palette color at index ${o} must be a literal value`);r[o]=a}return[i,...r]}function U(...n){return function(e,t,i){const s=e[0];let r;for(let o=0;o<n.length;o++){const a=n[o](e,t,i);if(o==n.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");r=a}}return new Gg(t,s,...r)}}function Hg(n,e,t){const i=n[0],s=Ug[i];if(!s)throw new Error(`unknown operator: ${i}`);return s(n,e,t)}function Jc(n){if(!n)return"";const e=n.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Jc(n.getGeometries()[0]);default:return""}}function Qc(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Ft(n,e,t){const i=Ee(n,e,t);return ht(i)}function ht(n,e){if(n instanceof ge){if(n.type===rt&&typeof n.value=="string"){const i=Oa(n.value);return function(){return i}}return function(){return n.value}}const t=n.operator;switch(t){case S.Number:case S.String:case S.Coalesce:return Zg(n);case S.Get:case S.Var:case S.Has:return Jg(n);case S.Id:return i=>i.featureId;case S.GeometryType:return i=>i.geometryType;case S.Concat:{const i=n.args.map(s=>ht(s));return s=>"".concat(...i.map(r=>r(s).toString()))}case S.Resolution:return i=>i.resolution;case S.Any:case S.All:case S.Between:case S.In:case S.Not:return e_(n);case S.Equal:case S.NotEqual:case S.LessThan:case S.LessThanOrEqualTo:case S.GreaterThan:case S.GreaterThanOrEqualTo:return Qg(n);case S.Multiply:case S.Divide:case S.Add:case S.Subtract:case S.Clamp:case S.Mod:case S.Pow:case S.Abs:case S.Floor:case S.Ceil:case S.Round:case S.Sin:case S.Cos:case S.Atan:case S.Sqrt:return t_(n);case S.Case:return i_(n);case S.Match:return n_(n);case S.Interpolate:return s_(n);case S.ToString:return r_(n);default:throw new Error(`Unsupported operator ${t}`)}}function Zg(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ht(n.args[r]);switch(t){case S.Coalesce:return r=>{for(let o=0;o<i;++o){const a=s[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case S.Number:case S.String:return r=>{for(let o=0;o<i;++o){const a=s[o](r);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function Jg(n,e){const i=n.args[0].value;switch(n.operator){case S.Get:return s=>{const r=n.args;let o=s.properties[i];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;o=o[c]}return o};case S.Var:return s=>s.variables[i];case S.Has:return s=>{const r=n.args;if(!(i in s.properties))return!1;let o=s.properties[i];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;if(!o||!Object.hasOwn(o,c))return!1;o=o[c]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function Qg(n,e){const t=n.operator,i=ht(n.args[0]),s=ht(n.args[1]);switch(t){case S.Equal:return r=>i(r)===s(r);case S.NotEqual:return r=>i(r)!==s(r);case S.LessThan:return r=>i(r)<s(r);case S.LessThanOrEqualTo:return r=>i(r)<=s(r);case S.GreaterThan:return r=>i(r)>s(r);case S.GreaterThanOrEqualTo:return r=>i(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${t}`)}}function e_(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ht(n.args[r]);switch(t){case S.Any:return r=>{for(let o=0;o<i;++o)if(s[o](r))return!0;return!1};case S.All:return r=>{for(let o=0;o<i;++o)if(!s[o](r))return!1;return!0};case S.Between:return r=>{const o=s[0](r),a=s[1](r),l=s[2](r);return o>=a&&o<=l};case S.In:return r=>{const o=s[0](r);for(let a=1;a<i;++a)if(o===s[a](r))return!0;return!1};case S.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${t}`)}}function t_(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ht(n.args[r]);switch(t){case S.Multiply:return r=>{let o=1;for(let a=0;a<i;++a)o*=s[a](r);return o};case S.Divide:return r=>s[0](r)/s[1](r);case S.Add:return r=>{let o=0;for(let a=0;a<i;++a)o+=s[a](r);return o};case S.Subtract:return r=>s[0](r)-s[1](r);case S.Clamp:return r=>{const o=s[0](r),a=s[1](r);if(o<a)return a;const l=s[2](r);return o>l?l:o};case S.Mod:return r=>s[0](r)%s[1](r);case S.Pow:return r=>Math.pow(s[0](r),s[1](r));case S.Abs:return r=>Math.abs(s[0](r));case S.Floor:return r=>Math.floor(s[0](r));case S.Ceil:return r=>Math.ceil(s[0](r));case S.Round:return r=>Math.round(s[0](r));case S.Sin:return r=>Math.sin(s[0](r));case S.Cos:return r=>Math.cos(s[0](r));case S.Atan:return i===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case S.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${t}`)}}function i_(n,e){const t=n.args.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=ht(n.args[s]);return s=>{for(let r=0;r<t-1;r+=2)if(i[r](s))return i[r+1](s);return i[t-1](s)}}function n_(n,e){const t=n.args.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=ht(n.args[s]);return s=>{const r=i[0](s);for(let o=1;o<t-1;o+=2)if(r===i[o](s))return i[o+1](s);return i[t-1](s)}}function s_(n,e){const t=n.args.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=ht(n.args[s]);return s=>{const r=i[0](s),o=i[1](s);let a,l;for(let h=2;h<t;h+=2){const c=i[h](s);let u=i[h+1](s);const d=Array.isArray(u);if(d&&(u=Of(u)),c>=o)return h===2?u:d?o_(r,o,a,l,c,u):$n(r,o,a,l,c,u);a=c,l=u}return l}}function r_(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ht(n.args[r]);switch(t){case S.ToString:return r=>{const o=s[0](r);return n.args[0].type===rt?ka(o):o.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function $n(n,e,t,i,s,r){const o=s-t;if(o===0)return i;const a=e-t,l=n===1?a/o:(Math.pow(n,a)-1)/(Math.pow(n,o)-1);return i+l*(r-i)}function o_(n,e,t,i,s,r){if(s-t===0)return i;const a=Ll(i),l=Ll(r);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const c=[$n(n,e,t,a[0],s,l[0]),$n(n,e,t,a[1],s,l[1]),a[2]+$n(n,e,t,0,s,h),$n(n,e,t,i[3],s,r[3])];return kf(c)}function a_(n){return!0}function l_(n){const e=Zc(),t=h_(n,e),i=Qc();return function(s,r){if(i.properties=s.getPropertiesInternal(),i.resolution=r,e.featureId){const o=s.getId();o!==void 0?i.featureId=o:i.featureId=null}return e.geometryType&&(i.geometryType=Jc(s.getGeometry())),t(i)}}function ih(n){const e=Zc(),t=n.length,i=new Array(t);for(let o=0;o<t;++o)i[o]=Go(n[o],e);const s=Qc(),r=new Array(t);return function(o,a){if(s.properties=o.getPropertiesInternal(),s.resolution=a,e.featureId){const h=o.getId();h!==void 0?s.featureId=h:s.featureId=null}let l=0;for(let h=0;h<t;++h){const c=i[h](s);c&&(r[l]=c,l+=1)}return r.length=l,r}}function h_(n,e){const t=n.length,i=new Array(t);for(let s=0;s<t;++s){const r=n[s],o="filter"in r?Ft(r.filter,Ae,e):a_;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Go(r.style[h],e)}else a=[Go(r.style,e)];i[s]={filter:o,styles:a}}return function(s){const r=[];let o=!1;for(let a=0;a<t;++a){const l=i[a].filter;if(l(s)&&!(n[a].else&&o)){o=!0;for(const h of i[a].styles){const c=h(s);c&&r.push(c)}}}return r}}function Go(n,e){const t=ss(n,"",e),i=rs(n,"",e),s=c_(n,e),r=u_(n,e),o=De(n,"z-index",e);if(!t&&!i&&!s&&!r&&!bi(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const a=new We;return function(l){let h=!0;if(t){const c=t(l);c&&(h=!1),a.setFill(c)}if(i){const c=i(l);c&&(h=!1),a.setStroke(c)}if(s){const c=s(l);c&&(h=!1),a.setText(c)}if(r){const c=r(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function ss(n,e,t){let i;if(e+"fill-pattern-src"in n)i=__(n,e+"fill-",t);else{if(n[e+"fill-color"]==="none")return r=>null;i=Na(n,e+"fill-color",t)}if(!i)return null;const s=new lt;return function(r){const o=i(r);return o===Aa?null:(s.setColor(o),s)}}function rs(n,e,t){const i=De(n,e+"stroke-width",t),s=Na(n,e+"stroke-color",t);if(!i&&!s)return null;const r=Tt(n,e+"stroke-line-cap",t),o=Tt(n,e+"stroke-line-join",t),a=eu(n,e+"stroke-line-dash",t),l=De(n,e+"stroke-line-dash-offset",t),h=De(n,e+"stroke-miter-limit",t),c=new Dt;return function(u){if(s){const d=s(u);if(d===Aa)return null;c.setColor(d)}if(i&&c.setWidth(i(u)),r){const d=r(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function c_(n,e){const t="text-",i=Tt(n,t+"value",e);if(!i)return null;const s=ss(n,t,e),r=ss(n,t+"background-",e),o=rs(n,t,e),a=rs(n,t+"background-",e),l=Tt(n,t+"font",e),h=De(n,t+"max-angle",e),c=De(n,t+"offset-x",e),u=De(n,t+"offset-y",e),d=an(n,t+"overflow",e),f=Tt(n,t+"placement",e),g=De(n,t+"repeat",e),_=Or(n,t+"scale",e),m=an(n,t+"rotate-with-view",e),p=De(n,t+"rotation",e),y=Tt(n,t+"align",e),v=Tt(n,t+"justify",e),w=Tt(n,t+"baseline",e),E=an(n,t+"keep-upright",e),b=eu(n,t+"padding",e),x=kr(n,t+"declutter-mode"),C=new Ar({declutterMode:x});return function(R){if(C.setText(i(R)),s&&C.setFill(s(R)),r&&C.setBackgroundFill(r(R)),o&&C.setStroke(o(R)),a&&C.setBackgroundStroke(a(R)),l&&C.setFont(l(R)),h&&C.setMaxAngle(h(R)),c&&C.setOffsetX(c(R)),u&&C.setOffsetY(u(R)),d&&C.setOverflow(d(R)),f){const I=f(R);if(I!=="point"&&I!=="line")throw new Error("Expected point or line for text-placement");C.setPlacement(I)}if(g&&C.setRepeat(g(R)),_&&C.setScale(_(R)),m&&C.setRotateWithView(m(R)),p&&C.setRotation(p(R)),y){const I=y(R);if(I!=="left"&&I!=="center"&&I!=="right"&&I!=="end"&&I!=="start")throw new Error("Expected left, right, center, start, or end for text-align");C.setTextAlign(I)}if(v){const I=v(R);if(I!=="left"&&I!=="right"&&I!=="center")throw new Error("Expected left, right, or center for text-justify");C.setJustify(I)}if(w){const I=w(R);if(I!=="bottom"&&I!=="top"&&I!=="middle"&&I!=="alphabetic"&&I!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");C.setTextBaseline(I)}return b&&C.setPadding(b(R)),E&&C.setKeepUpright(E(R)),C}}function u_(n,e){return"icon-src"in n?d_(n,e):"shape-points"in n?f_(n,e):"circle-radius"in n?g_(n,e):null}function d_(n,e){const t="icon-",i=t+"src",s=tu(n[i],i),r=nr(n,t+"anchor",e),o=Or(n,t+"scale",e),a=De(n,t+"opacity",e),l=nr(n,t+"displacement",e),h=De(n,t+"rotation",e),c=an(n,t+"rotate-with-view",e),u=sh(n,t+"anchor-origin"),d=rh(n,t+"anchor-x-units"),f=rh(n,t+"anchor-y-units"),g=w_(n,t+"color"),_=p_(n,t+"cross-origin"),m=y_(n,t+"offset"),p=sh(n,t+"offset-origin"),y=sr(n,t+"width"),v=sr(n,t+"height"),w=m_(n,t+"size"),E=kr(n,t+"declutter-mode"),b=new ws({src:s,anchorOrigin:u,anchorXUnits:d,anchorYUnits:f,color:g,crossOrigin:_,offset:m,offsetOrigin:p,height:v,width:y,size:w,declutterMode:E});return function(x){return a&&b.setOpacity(a(x)),l&&b.setDisplacement(l(x)),h&&b.setRotation(h(x)),c&&b.setRotateWithView(c(x)),o&&b.setScale(o(x)),r&&b.setAnchor(r(x)),b}}function f_(n,e){const t="shape-",i=t+"points",s=t+"radius",r=Uo(n[i],i),o=Uo(n[s],s),a=ss(n,t,e),l=rs(n,t,e),h=Or(n,t+"scale",e),c=nr(n,t+"displacement",e),u=De(n,t+"rotation",e),d=an(n,t+"rotate-with-view",e),f=sr(n,t+"radius2"),g=sr(n,t+"angle"),_=kr(n,t+"declutter-mode"),m=new Ir({points:r,radius:o,radius2:f,angle:g,declutterMode:_});return function(p){return a&&m.setFill(a(p)),l&&m.setStroke(l(p)),c&&m.setDisplacement(c(p)),u&&m.setRotation(u(p)),d&&m.setRotateWithView(d(p)),h&&m.setScale(h(p)),m}}function g_(n,e){const t="circle-",i=ss(n,t,e),s=rs(n,t,e),r=De(n,t+"radius",e),o=Or(n,t+"scale",e),a=nr(n,t+"displacement",e),l=De(n,t+"rotation",e),h=an(n,t+"rotate-with-view",e),c=kr(n,t+"declutter-mode"),u=new Ai({radius:5,declutterMode:c});return function(d){return r&&u.setRadius(r(d)),i&&u.setFill(i(d)),s&&u.setStroke(s(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}function De(n,e,t){if(!(e in n))return;const i=Ft(n[e],q,t);return function(s){return Uo(i(s),e)}}function Tt(n,e,t){if(!(e in n))return null;const i=Ft(n[e],Me,t);return function(s){return tu(i(s),e)}}function __(n,e,t){const i=Tt(n,e+"pattern-src",t),s=nh(n,e+"pattern-offset",t),r=nh(n,e+"pattern-size",t),o=Na(n,e+"color",t);return function(a){return{src:i(a),offset:s&&s(a),size:r&&r(a),color:o&&o(a)}}}function an(n,e,t){if(!(e in n))return null;const i=Ft(n[e],Ae,t);return function(s){const r=i(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${e}`);return r}}function Na(n,e,t){if(!(e in n))return null;const i=Ft(n[e],rt,t);return function(s){return iu(i(s),e)}}function eu(n,e,t){if(!(e in n))return null;const i=Ft(n[e],Ci,t);return function(s){return vs(i(s),e)}}function nr(n,e,t){if(!(e in n))return null;const i=Ft(n[e],Ci,t);return function(s){const r=vs(i(s),e);if(r.length!==2)throw new Error(`Expected two numbers for ${e}`);return r}}function nh(n,e,t){if(!(e in n))return null;const i=Ft(n[e],Ci,t);return function(s){return nu(i(s),e)}}function Or(n,e,t){if(!(e in n))return null;const i=Ft(n[e],Ci|q,t);return function(s){return v_(i(s),e)}}function sr(n,e){const t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function m_(n,e){const t=n[e];if(t!==void 0){if(typeof t=="number")return Fe(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function p_(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function sh(n,e){const t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function rh(n,e){const t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function y_(n,e){const t=n[e];if(t!==void 0)return vs(t,e)}function kr(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function w_(n,e){const t=n[e];if(t!==void 0)return iu(t,e)}function vs(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const t=n.length;for(let i=0;i<t;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function tu(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function Uo(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function iu(n,e){if(typeof n=="string")return n;const t=vs(n,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function nu(n,e){const t=vs(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function v_(n,e){return typeof n=="number"?n:nu(n,e)}const tt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function oh(n,e,t){return function(i,s,r,o,a){if(!i)return;if(!s&&!e)return i;const l=e?0:r[0]*s,h=e?0:r[1]*s,c=a?a[0]:0,u=a?a[1]:0;let d=n[0]+l/2+c,f=n[2]-l/2+c,g=n[1]+h/2+u,_=n[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),g>_&&(g=(_+g)/2,_=g);let m=oe(i[0],d,f),p=oe(i[1],g,_);if(o&&t&&s){const y=30*s;m+=-y*Math.log(1+Math.max(0,d-i[0])/y)+y*Math.log(1+Math.max(0,i[0]-f)/y),p+=-y*Math.log(1+Math.max(0,g-i[1])/y)+y*Math.log(1+Math.max(0,i[1]-_)/y)}return[m,p]}}function E_(n){return n}function su(n){return Math.pow(n,3)}function En(n){return 1-su(1-n)}function b_(n){return 3*n*n-2*n*n*n}function S_(n){return n}function ja(n,e,t,i){const s=te(e)/t[0],r=ke(e)/t[1];return i?Math.min(n,Math.max(s,r)):Math.min(n,Math.min(s,r))}function Ga(n,e,t){let i=Math.min(n,e);const s=50;return i*=Math.log(1+s*Math.max(0,n/e-1))/s+1,t&&(i=Math.max(i,t),i/=Math.log(1+s*Math.max(0,t/n-1))/s+1),oe(i,t/2,e*2)}function x_(n,e,t,i){return e=e!==void 0?e:!0,function(s,r,o,a){if(s!==void 0){const l=n[0],h=n[n.length-1],c=t?ja(l,t,o,i):l;if(a)return e?Ga(s,c,h):oe(s,h,c);const u=Math.min(c,s),d=Math.floor(na(n,u,r));return n[d]>c&&d<n.length-1?n[d+1]:n[d]}}}function C_(n,e,t,i,s,r){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=s?ja(e,s,l,r):e;if(h)return i?Ga(o,c,t):oe(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(n)-u),f=-a*(.5-u)+.5,g=Math.min(c,o),_=Math.floor(Math.log(e/g)/Math.log(n)+f),m=Math.max(d,_),p=e/Math.pow(n,m);return oe(p,t,c)}}}function ah(n,e,t,i,s){return t=t!==void 0?t:!0,function(r,o,a,l){if(r!==void 0){const h=i?ja(n,i,a,s):n;return!t||!l?oe(r,e,h):Ga(r,h,e)}}}function Ua(n){if(n!==void 0)return 0}function lh(n){if(n!==void 0)return n}function R_(n){const e=2*Math.PI/n;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function T_(n){const e=Ht(5);return function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t}}const I_=42,$a=256,oo=0;class _t extends ct{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=ga(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&_c(),e.center&&(e.center=xt(e.center,this.projection_)),e.extent&&(e.extent=Xt(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in tt)delete t[a];this.setProperties(t,!0);const i=O_(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const s=A_(e),r=i.constraint,o=k_(e);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const s=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(s[3]-t[3]+t[1]-s[1]),a=r/2*(s[0]-t[0]+t[2]-s[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let s=arguments[i];s.center&&(s=Object.assign({},s),s.center=xt(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=xt(s.anchor,this.getProjection())),t[i]=s}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let s=0;for(;s<t&&!this.isDef();++s){const c=arguments[s];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(s===t){i&&Ns(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;s<t;++s){const c=arguments[s],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||b_,callback:i};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=rn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}P_(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Re.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Re.ANIMATING]>0}getInteracting(){return this.hints_[Re.INTERACTING]>0}cancelAnimations(){this.setHint(Re.ANIMATING,-this.hints_[Re.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const s=this.animations_[t];if(s[0].callback&&Ns(s[0].callback,!1),!e)for(let r=0,o=s.length;r<o;++r){const a=s[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let r=!0;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],g=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(g-d),p=f+u*(_-f);this.targetCenter_=[m,p]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?rn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(Re.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=s[0].callback;o&&Ns(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const s=this.getCenterInternal();return s!==void 0&&(i=[s[0]-t[0],s[1]-t[1]],la(i,e-this.getRotation()),yd(i,t)),i}calculateCenterZoom(e,t){let i;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-s[0])/r,a=t[1]-e*(t[1]-s[1])/r;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],s=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(s*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(s*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Po(e,this.getProjection())}getCenterInternal(){return this.get(tt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return mc(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();Q(t,"The view center is not defined");const i=this.getResolution();Q(i!==void 0,"The view resolution is not defined");const s=this.getRotation();return Q(s!==void 0,"The view rotation is not defined"),To(t,i,s,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(tt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Xt(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=te(e)/t[0],s=ke(e)/t[1];return Math.max(i,s)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(t/i)/Math.log(e);return function(r){return t/Math.pow(e,r*s)}}getRotation(){return this.get(tt.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(i/s)/t;return function(o){return Math.log(i/o)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();s=ao(s,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,i)}return{center:s.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,s;if(this.resolutions_){const r=na(this.resolutions_,e,1);t=r,i=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=i/this.resolutions_[r+1]}else i=this.maxResolution_,s=this.zoomFactor_;return t+Math.log(i/e)/Math.log(s)}getResolutionForZoom(e){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];const t=oe(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,oe(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(Q(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){Q(!pr(e),"Cannot fit empty extent provided as `geometry`");const s=Xt(e,this.getProjection());i=kl(s)}else if(e.getType()==="Circle"){const s=Xt(e.getExtent(),this.getProjection());i=kl(s),i.rotate(this.getRotation(),Jt(s))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),s=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=r.length;u<d;u+=o){const f=r[u]*i-r[u+1]*s,g=r[u]*s+r[u+1]*i;a=Math.min(a,f),l=Math.min(l,g),h=Math.max(h,f),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const s=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Jt(a);d[0]+=(s[1]-s[3])/2*l,d[1]+=(s[0]-s[2])/2*l;const f=d[0]*u-d[1]*c,g=d[1]*u+d[0]*c,_=this.getConstrainedCenter([f,g],l),m=t.callback?t.callback:Yn;t.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:t.duration,easing:t.easing},m):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),Ns(m,!0))}centerOn(e,t,i){this.centerOnInternal(xt(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(ao(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,s){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=ao(e,s,[a[0]/2+o[3],a[1]/2+o[0]],t,i);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Po(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&xt(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,s,i);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=xt(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(s,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&xt(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,s=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,s,r));this.get(tt.ROTATION)!==s&&this.set(tt.ROTATION,s),this.get(tt.RESOLUTION)!==o&&(this.set(tt.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(tt.CENTER)||!Vs(this.get(tt.CENTER),a))&&this.set(tt.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const s=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!Vs(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:e,easing:En,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Re.INTERACTING,1)}endInteraction(e,t,i){i=i&&xt(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(Re.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function Ns(n,e){setTimeout(function(){n(e)},0)}function A_(n){if(n.extent!==void 0){const t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return oh(n.extent,n.constrainOnlyCenter,t)}const e=ga(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,oh(t,!1,!1)}return E_}function O_(n){let e,t,i,o=n.minZoom!==void 0?n.minZoom:oo,a=n.maxZoom!==void 0?n.maxZoom:28;const l=n.zoomFactor!==void 0?n.zoomFactor:2,h=n.multiWorld!==void 0?n.multiWorld:!1,c=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,u=n.showFullExtent!==void 0?n.showFullExtent:!1,d=ga(n.projection,"EPSG:3857"),f=d.getExtent();let g=n.constrainOnlyCenter,_=n.extent;if(!h&&!_&&d.isGlobal()&&(g=!1,_=f),n.resolutions!==void 0){const m=n.resolutions;t=m[o],i=m[a]!==void 0?m[a]:m[m.length-1],n.constrainResolution?e=x_(m,c,!g&&_,u):e=ah(t,i,c,!g&&_,u)}else{const p=(f?Math.max(te(f),ke(f)):360*ha.degrees/d.getMetersPerUnit())/$a/Math.pow(2,oo),y=p/Math.pow(2,28-oo);t=n.maxResolution,t!==void 0?o=0:t=p/Math.pow(l,o),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=t/Math.pow(l,a):i=p/Math.pow(l,a):i=y),a=o+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,a-o),n.constrainResolution?e=C_(l,t,i,c,!g&&_,u):e=ah(t,i,c,!g&&_,u)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:l}}function k_(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const t=n.constrainRotation;return t===void 0||t===!0?T_():t===!1?lh:typeof t=="number"?R_(t):lh}return Ua}function P_(n){return!(n.sourceCenter&&n.targetCenter&&!Vs(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function ao(n,e,t,i,s){const r=Math.cos(-s);let o=Math.sin(-s),a=n[0]*r-n[1]*o,l=n[1]*r+n[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}const ee={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class ru extends ct{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[ee.OPACITY]=e.opacity!==void 0?e.opacity:1,Q(typeof t[ee.OPACITY]=="number","Layer opacity must be a number"),t[ee.VISIBLE]=e.visible!==void 0?e.visible:!0,t[ee.Z_INDEX]=e.zIndex,t[ee.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[ee.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[ee.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[ee.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=oe(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return $()}getLayerStatesArray(e){return $()}getExtent(){return this.get(ee.EXTENT)}getMaxResolution(){return this.get(ee.MAX_RESOLUTION)}getMinResolution(){return this.get(ee.MIN_RESOLUTION)}getMinZoom(){return this.get(ee.MIN_ZOOM)}getMaxZoom(){return this.get(ee.MAX_ZOOM)}getOpacity(){return this.get(ee.OPACITY)}getSourceState(){return $()}getVisible(){return this.get(ee.VISIBLE)}getZIndex(){return this.get(ee.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(ee.EXTENT,e)}setMaxResolution(e){this.set(ee.MAX_RESOLUTION,e)}setMinResolution(e){this.set(ee.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(ee.MAX_ZOOM,e)}setMinZoom(e){this.set(ee.MIN_ZOOM,e)}setOpacity(e){Q(typeof e=="number","Layer opacity must be a number"),this.set(ee.OPACITY,e)}setVisible(e){this.set(ee.VISIBLE,e)}setZIndex(e){this.set(ee.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class Pr extends ru{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(ee.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(ee.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(se(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=H(e,z.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof _t?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let s;if(t.layerStatesArray){if(s=t.layerStatesArray.find(o=>o.layer===this),!s)return!1}else s=this.getLayerState();const r=this.getExtent();return Ba(s,t.viewState)&&(!r||Oe(r,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];const t=this.getSource()?.getAttributions();if(!t)return[];const i=e instanceof _t?e.getViewStateAndExtent():e;let s=t(i);return Array.isArray(s)||(s=[s]),s}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(ee.MAP,e)}getMapInternal(){return this.get(ee.MAP)}setMap(e){this.mapPrecomposeKey_&&(se(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(se(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=H(e,He.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=H(this,z.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,i=this.getLayerState(!1);Q(!t.some(s=>s.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(i)}setSource(e){this.set(ee.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function Ba(n,e){if(!n.visible)return!1;const t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;const i=e.zoom;return i>n.minZoom&&i<=n.maxZoom}const hh={RENDER_ORDER:"renderOrder"};class ou extends Pr{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(hh.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new Wc(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(hh.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?Vc:e;const t=L_(e);this.styleFunction_=e===null?void 0:_g(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function L_(n){if(n===void 0)return Vc;if(!n)return null;if(typeof n=="function"||n instanceof We)return n;if(!Array.isArray(n))return ih([n]);if(n.length===0)return[];const e=n.length,t=n[0];if(t instanceof We){const s=new Array(e);for(let r=0;r<e;++r){const o=n[r];if(!(o instanceof We))throw new Error("Expected a list of style instances");s[r]=o}return s}if("style"in t){const s=new Array(e);for(let r=0;r<e;++r){const o=n[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");s[r]=o}return l_(s)}return ih(n)}class bn extends ou{constructor(e){super(e)}createRenderer(){return new Fg(this)}}const M={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class za extends fr{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(z.CHANGE)}release(){this.setState(M.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==M.EMPTY){if(this.state!==M.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){$()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const s=t-i+1e3/60;return s>=this.transition_?1:su(s/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class au extends za{constructor(e,t,i,s,r,o){super(e,t,o),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=M.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=M.ERROR,this.unlistenImage_(),this.image_=M_(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=M.LOADED:this.state=M.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==M.ERROR&&(this.state=M.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==M.IDLE&&(this.state=M.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Pf(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function M_(){const n=_e(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}class D_{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const s=this.points_[t+2]-this.points_[i+2];if(s<1e3/60)return!1;const r=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class Zi extends Mt{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class zt extends Zi{constructor(e,t,i,s,r,o){super(e,t,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const le={SINGLECLICK:"singleclick",CLICK:z.CLICK,DBLCLICK:z.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},$o={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class F_ extends fr{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=H(i,$o.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=H(i,$o.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(z.TOUCHMOVE,this.boundHandleTouchMove_,kc?{passive:!1}:!1)}emulateClick_(e){let t=new zt(le.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new zt(le.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new zt(le.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==le.POINTERUP||t.type==le.POINTERCANCEL){delete this.trackedTouches_[i];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==t.target){delete this.trackedTouches_[s];break}}else(t.type==le.POINTERDOWN||t.type==le.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new zt(le.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(se),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new zt(le.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(H(i,le.POINTERMOVE,this.handlePointerMove_,this),H(i,le.POINTERUP,this.handlePointerUp_,this),H(this.element_,le.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(H(this.element_.getRootNode(),le.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new zt(le.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new zt(le.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(se(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(z.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(se(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(se),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Ct={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Ce={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},rr=1/0;class N_{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,fs(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(e){Q(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=rr?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,s=t.length,r=t[e],o=i[e],a=e;for(;e<s>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<s&&i[h]<i[l]?h:l;t[e]=t[c],i[e]=i[c],e=c}t[e]=r,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,s=this.priorities_,r=i[t],o=s[t];for(;t>e;){const a=this.getParentIndex_(t);if(s[a]>o)i[t]=i[a],s[t]=s[a],t=a;else break}i[t]=r,s[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let s=0;const r=t.length;let o,a,l;for(a=0;a<r;++a)o=t[a],l=e(o),l==rr?delete this.queuedElements_[this.keyFunction_(o)]:(i[s]=l,t[s++]=o);t.length=s,i.length=s,this.heapify_()}}class j_ extends N_{constructor(e,t){super(i=>e.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(z.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===M.LOADED||i===M.ERROR||i===M.EMPTY){i!==M.ERROR&&t.removeEventListener(z.CHANGE,this.boundHandleTileChange_);const s=t.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;){const s=this.dequeue()[0],r=s.getKey();s.getState()===M.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++i,s.load())}}}function G_(n,e,t,i,s){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][e.getKey()])return rr;const r=n.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(s)+Math.sqrt(o*o+a*a)/s}class Wa extends ct{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let t=0,i=this.listenerKeys.length;t<i;++t)se(this.listenerKeys[t]);if(this.listenerKeys.length=0,this.map_=e,e){const t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==Yn&&this.listenerKeys.push(H(e,Ct.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class U_ extends Wa{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",s=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=s):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(z.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+Cr+" "+La+(this.collapsed_&&this.collapsible_?" "+Ml:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),i=new Set(t.flatMap(s=>s.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>i.add(s)):i.add(this.attributions_)),!this.overrideCollapsible_){const s=!t.some(r=>r.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(s)}return Array.from(i)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(s=>ad(()=>s))),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!ei(t,this.renderedAttributions_)){Pc(this.ulElement_);for(let s=0,r=t.length;s<r;++s){const o=document.createElement("li");o.innerHTML=t[s],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Ml),this.collapsed_?Pl(this.collapseLabel_,this.label_):Pl(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class $_ extends Wa{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"",s=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(s));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(z.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+Cr+" "+La,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Ps)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:En}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const s="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Ps);!r&&i===0?this.element.classList.add(Ps):r&&i!==0&&this.element.classList.remove(Ps)}this.label_.style.transform=s}this.rotation_=i}}class B_ extends Wa{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,s=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(z.CLICK,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(z.CLICK,this.handleClick_.bind(this,-i),!1);const d=t+" "+Cr+" "+La,f=this.element;f.className=d,f.appendChild(c),f.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const s=i.getZoom();if(s!==void 0){const r=i.getConstrainedZoom(s+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:En})):i.setZoom(r)}}}function z_(n){n=n||{};const e=new mt;return(n.zoom!==void 0?n.zoom:!0)&&e.push(new B_(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&e.push(new $_(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&e.push(new U_(n.attributionOptions)),e}const ch={ACTIVE:"active"};class Es extends ct{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(ch.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(ch.ACTIVE,e)}setMap(e){this.map_=e}}function W_(n,e,t){const i=n.getCenterInternal();if(i){const s=[i[0]+e[0],i[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:S_,center:n.getConstrainedCenter(s)})}}function Ka(n,e,t,i){const s=n.getZoom();if(s===void 0)return;const r=n.getConstrainedZoom(s+e),o=n.getResolutionForZoom(r);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:En})}class K_ extends Es{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==le.DBLCLICK){const i=e.originalEvent,s=e.map,r=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=s.getView();Ka(a,o,r,this.duration_),i.preventDefault(),t=!0}return!t}}function Bo(n){const e=arguments;return function(t){let i=!0;for(let s=0,r=e.length;s<r&&(i=i&&e[s](t),!!i);++s);return i}}const V_=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},X_=function(n){const e=n.map.getTargetElement(),t=e.getRootNode(),i=n.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(i):e.contains(i)},lu=function(n){const e=n.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?X_(n):!0},Y_=Xn,hu=function(n){const e=n.originalEvent;return"pointerId"in e&&e.button==0&&!(yf&&Ac&&e.ctrlKey)},cu=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},q_=function(n){const e=n.originalEvent;return Ac?e.metaKey:e.ctrlKey},H_=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},uu=function(n){const e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},lo=function(n){const e=n.originalEvent;return"pointerId"in e&&e.pointerType=="mouse"},Z_=function(n){const e=n.originalEvent;return"pointerId"in e&&e.isPrimary&&e.button===0};class bs extends Es{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==le.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==le.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==le.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==le.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function Va(n){const e=n.length;let t=0,i=0;for(let s=0;s<e;s++)t+=n[s].clientX,i+=n[s].clientY;return{clientX:t/e,clientY:i/e}}class J_ extends bs{constructor(e){super({stopDown:dr}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Bo(cu,Z_);this.condition_=e.onFocusOnly?Bo(lu,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,s=t.getEventPixel(Va(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],a=e.map.getView();wd(r,a.getResolution()),la(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-s*Math.cos(r),a[1]-s*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:En})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class Q_ extends bs{constructor(e){e=e||{},super({stopDown:dr}),this.condition_=e.condition?e.condition:V_,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!lo(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===Ua)return;const s=t.getSize(),r=e.pixel,o=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return lo(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return lo(e)&&hu(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class em extends ur{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",s=this.element_.style;s.left=Math.min(e[0],t[0])+i,s.top=Math.min(e[1],t[1])+i,s.width=Math.abs(t[0]-e[0])+i,s.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,s=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new Qt([s])}getGeometry(){return this.geometry_}}const Gi={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Dn extends Mt{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class tm extends bs{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new em(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??hu,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const s=i[0]-t[0],r=i[1]-t[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Dn(Gi.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Dn(t?Gi.BOXEND:Gi.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Dn(Gi.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Dn(Gi.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Dn(Gi.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class im extends tm{constructor(e){e=e||{};const t=e.condition?e.condition:H_;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(s),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;s=s.clone(),s.scale(a*a)}i.fitInternal(s,{duration:this.duration_,easing:En})}}const oi={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class nm extends Es{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return cu(t)&&uu(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==z.KEYDOWN){const i=e.originalEvent,s=i.key;if(this.condition_(e)&&(s==oi.DOWN||s==oi.LEFT||s==oi.RIGHT||s==oi.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;s==oi.DOWN?h=-a:s==oi.LEFT?l=-a:s==oi.RIGHT?l=a:h=a;const c=[l,h];la(c,o.getRotation()),W_(o,c,this.duration_),i.preventDefault(),t=!0}}return!t}}class sm extends Es{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!q_(t)&&uu(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==z.KEYDOWN||e.type==z.KEYPRESS){const i=e.originalEvent,s=i.key;if(this.condition_(e)&&(s==="+"||s==="-")){const r=e.map,o=s==="+"?this.delta_:-this.delta_,a=r.getView();Ka(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const rm=40,om=300;class am extends Es{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:Y_;this.condition_=e.onFocusOnly?Bo(lu,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==z.WHEEL)return!0;const i=e.map,s=e.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let r=s.deltaY;switch(s.deltaMode){case WheelEvent.DOM_DELTA_LINE:r*=rm;break;case WheelEvent.DOM_DELTA_PAGE:r*=om;break}if(r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-oe(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Ka(t,i,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class lm extends bs{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=dr),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-i.clientY,s.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==Ua&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Va(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class hm extends bs{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=dr),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],s=this.targetPointers[1],r=i.clientX-s.clientX,o=i.clientY-s.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Va(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),s=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function cm(n){n=n||{};const e=new mt,t=new D_(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&e.push(new Q_),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&e.push(new K_({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&e.push(new J_({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&e.push(new lm),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&e.push(new hm({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(e.push(new nm),e.push(new sm({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&e.push(new am({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&e.push(new im({duration:n.zoomDuration})),e}class Wt extends Mt{constructor(e,t){super(e),this.layer=t}}const ho={LAYERS:"layers"};class Sn extends ru{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(ho.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new mt(i.slice(),{unique:!0}):Q(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new mt(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(se),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(H(e,Pe.ADD,this.handleLayersAdd_,this),H(e,Pe.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(se);fs(this.listenerKeys_);const t=e.getArray();for(let i=0,s=t.length;i<s;i++){const r=t[i];this.registerLayerListeners_(r),this.dispatchEvent(new Wt("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[H(e,cn.PROPERTYCHANGE,this.handleLayerChange_,this),H(e,z.CHANGE,this.handleLayerChange_,this)];e instanceof Sn&&t.push(H(e,"addlayer",this.handleLayerGroupAdd_,this),H(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Z(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Wt("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Wt("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Wt("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=Z(t);this.listenerKeys_[i].forEach(se),delete this.listenerKeys_[i],this.dispatchEvent(new Wt("removelayer",t)),this.changed()}getLayers(){return this.get(ho.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let s=0,r=i.length;s<r;++s)this.dispatchEvent(new Wt("removelayer",i[s]))}this.set(ho.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const s=this.getLayerState();let r=s.zIndex;!e&&s.zIndex===void 0&&(r=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=s.opacity,l.visible=l.visible&&s.visible,l.maxResolution=Math.min(l.maxResolution,s.maxResolution),l.minResolution=Math.max(l.minResolution,s.minResolution),l.minZoom=Math.max(l.minZoom,s.minZoom),l.maxZoom=Math.min(l.maxZoom,s.maxZoom),s.extent!==void 0&&(l.extent!==void 0?l.extent=vi(l.extent,s.extent):l.extent=s.extent),l.zIndex===void 0&&(l.zIndex=r)}return t}getSourceState(){return"ready"}}class um extends ur{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){$()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,s=e.pixelToCoordinateTransform;Pt(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),pc(s,i)}forEachFeatureAtCoordinate(e,t,i,s,r,o,a,l){let h;const c=t.viewState;function u(w,E,b,x){return r.call(o,E,w?b:null,x)}const d=c.projection,f=hc(e.slice(),d),g=[[0,0]];if(d.canWrapX()&&s){const w=d.getExtent(),E=te(w);g.push([-E,0],[E,0])}const _=t.layerStatesArray,m=_.length,p=[],y=[];for(let w=0;w<g.length;w++)for(let E=m-1;E>=0;--E){const b=_[E],x=b.layer;if(x.hasRenderer()&&Ba(b,c)&&a.call(l,x)){const C=x.getRenderer(),R=x.getSource();if(C&&R){const I=R.getWrapX()?f:e,G=u.bind(null,b.managed);y[0]=I[0]+g[w][0],y[1]=I[1]+g[w][1],h=C.forEachFeatureAtCoordinate(y,t,i,G,p)}if(h)return h}}if(p.length===0)return;const v=1/p.length;return p.forEach((w,E)=>w.distanceSq+=E*v),p.sort((w,E)=>w.distanceSq-E.distanceSq),p.some(w=>h=w.callback(w.feature,w.layer,w.geometry)),h}hasFeatureAtCoordinate(e,t,i,s,r,o){return this.forEachFeatureAtCoordinate(e,t,i,s,Xn,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){$()}scheduleExpireIconCache(e){Ze.canExpireCache()&&e.postRenderFunctions.push(dm)}}function dm(n,e){Ze.expire()}class fm extends um{constructor(e){super(e),this.fontChangeListenerKey_=H(Yi,cn.PROPERTYCHANGE,e.redrawText,e),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Cr+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const s=new qc(e,void 0,t);i.dispatchEvent(s)}}disposeInternal(){se(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(He.PRECOMPOSE,e);const t=e.layerStatesArray.sort((a,l)=>a.zIndex-l.zIndex);t.some(a=>a.layer instanceof ou&&a.layer.getDeclutter())&&(e.declutter={});const s=e.viewState;this.children_.length=0;const r=[];let o=null;for(let a=0,l=t.length;a<l;++a){const h=t[a];e.layerIndex=a;const c=h.layer,u=c.getSourceState();if(!Ba(h,s)||u!="ready"&&u!="undefined"){c.unrender();continue}const d=c.render(e,o);d&&(d!==o&&(this.children_.push(d),o=d),r.push(h))}this.declutter(e,r),bf(this.element_,this.children_),this.dispatchRenderEvent(He.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let i=t.length-1;i>=0;--i){const s=t[i],r=s.layer;r.getDeclutter()&&r.renderDeclutter(e,s)}t.forEach(i=>i.layer.renderDeferred(e))}}}function du(n){if(n instanceof Pr){n.setMapInternal(null);return}n instanceof Sn&&n.getLayers().forEach(du)}function fu(n,e){if(n instanceof Pr){n.setMapInternal(e);return}if(n instanceof Sn){const t=n.getLayers().getArray();for(let i=0,s=t.length;i<s;++i)fu(t[i],e)}}let gm=class extends ct{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=_m(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:wf,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=ot(),this.pixelToCoordinateTransform_=ot(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||z_(),this.interactions=t.interactions||cm({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new j_(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Ce.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Ce.VIEW,this.handleViewChanged_),this.addChangeListener(Ce.SIZE,this.handleSizeChanged_),this.addChangeListener(Ce.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof _t)&&e.view.then(function(s){i.setView(new _t(s))}),this.controls.addEventListener(Pe.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(Pe.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(Pe.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(Pe.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(Pe.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(Pe.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){fu(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:Xn,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(s){i.push(s)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(s){s instanceof Sn?t(s.getLayers()):e.push(s)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const s=t.layerFilter!==void 0?t.layerFilter:Xn,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,s,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=i.width/s[0],o=i.height/s[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/r,(a.clientY-i.top)/o]}getTarget(){return this.get(Ce.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Po(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?ye(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Ce.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof mt){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const s=e[t];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const o=s.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=xt(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?ye(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Ce.SIZE)}getView(){return this.get(Ce.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,s){return G_(this.frameState_,e,t,i,s)}handleBrowserEvent(e,t){t=t||e.type;const i=new zt(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===$o.POINTERDOWN||i===z.WHEEL||i===z.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,o=t.target,a=r instanceof ShadowRoot?r.host===o?r.host.ownerDocument:r:r===s?s.documentElement:r;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const o=s[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let s=this.maxTilesLoading_,r=s;if(e){const o=e.viewHints;if(o[Re.ANIMATING]||o[Re.INTERACTING]){const a=Date.now()-e.time>8;s=a?0:8,r=a?0:2}}t.getTilesLoading()<s&&(t.reprioritize(),t.loadMoreTiles(s,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(He.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(He.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Zi(Ct.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Zi(Ct.LOADSTART,this,e))));const i=this.postRenderFunctions_;if(e)for(let s=0,r=i.length;s<r;++s)i[s](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,s=this.targetChangeHandlerKeys_.length;i<s;++i)se(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(z.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(z.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new fm(this)),this.mapBrowserEventHandler_=new F_(this,this.moveTolerance_);for(const r in le)this.mapBrowserEventHandler_.addEventListener(le[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(z.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(z.WHEEL,this.boundHandleBrowserEvent_,kc?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const r=t.getRootNode();i=r instanceof ShadowRoot?r.host:t}this.targetChangeHandlerKeys_=[H(i,z.KEYDOWN,this.handleBrowserEvent,this),H(i,z.KEYPRESS,this.handleBrowserEvent,this)];const s=t.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(se(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(se(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=H(e,cn.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=H(e,z.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(se),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Wt("addlayer",e)),this.layerGroupPropertyListenerKeys_=[H(e,cn.PROPERTYCHANGE,this.render,this),H(e,z.CHANGE,this.render,this),H(e,"addlayer",this.handleLayerAdd_,this),H(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const e=this.frameState_.layerStatesArray;for(let t=0,i=e.length;t<i;++t){const s=e[t].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){du(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),s=this.frameState_;let r=null;if(t!==void 0&&Kl(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:To(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Z(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=To(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!pr(this.previousExtent_)&&!qn(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Zi(Ct.MOVESTART,this,s)),this.previousExtent_=_s(this.previousExtent_)),this.previousExtent_&&!r.viewHints[Re.ANIMATING]&&!r.viewHints[Re.INTERACTING]&&!qn(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Zi(Ct.MOVEEND,this,r)),tc(r.extent,this.previousExtent_))),this.dispatchEvent(new Zi(Ct.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(Ct.LOADSTART)||this.hasListener(Ct.LOADEND)||this.hasListener(He.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Wt("removelayer",t)),this.set(Ce.LAYERGROUP,e)}setSize(e){this.set(Ce.SIZE,e)}setTarget(e){this.set(Ce.TARGET,e)}setView(e){if(!e||e instanceof _t){this.set(Ce.VIEW,e);return}this.set(Ce.VIEW,new _t);const t=this;e.then(function(i){t.setView(new _t(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const s=getComputedStyle(e),r=e.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=e.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[Math.max(0,r),Math.max(0,o)],!Kl(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&lc("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!ei(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function _m(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const t={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Sn({layers:n.layers});t[Ce.LAYERGROUP]=i,t[Ce.TARGET]=n.target,t[Ce.VIEW]=n.view instanceof _t?n.view:new _t;let s;n.controls!==void 0&&(Array.isArray(n.controls)?s=new mt(n.controls.slice()):(Q(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=n.controls));let r;n.interactions!==void 0&&(Array.isArray(n.interactions)?r=new mt(n.interactions.slice()):(Q(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=n.interactions));let o;return n.overlays!==void 0?Array.isArray(n.overlays)?o=new mt(n.overlays.slice()):(Q(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=n.overlays):o=new mt,{controls:s,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}const xe={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class mm extends ct{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+Nf,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(xe.ELEMENT,this.handleElementChanged),this.addChangeListener(xe.MAP,this.handleMapChanged),this.addChangeListener(xe.OFFSET,this.handleOffsetChanged),this.addChangeListener(xe.POSITION,this.handlePositionChanged),this.addChangeListener(xe.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(xe.ELEMENT)}getId(){return this.id}getMap(){return this.get(xe.MAP)||null}getOffset(){return this.get(xe.OFFSET)}getPosition(){return this.get(xe.POSITION)}getPositioning(){return this.get(xe.POSITIONING)}handleElementChanged(){Pc(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),se(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=H(e,Ct.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(xe.ELEMENT,e)}setMap(e){this.set(xe.MAP,e)}setOffset(e){this.set(xe.OFFSET,e)}setPosition(e){this.set(xe.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(xe.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),r=this.getRect(s,[vf(s),Ef(s)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!tn(i,r)){const a=r[0]-i[0],l=i[2]-r[2],h=r[1]-i[1],c=i[3]-r[3],u=[0,0];if(a<0?u[0]=a-o:l<0&&(u[0]=Math.abs(l)+o),h<0?u[1]=h-o:c<0&&(u[1]=Math.abs(c)+o),u[0]!==0||u[1]!==0){const d=t.getView().getCenterInternal(),f=t.getPixelFromCoordinateInternal(d);if(!f)return;const g=[f[0]+u[0],f[1]+u[1]],_=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(g),duration:_.duration,easing:_.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),s=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[s,r,s+t[0],r+t[1]]}setPositioning(e){this.set(xe.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(e,t){const i=this.element.style,s=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=`${e[0]+s[0]}px`,a=`${e[1]+s[1]}px`;let l="0%",h="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?h="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}class Xa{constructor(e,t,i,s){this.minX=e,this.maxX=t,this.minY=i,this.maxY=s}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Ui(n,e,t,i,s){return s!==void 0?(s.minX=n,s.maxX=e,s.minY=t,s.maxY=i,s):new Xa(n,e,t,i)}function zo(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}const pm=new Error("disposed"),ym=[256,256];class uh extends za{constructor(e){const t=M.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=zo(this.data_);return e?[e.width,e.height]:ym}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==M.IDLE&&this.state!==M.ERROR)return;this.state=M.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=M.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=M.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(pm),this.controller_=null),super.disposeInternal()}}let co;const ln=[];function dh(n,e,t,i,s){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(i,s),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,i)+1,Math.max(t,s)),n.restore()}function uo(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function wm(){if(co===void 0){const n=_e(6,6,ln);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",dh(n,4,5,4,0),dh(n,4,5,0,5);const e=n.getImageData(0,0,3,3).data;co=uo(e,0)||uo(e,4)||uo(e,8),xr(n),ln.push(n.canvas)}return co}function fh(n,e,t,i){const s=ma(t,e,n);let r=Cl(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=n.getMetersPerUnit();a!==void 0&&(r/=a);const l=n.getExtent();if(!l||un(l,s)){const h=Cl(n,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function vm(n,e,t,i){const s=Jt(t);let r=fh(n,e,s,i);return(!isFinite(r)||r<=0)&&aa(t,function(o){return r=fh(n,e,o,i),isFinite(r)&&r>0}),r}function Em(n,e,t,i,s,r,o,a,l,h,c,u,d,f){const g=_e(Math.round(t*n),Math.round(t*e),ln);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function _(E){return Math.round(E*t)/t}g.globalCompositeOperation="lighter";const m=Qe();l.forEach(function(E,b,x){nc(m,E.extent)});let p;const y=t/i,v=(u?1:1+Math.pow(2,-24))/y;p=_e(Math.round(te(m)*y),Math.round(ke(m)*y),ln),u||(p.imageSmoothingEnabled=!1),l.forEach(function(E,b,x){if(E.image.width>0&&E.image.height>0){if(E.clipExtent){p.save();const P=(E.clipExtent[0]-m[0])*y,A=-(E.clipExtent[3]-m[3])*y,k=te(E.clipExtent)*y,V=ke(E.clipExtent)*y;p.rect(u?P:Math.round(P),u?A:Math.round(A),u?k:Math.round(P+k)-Math.round(P),u?V:Math.round(A+V)-Math.round(A)),p.clip()}const C=(E.extent[0]-m[0])*y,R=-(E.extent[3]-m[3])*y,I=te(E.extent)*y,G=ke(E.extent)*y;p.drawImage(E.image,h,h,E.image.width-2*h,E.image.height-2*h,u?C:Math.round(C),u?R:Math.round(R),u?I:Math.round(C+I)-Math.round(C),u?G:Math.round(R+G)-Math.round(R)),E.clipExtent&&p.restore()}});const w=Ti(o);return a.getTriangles().forEach(function(E,b,x){const C=E.source,R=E.target;let I=C[0][0],G=C[0][1],P=C[1][0],A=C[1][1],k=C[2][0],V=C[2][1];const F=_((R[0][0]-w[0])/r),B=_(-(R[0][1]-w[1])/r),D=_((R[1][0]-w[0])/r),X=_(-(R[1][1]-w[1])/r),Y=_((R[2][0]-w[0])/r),ie=_(-(R[2][1]-w[1])/r),T=I,be=G;I=0,G=0,P-=T,A-=be,k-=T,V-=be;const Te=[[P,A,0,0,D-F],[k,V,0,0,Y-F],[0,0,P,A,X-B],[0,0,k,V,ie-B]],ue=md(Te);if(!ue)return;if(g.save(),g.beginPath(),wm()||!u){g.moveTo(D,X);const Se=4,ut=F-D,et=B-X;for(let je=0;je<Se;je++)g.lineTo(D+_((je+1)*ut/Se),X+_(je*et/(Se-1))),je!=Se-1&&g.lineTo(D+_((je+1)*ut/Se),X+_((je+1)*et/(Se-1)));g.lineTo(Y,ie)}else g.moveTo(D,X),g.lineTo(F,B),g.lineTo(Y,ie);g.clip(),g.transform(ue[0],ue[2],ue[1],ue[3],F,B),g.translate(m[0]-T,m[3]-be);let Ne;if(p)Ne=p.canvas,g.scale(v,-v);else{const Se=l[0],ut=Se.extent;Ne=Se.image,g.scale(te(ut)/Ne.width,-ke(ut)/Ne.height)}g.drawImage(Ne,0,0),g.restore()}),p&&(xr(p),ln.push(p.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(E,b,x){const C=E.target,R=(C[0][0]-w[0])/r,I=-(C[0][1]-w[1])/r,G=(C[1][0]-w[0])/r,P=-(C[1][1]-w[1])/r,A=(C[2][0]-w[0])/r,k=-(C[2][1]-w[1])/r;g.beginPath(),g.moveTo(G,P),g.lineTo(R,I),g.lineTo(A,k),g.closePath(),g.stroke()}),g.restore()),g.canvas}const bm=10,gh=.25;class Sm{constructor(e,t,i,s,r,o,a){this.sourceProj_=e,this.targetProj_=t;let l={};const h=a?Xd(v=>ye(a,ma(v,this.targetProj_,this.sourceProj_))):Zn(this.targetProj_,this.sourceProj_);this.transformInv_=function(v){const w=v[0]+"/"+v[1];return l[w]||(l[w]=h(v)),l[w]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&te(s)>=te(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?te(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?te(this.targetProj_.getExtent()):null;const c=Ti(i),u=mr(i),d=_r(i),f=gr(i),g=this.transformInv_(c),_=this.transformInv_(u),m=this.transformInv_(d),p=this.transformInv_(f),y=bm+(o?Math.max(0,Math.ceil(Math.log2(Ro(i)/(o*o*256*256)))):0);if(this.addQuad_(c,u,d,f,g,_,m,p,y),this.wrapsXInSource_){let v=1/0;this.triangles_.forEach(function(w,E,b){v=Math.min(v,w.source[0][0],w.source[1][0],w.source[2][0])}),this.triangles_.forEach(w=>{if(Math.max(w.source[0][0],w.source[1][0],w.source[2][0])-v>this.sourceWorldWidth_/2){const E=[[w.source[0][0],w.source[0][1]],[w.source[1][0],w.source[1][1]],[w.source[2][0],w.source[2][1]]];E[0][0]-v>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-v>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-v>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);const b=Math.min(E[0][0],E[1][0],E[2][0]);Math.max(E[0][0],E[1][0],E[2][0])-b<this.sourceWorldWidth_/2&&(w.source=E)}})}l={}}addTriangle_(e,t,i,s,r,o){this.triangles_.push({source:[s,r,o],target:[e,t,i]})}addQuad_(e,t,i,s,r,o,a,l,h){const c=_l([r,o,a,l]),u=this.sourceWorldWidth_?te(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=_l([e,t,i,s]);g=te(m)/this.targetWorldWidth_>gh||g}!f&&this.sourceProj_.isGlobal()&&u&&(g=u>gh||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Oe(c,this.maxSourceExtent_))return;let _=0;if(!g&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(_=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!g){const m=[(e[0]+i[0])/2,(e[1]+i[1])/2],p=this.transformInv_(m);let y;f?y=(rn(r[0],d)+rn(a[0],d))/2-rn(p[0],d):y=(r[0]+a[0])/2-p[0];const v=(r[1]+a[1])/2-p[1];g=y*y+v*v>this.errorThresholdSquared_}if(g){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const m=[(t[0]+i[0])/2,(t[1]+i[1])/2],p=this.transformInv_(m),y=[(s[0]+e[0])/2,(s[1]+e[1])/2],v=this.transformInv_(y);this.addQuad_(e,t,m,y,r,o,p,v,h-1),this.addQuad_(y,m,i,s,v,p,a,l,h-1)}else{const m=[(e[0]+t[0])/2,(e[1]+t[1])/2],p=this.transformInv_(m),y=[(i[0]+s[0])/2,(i[1]+s[1])/2],v=this.transformInv_(y);this.addQuad_(e,m,y,s,r,p,v,l,h-1),this.addQuad_(m,t,i,y,p,o,a,v,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(_&11)==0&&this.addTriangle_(e,i,s,r,a,l),(_&14)==0&&this.addTriangle_(e,i,t,r,a,o),_&&((_&13)==0&&this.addTriangle_(t,s,e,o,l,r),(_&7)==0&&this.addTriangle_(t,s,i,o,l,a))}calculateSourceExtent(){const e=Qe();return this.triangles_.forEach(function(t,i,s){const r=t.source;zn(e,r[0]),zn(e,r[1]),zn(e,r[2])}),e}getTriangles(){return this.triangles_}}const xm=.5;class gu extends za{constructor(e,t,i,s,r,o,a,l,h,c,u,d){super(r,M.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const f=s.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const m=g?vi(f,g):f;if(Ro(m)===0){this.state=M.EMPTY;return}const p=e.getExtent();p&&(_?_=vi(_,p):_=p);const y=s.getResolution(this.wrappedTileCoord_[0]),v=vm(e,i,m,y);if(!isFinite(v)||v<=0){this.state=M.EMPTY;return}const w=c!==void 0?c:xm;if(this.triangulation_=new Sm(e,i,m,_,v*w,y),this.triangulation_.getTriangles().length===0){this.state=M.EMPTY;return}this.sourceZ_=t.getZForResolution(v);let E=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(E[1]=oe(E[1],_[1],_[3]),E[3]=oe(E[3],_[1],_[3])):E=vi(E,_)),!Ro(E))this.state=M.EMPTY;else{let b=0,x=0;e.canWrapX()&&(b=te(p),x=Math.floor((E[0]-p[0])/b)),ac(E.slice(),e,!0).forEach(R=>{const I=t.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let G=I.minX;G<=I.maxX;G++)for(let P=I.minY;P<=I.maxY;P++){const A=h(this.sourceZ_,G,P,a);if(A){const k=x*b;this.sourceTiles_.push({tile:A,offset:k})}}++x}),this.sourceTiles_.length===0&&(this.state=M.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{const i=t.tile;if(i&&i.getState()==M.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);s[0]+=t.offset,s[2]+=t.offset;const r=this.clipExtent_?.slice();r&&(r[0]+=t.offset,r[2]+=t.offset),e.push({extent:s,clipExtent:r,image:i.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=M.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),s=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Em(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=M.LOADED}this.changed()}load(){if(this.state==M.IDLE){this.state=M.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i==M.IDLE||i==M.LOADING){e++;const s=H(t,z.CHANGE,r=>{const o=t.getState();(o==M.LOADED||o==M.ERROR||o==M.EMPTY)&&(se(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},i,s){t.getState()==M.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(se),this.sourcesListenerKeys_=null}release(){this.canvas_&&(xr(this.canvas_.getContext("2d")),ln.push(this.canvas_),this.canvas_=null),super.release()}}class Cm{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof ur&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return Q(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return Q(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Q(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function or(n,e,t,i){return i!==void 0?(i[0]=n,i[1]=e,i[2]=t,i):[n,e,t]}function Rm(n,e,t){return n+"/"+e+"/"+t}function Tm(n){return Im(n[0],n[1],n[2])}function Im(n,e,t){return(e<<n)+t}function Am(n,e){const t=n[0],i=n[1],s=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(i,s):!0}function fo(n,e,t,i,s){return`${Z(n)},${e},${Rm(t,i,s)}`}function go(n,e,t){if(!(t in n))return n[t]=new Set([e]),!0;const i=n[t],s=i.has(e);return s||i.add(e),!s}function Om(n,e,t){const i=n[t];return i?i.delete(e):!1}function _h(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=vi(e,Xt(t.extent,n.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const s=i.getTileGridForProjection(n.viewState.projection).getExtent();s&&(e=vi(e,s))}return e}class km extends Hc{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Qe(),this.tempTileRange_=new Xa(0,0,0,0),this.tempTileCoord_=or(0,0,0);const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new Cm(i),this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,s){const r=this.tileCache_,a=this.getLayer().getSource(),l=fo(a,a.getKey(),e,t,i);let h;if(r.containsKey(l))h=r.get(l);else{if(h=a.getTile(e,t,i,s.pixelRatio,s.viewState.projection),!h)return null;r.set(l,h)}return h}getTile(e,t,i,s){const r=this.getOrCreateTile(e,t,i,s);return r||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),s=ye(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!un(r,s))return null;const o=t.viewState,a=i.getRenderSource(),l=a.getTileGridForProjection(o.projection),h=a.getTilePixelRatio(t.pixelRatio);for(let c=l.getZForResolution(o.resolution);c>=l.getMinZoom();--c){const u=l.getTileCoordForCoordAndZ(s,c),d=this.getTile(c,u[1],u[2],t);if(!d||d.getState()!==M.LOADED)continue;const f=l.getOrigin(c),g=Fe(l.getTileSize(c)),_=l.getResolution(c);let m;if(d instanceof au||d instanceof gu)m=d.getImage();else if(d instanceof uh){if(m=zo(d.getData()),!m)continue}else continue;const p=Math.floor(h*((s[0]-f[0])/_-u[1]*g[0])),y=Math.floor(h*((f[1]-s[1])/_-u[2]*g[1])),v=Math.round(h*a.getGutterForProjection(o.projection));return this.getImageData(m,p+v,y+v)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=i,!0}enqueueTiles(e,t,i,s,r){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=Z(l);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],d=a.getMapInternal(),f=Math.max(i-r,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection)),g=o.rotation,_=g?rc(o.center,o.resolution,g,e.size):void 0;for(let m=i;m>=f;--m){const p=h.getTileRangeForExtentAndZ(t,m,this.tempTileRange_),y=h.getResolution(m);for(let v=p.minX;v<=p.maxX;++v)for(let w=p.minY;w<=p.maxY;++w){if(g&&!h.tileCoordIntersectsViewport([m,v,w],_))continue;const E=this.getTile(m,v,w,e);if(!E||!go(s,E,m))continue;const x=E.getKey();if(u[x]=!0,E.getState()===M.IDLE&&!e.tileQueue.isKeyQueued(x)){const C=or(m,v,w,this.tempTileCoord_);e.tileQueue.enqueue([E,c,h.getTileCoordCenter(C),y])}}}}findStaleTile_(e,t){const i=this.tileCache_,s=e[0],r=e[1],o=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const h=fo(this.getLayer().getSource(),a[l],s,r,o);if(i.containsKey(h)){const c=i.peek(h);if(c.getState()===M.LOADED)return c.endTransition(Z(this)),go(t,c,s),!0}}return!1}findAltTiles_(e,t,i,s){const r=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!r)return!1;let o=!0;const a=this.tileCache_,l=this.getLayer().getRenderSource(),h=l.getKey();for(let c=r.minX;c<=r.maxX;++c)for(let u=r.minY;u<=r.maxY;++u){const d=fo(l,h,i,c,u);let f=!1;if(a.containsKey(d)){const g=a.peek(d);g.getState()===M.LOADED&&(go(s,g,i),f=!0)}f||(o=!1)}return o}renderFrame(e,t){this.renderComplete=!0;const i=e.layerStatesArray[e.layerIndex],s=e.viewState,r=s.projection,o=s.resolution,a=s.center,l=e.pixelRatio,h=this.getLayer(),c=h.getSource(),u=c.getTileGridForProjection(r),d=u.getZForResolution(o,c.zDirection),f=u.getResolution(d),g=c.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==g&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=g):this.renderedSourceKey_=g;let _=e.extent;const m=c.getTilePixelRatio(l);this.prepareContainer(e,t);const p=this.context.canvas.width,y=this.context.canvas.height,v=i.extent&&Xt(i.extent);v&&(_=vi(_,Xt(i.extent)));const w=f*p/2/m,E=f*y/2/m,b=[a[0]-w,a[1]-E,a[0]+w,a[1]+E],x={};this.renderedTiles.length=0;const C=h.getPreload();if(e.nextExtent){const D=u.getZForResolution(s.nextResolution,c.zDirection),X=_h(e,e.nextExtent);this.enqueueTiles(e,X,D,x,C)}const R=_h(e,_);if(this.enqueueTiles(e,R,d,x,0),C>0&&setTimeout(()=>{this.enqueueTiles(e,R,d-1,x,C-1)},0),!(d in x))return this.container;const I=Z(this),G=e.time;for(const D of x[d]){const X=D.getState();if(X===M.EMPTY)continue;const Y=D.tileCoord;if(X===M.LOADED&&D.getAlpha(I,G)===1){D.endTransition(I);continue}if(X!==M.ERROR&&(this.renderComplete=!1),this.findStaleTile_(Y,x)){Om(x,D,d),e.animate=!0;continue}if(this.findAltTiles_(u,Y,d+1,x))continue;const be=u.getMinZoom();for(let Te=d-1;Te>=be&&!this.findAltTiles_(u,Y,Te,x);--Te);}const P=f/o*l/m,A=this.getRenderContext(e);Pt(this.tempTransform,p/2,y/2,P,P,0,-p/2,-y/2),i.extent&&this.clipUnrotated(A,e,v),c.getInterpolate()||(A.imageSmoothingEnabled=!1),this.preRender(A,e);const k=Object.keys(x).map(Number);k.sort(It);let V;const F=[],B=[];for(let D=k.length-1;D>=0;--D){const X=k[D],Y=c.getTilePixelSize(X,l,r),T=u.getResolution(X)/f,be=Y[0]*T*P,Te=Y[1]*T*P,ue=u.getTileCoordForCoordAndZ(Ti(b),X),Ne=u.getTileCoordExtent(ue),Se=ye(this.tempTransform,[m*(Ne[0]-b[0])/f,m*(b[3]-Ne[3])/f]),ut=m*c.getGutterForProjection(r);for(const et of x[X]){if(et.getState()!==M.LOADED)continue;const je=et.tileCoord,xs=ue[1]-je[1],Nr=Math.round(Se[0]-(xs-1)*be),Rn=ue[2]-je[2],ii=Math.round(Se[1]-(Rn-1)*Te),Ke=Math.round(Se[0]-xs*be),dt=Math.round(Se[1]-Rn*Te),ki=Nr-Ke,Pi=ii-dt,Tn=k.length===1;let ni=!1;V=[Ke,dt,Ke+ki,dt,Ke+ki,dt+Pi,Ke,dt+Pi];for(let Li=0,Mi=F.length;Li<Mi;++Li)if(!Tn&&X<B[Li]){const me=F[Li];Oe([Ke,dt,Ke+ki,dt+Pi],[me[0],me[3],me[4],me[7]])&&(ni||(A.save(),ni=!0),A.beginPath(),A.moveTo(V[0],V[1]),A.lineTo(V[2],V[3]),A.lineTo(V[4],V[5]),A.lineTo(V[6],V[7]),A.moveTo(me[6],me[7]),A.lineTo(me[4],me[5]),A.lineTo(me[2],me[3]),A.lineTo(me[0],me[1]),A.clip())}F.push(V),B.push(X),this.drawTile(et,e,Ke,dt,ki,Pi,ut,Tn),ni&&A.restore(),this.renderedTiles.unshift(et),this.updateUsedTiles(e.usedTiles,c,et)}}if(this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!qn(this.renderedExtent_,b),this.renderedExtent_=b,this.renderedPixelRatio=l,this.postRender(this.context,e),i.extent&&A.restore(),A.imageSmoothingEnabled=!0,this.renderComplete){const D=(X,Y)=>{const ie=Z(c),T=Y.wantedTiles[ie],be=T?Object.keys(T).length:0;this.updateCacheSize(be),this.tileCache_.expireCache()};e.postRenderFunctions.push(D)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,s,r,o,a,l){let h;if(e instanceof uh){if(h=zo(e.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(e);if(!h)return;const c=this.getRenderContext(t),u=Z(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(l?e.getAlpha(u,t.time):1),g=f!==c.globalAlpha;g&&(c.save(),c.globalAlpha=f),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,s,r,o),g&&c.restore(),f!==d.opacity?t.animate=!0:l&&e.endTransition(u)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const s=Z(t);s in e||(e[s]={}),e[s][i.getKey()]=!0}}const js={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Pm extends Pr{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(js.PRELOAD)}setPreload(e){this.set(js.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(js.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(js.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class xn extends Pm{constructor(e){super(e)}createRenderer(){return new km(this,{cacheSize:this.getCacheSize()})}}const $i=[0,0,0],Bt=5;class _u{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Q(od(this.resolutions_,(s,r)=>r-s),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!t)t=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Q(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Ti(i)),Q(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Q(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:$a,Q(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((s,r)=>{const o=new Xa(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const s=this.getTileRangeForExtentAndZ(e,t);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let a=s.minY,l=s.maxY;a<=l;++a)i([t,r,a])}forEachTileCoordParentTileRange(e,t,i,s){let r,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,s);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=Ui(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(l,h,i),t(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return Ui(r,r+1,o,o+1,t)}const s=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const s=e[0],r=e[1],o=e[2];if(t===s)return Ui(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-s),h=Math.floor(r*l),c=Math.floor(o*l);if(t<s)return Ui(h,h,c,c,i);const u=Math.floor(l*(r+1))-1,d=Math.floor(l*(o+1))-1;return Ui(h,u,c,d,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,$i);const s=$i[1],r=$i[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,$i);const o=$i[1],a=$i[2];return Ui(s,o,r,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),s=Fe(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*s[0]*i,t[1]-(e[2]+.5)*s[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),s=this.getResolution(e[0]),r=Fe(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*r[0]*s,a=i[1]-(e[2]+1)*r[1]*s,l=o+r[0]*s,h=a+r[1]*s;return kt(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,s,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=Fe(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/i/h[0],u=a*(l[1]-t)/i/h[1];return s?(c=As(c,Bt)-1,u=As(u,Bt)-1):(c=Is(c,Bt),u=Is(u,Bt)),or(o,c,u,r)}getTileCoordForXYAndZ_(e,t,i,s,r){const o=this.getOrigin(i),a=this.getResolution(i),l=Fe(this.getTileSize(i),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return s?(h=As(h,Bt)-1,c=As(c,Bt)-1):(h=Is(h,Bt),c=Is(c,Bt)),or(i,h,c,r)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=na(this.resolutions_,e,t||0);return oe(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Rc(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let s=this.minZoom;s<t;++s)i[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges_=i}}function mu(n){let e=n.getDefaultTileGrid();return e||(e=Fm(n),n.setDefaultTileGrid(e)),e}function Lm(n,e,t){const i=e[0],s=n.getTileCoordCenter(e),r=Ya(t);if(!un(r,s)){const o=te(r),a=Math.ceil((r[0]-s[0])/o);return s[0]+=o*a,n.getTileCoordForCoordAndZ(s,i)}return e}function Mm(n,e,t,i){i=i!==void 0?i:"top-left";const s=pu(n,e,t);return new _u({extent:n,origin:dd(n,i),resolutions:s,tileSize:t})}function Dm(n){const e=n||{},t=e.extent||ce("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:pu(t,e.maxZoom,e.tileSize,e.maxResolution)};return new _u(i)}function pu(n,e,t,i){e=e!==void 0?e:I_,t=Fe(t!==void 0?t:$a);const s=ke(n),r=te(n);i=i>0?i:Math.max(r/t[0],s/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Fm(n,e,t,i){const s=Ya(n);return Mm(s,e,t,i)}function Ya(n){n=ce(n);let e=n.getExtent();if(!e){const t=180*ha.degrees/n.getMetersPerUnit();e=kt(-t,-t,t,t)}return e}const Nm=/\{z\}/g,jm=/\{x\}/g,Gm=/\{y\}/g,Um=/\{-y\}/g;function $m(n,e,t,i,s){return n.replace(Nm,e.toString()).replace(jm,t.toString()).replace(Gm,i.toString()).replace(Um,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-i).toString()})}function Bm(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const i=t[1].charCodeAt(0),s=t[2].charCodeAt(0);let r;for(r=i;r<=s;++r)e.push(n.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const i=parseInt(t[2],10);for(let s=parseInt(t[1],10);s<=i;s++)e.push(n.replace(t[0],s.toString()));return e}return e.push(n),e}function zm(n,e){return function(t,i,s){if(!t)return;let r;const o=t[0];if(e){const a=e.getFullTileRange(o);a&&(r=a.getHeight()-1)}return $m(n,o,t[1],t[2],r)}}function Wm(n,e){const t=n.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=zm(n[s],e);return Km(i)}function Km(n){return n.length===1?n[0]:function(e,t,i){if(!e)return;const s=Tm(e),r=rn(s,n.length);return n[r](e,t,i)}}class Vm extends Kc{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Fe(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||Z(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,s,r){return $()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:mu(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),o=Fe(s.getTileSize(e),this.tmpSize);return r==1?o:gg(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const i=t!==void 0?t:this.getProjection(),s=t!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=Lm(s,e,i)),Am(e,s)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class Xm extends Mt{constructor(e,t){super(e),this.tile=t}}const _o={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class qa extends Vm{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===qa.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=Z(t),s=t.getState();let r;s==M.LOADING?(this.tileLoadingKeys_[i]=!0,r=_o.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=s==M.ERROR?_o.TILELOADERROR:s==M.LOADED?_o.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new Xm(r,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Bm(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Wm(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}}class Ym extends qa{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:qm,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:au,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!Ws(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Ws(t,e)))return this.tileGrid;const i=Z(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=mu(e)),this.tileGridForProjection[i]}createTile_(e,t,i,s,r,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,s,r):void 0,c=new this.tileClass(a,h!==void 0?M.IDLE:M.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(z.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,i,s,r){const o=this.getProjection();if(!o||!r||Ws(o,r))return this.getTileInternal(e,t,i,s,o||r);const a=[e,t,i],l=this.getKey(),h=this.getTileGridForProjection(o),c=this.getTileGridForProjection(r),u=this.getTileCoordForTileUrlFunction(a,r),d=new gu(o,h,r,c,a,u,this.getTilePixelRatio(s),this.getGutter(),(f,g,_,m)=>this.getTileInternal(f,g,_,m,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return d.key=l,d}getTileInternal(e,t,i,s,r){const o=this.getKey();return this.createTile_(e,t,i,s,r,o)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const i=ce(e);if(i){const s=Z(i);s in this.tileGridForProjection||(this.tileGridForProjection[s]=t)}}}function qm(n,e){n.getImage().src=e}class Cn extends Ym{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:Dm({extent:Ya(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const Hm='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Zm extends Cn{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[Hm];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",s=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:s,wrapX:e.wrapX,zDirection:e.zDirection})}}class Jm{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=vn,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?ce(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=ce(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return $()}readFeature(e,t){return $()}readFeatures(e,t){return $()}readGeometry(e,t){return $()}readProjection(e){return $()}writeFeature(e,t){return $()}writeFeatures(e,t){return $()}writeGeometry(e,t){return $()}}function Ha(n,e,t){const i=t?ce(t.featureProjection):null,s=t?ce(t.dataProjection):null;let r=n;if(i&&s&&!Ws(i,s)){e&&(r=n.clone());const o=e?i:s,a=e?s:i;o.getUnits()==="tile-pixels"?r.transform(o,a):r.applyTransform(Zn(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===n&&(r=n.clone()),r.applyTransform(a)}return r}const Qm={Point:Si,LineString:gn,Polygon:Qt,MultiPoint:Rr,MultiLineString:er,MultiPolygon:tr};function ep(n,e,t){return Array.isArray(e[0])?(Ic(n,0,e,t)||(n=n.slice(),Mo(n,0,e,t)),n):(Ra(n,0,e,t)||(n=n.slice(),qs(n,0,e,t)),n)}function yu(n,e){const t=n.geometry;if(!t)return[];if(Array.isArray(t))return t.map(r=>yu({...n,geometry:r})).flat();const i=t.type==="MultiPolygon"?"Polygon":t.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const s=t.layout.length;return Ha(new $e(i,i==="Polygon"?ep(t.flatCoordinates,t.ends,s):t.flatCoordinates,t.ends?.flat(),s,n.properties||{},n.id).enableSimplifyTransformed(),!1,e)}function Za(n,e){if(!n)return null;if(Array.isArray(n)){const i=n.map(s=>Za(s,e));return new Qs(i)}const t=Qm[n.type];return Ha(new t(n.flatCoordinates,n.layout||"XY",n.ends),!1,e)}class tp extends Jm{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(Gs(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Gs(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return $()}readFeaturesFromObject(e,t){return $()}readGeometry(e,t){return this.readGeometryFromObject(Gs(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return $()}readProjection(e){return this.readProjectionFromObject(Gs(e))}readProjectionFromObject(e){return $()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return $()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return $()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return $()}}function Gs(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}class ip extends tp{constructor(e){e=e||{},super(),this.dataProjection=ce(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=ce(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const s=Ja(i.geometry);if(this.featureClass===$e)return yu({geometry:s,id:i.id,properties:i.properties},t);const r=new vn;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&r.setGeometryName(i.geometry_name),r.setGeometry(Za(s,t)),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(e,t){const i=e;let s=null;if(i.type==="FeatureCollection"){const r=e;s=[];const o=r.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],t);h&&s.push(h)}}else s=[this.readFeatureFromObject(e,t)];return s.flat()}readGeometryFromObject(e,t){return np(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=ce(t.properties.name);else if(t.type==="EPSG")i=ce("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},s=e.getId();if(s!==void 0&&(i.id=s),!e.hasProperties())return i;const r=e.getProperties(),o=e.getGeometry();return o&&(i.geometry=Wo(o,t),delete r[e.getGeometryName()]),bi(r)||(i.properties=r),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let s=0,r=e.length;s<r;++s)i.push(this.writeFeatureObject(e[s],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return Wo(e,this.adaptOptions(t))}}function Ja(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=rp(n);break}case"LineString":{t=op(n);break}case"Polygon":{t=cp(n);break}case"MultiPoint":{t=lp(n);break}case"MultiLineString":{t=ap(n);break}case"MultiPolygon":{t=hp(n);break}case"GeometryCollection":{t=sp(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return t}function np(n,e){const t=Ja(n);return Za(t,e)}function sp(n,e){return n.geometries.map(function(i){return Ja(i)})}function rp(n){const e=n.coordinates;return{type:"Point",flatCoordinates:e,layout:Ii(e.length)}}function op(n){const e=n.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:Ii(e[0]?.length||2)}}function ap(n){const e=n.coordinates,t=e[0]?.[0]?.length||2,i=[],s=ps(i,0,e,t);return{type:"MultiLineString",flatCoordinates:i,ends:s,layout:Ii(t)}}function lp(n){const e=n.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:Ii(e[0]?.length||2)}}function hp(n){const e=n.coordinates,t=[],i=e[0]?.[0]?.[0].length||2,s=bc(t,0,e,i);return{type:"MultiPolygon",flatCoordinates:t,ends:s,layout:Ii(i)}}function cp(n){const e=n.coordinates,t=[],i=e[0]?.[0]?.length,s=ps(t,0,e,i);return{type:"Polygon",flatCoordinates:t,ends:s,layout:Ii(i)}}function Wo(n,e){n=Ha(n,!0,e);const t=n.getType();let i;switch(t){case"Point":{i=mp(n);break}case"LineString":{i=dp(n);break}case"Polygon":{i=pp(n,e);break}case"MultiPoint":{i=gp(n);break}case"MultiLineString":{i=fp(n);break}case"MultiPolygon":{i=_p(n,e);break}case"GeometryCollection":{i=up(n,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function up(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return Wo(i,e)})}}function dp(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function fp(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function gp(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function _p(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function mp(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function pp(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}function Lr(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(n);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(t[i[s]]=n[i[s]]);return t}function yp(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(c){try{h(i.next(c))}catch(u){o(u)}}function l(c){try{h(i.throw(c))}catch(u){o(u)}}function h(c){c.done?r(c.value):s(c.value).then(a,l)}h((i=i.apply(n,e||[])).next())})}const wp=n=>n?(...e)=>n(...e):(...e)=>fetch(...e);class Qa extends Error{constructor(e,t="FunctionsError",i){super(e),this.name=t,this.context=i}}class vp extends Qa{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class mh extends Qa{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ph extends Qa{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ko;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Ko||(Ko={}));class Ep{constructor(e,{headers:t={},customFetch:i,region:s=Ko.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=wp(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return yp(this,arguments,void 0,function*(t,i={}){var s;let r,o;try{const{headers:a,method:l,body:h,signal:c,timeout:u}=i;let d={},{region:f}=i;f||(f=this.region);const g=new URL(`${this.url}/${t}`);f&&f!=="any"&&(d["x-region"]=f,g.searchParams.set("forceFunctionRegion",f));let _;h&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",_=h):typeof h=="string"?(d["Content-Type"]="text/plain",_=h):typeof FormData<"u"&&h instanceof FormData?_=h:(d["Content-Type"]="application/json",_=JSON.stringify(h)):_=h;let m=c;u&&(o=new AbortController,r=setTimeout(()=>o.abort(),u),c?(m=o.signal,c.addEventListener("abort",()=>o.abort())):m=o.signal);const p=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),a),body:_,signal:m}).catch(E=>{throw new vp(E)}),y=p.headers.get("x-relay-error");if(y&&y==="true")throw new mh(p);if(!p.ok)throw new ph(p);let v=((s=p.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),w;return v==="application/json"?w=yield p.json():v==="application/octet-stream"||v==="application/pdf"?w=yield p.blob():v==="text/event-stream"?w=p:v==="multipart/form-data"?w=yield p.formData():w=yield p.text(),{data:w,error:null,response:p}}catch(a){return{data:null,error:a,response:a instanceof ph||a instanceof mh?a.context:void 0}}finally{r&&clearTimeout(r)}})}}var bp=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},Sp=class{constructor(n){var e,t;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(e=n.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=n.signal,this.isMaybeSingle=(t=n.isMaybeSingle)!==null&&t!==void 0?t:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=new Headers(this.headers),this.headers.set(n,e),this}then(n,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let s=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{let o=null,a=null,l=null,h=r.status,c=r.statusText;if(r.ok){var u,d;if(t.method!=="HEAD"){var f;const p=await r.text();p===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((f=t.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?a=p:a=JSON.parse(p))}const _=(u=t.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),m=(d=r.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");_&&m&&m.length>1&&(l=parseInt(m[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,h=406,c="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var g;const _=await r.text();try{o=JSON.parse(_),Array.isArray(o)&&r.status===404&&(a=[],o=null,h=200,c="OK")}catch{r.status===404&&_===""?(h=204,c="No Content"):o={message:_}}if(o&&t.isMaybeSingle&&(!(o==null||(g=o.details)===null||g===void 0)&&g.includes("0 rows"))&&(o=null,h=200,c="OK"),o&&t.shouldThrowOnError)throw new bp(o)}return{error:o,data:a,count:l,status:h,statusText:c}});return this.shouldThrowOnError||(s=s.catch(r=>{var o;let a="";const l=r?.cause;if(l){var h,c,u,d;const g=(h=l?.message)!==null&&h!==void 0?h:"",_=(c=l?.code)!==null&&c!==void 0?c:"";a=`${(u=r?.name)!==null&&u!==void 0?u:"FetchError"}: ${r?.message}`,a+=`

Caused by: ${(d=l?.name)!==null&&d!==void 0?d:"Error"}: ${g}`,_&&(a+=` (${_})`),l?.stack&&(a+=`
${l.stack}`)}else{var f;a=(f=r?.stack)!==null&&f!==void 0?f:""}return{error:{message:`${(o=r?.name)!==null&&o!==void 0?o:"FetchError"}: ${r?.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(n,e)}returns(){return this}overrideTypes(){return this}},xp=class extends Sp{select(n){let e=!1;const t=(n??"*").split("").map(i=>/\s/.test(i)&&!e?"":(i==='"'&&(e=!e),i)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:e=!0,nullsFirst:t,foreignTable:i,referencedTable:s=i}={}){const r=s?`${s}.order`:"order",o=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${o?`${o},`:""}${n}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:t=e}={}){const i=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(i,`${n}`),this}range(n,e,{foreignTable:t,referencedTable:i=t}={}){const s=typeof i>"u"?"offset":`${i}.offset`,r=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(s,`${n}`),this.url.searchParams.set(r,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:e=!1,settings:t=!1,buffers:i=!1,wal:s=!1,format:r="text"}={}){var o;const a=[n?"analyze":null,e?"verbose":null,t?"settings":null,i?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${r}; for="${l}"; options=${a};`),r==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const yh=new RegExp("[,()]");var Ji=class extends xp{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}regexMatch(n,e){return this.url.searchParams.append(n,`match.${e}`),this}regexIMatch(n,e){return this.url.searchParams.append(n,`imatch.${e}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}isDistinct(n,e){return this.url.searchParams.append(n,`isdistinct.${e}`),this}in(n,e){const t=Array.from(new Set(e)).map(i=>typeof i=="string"&&yh.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(n,`in.(${t})`),this}notIn(n,e){const t=Array.from(new Set(e)).map(i=>typeof i=="string"&&yh.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(n,`not.in.(${t})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:t,type:i}={}){let s="";i==="plain"?s="pl":i==="phrase"?s="ph":i==="websearch"&&(s="w");const r=t===void 0?"":`(${t})`;return this.url.searchParams.append(n,`${s}fts${r}.${e}`),this}match(n){return Object.entries(n).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(n,e,t){return this.url.searchParams.append(n,`not.${e}.${t}`),this}or(n,{foreignTable:e,referencedTable:t=e}={}){const i=t?`${t}.or`:"or";return this.url.searchParams.append(i,`(${n})`),this}filter(n,e,t){return this.url.searchParams.append(n,`${e}.${t}`),this}},Cp=class{constructor(n,{headers:e={},schema:t,fetch:i}){this.url=n,this.headers=new Headers(e),this.schema=t,this.fetch=i}select(n,e){const{head:t=!1,count:i}=e??{},s=t?"HEAD":"GET";let r=!1;const o=(n??"*").split("").map(a=>/\s/.test(a)&&!r?"":(a==='"'&&(r=!r),a)).join("");return this.url.searchParams.set("select",o),i&&this.headers.append("Prefer",`count=${i}`),new Ji({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:e,defaultToNull:t=!0}={}){var i;const s="POST";if(e&&this.headers.append("Prefer",`count=${e}`),t||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const r=n.reduce((o,a)=>o.concat(Object.keys(a)),[]);if(r.length>0){const o=[...new Set(r)].map(a=>`"${a}"`);this.url.searchParams.set("columns",o.join(","))}}return new Ji({method:s,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(n,{onConflict:e,ignoreDuplicates:t=!1,count:i,defaultToNull:s=!0}={}){var r;const o="POST";if(this.headers.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),i&&this.headers.append("Prefer",`count=${i}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const a=n.reduce((l,h)=>l.concat(Object.keys(h)),[]);if(a.length>0){const l=[...new Set(a)].map(h=>`"${h}"`);this.url.searchParams.set("columns",l.join(","))}}return new Ji({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}update(n,{count:e}={}){var t;const i="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new Ji({method:i,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}delete({count:n}={}){var e;const t="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new Ji({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},Rp=class wu{constructor(e,{headers:t={},schema:i,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=i,this.fetch=s}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Cp(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new wu(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:i=!1,get:s=!1,count:r}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let h;i||s?(a=i?"HEAD":"GET",Object.entries(t).filter(([u,d])=>d!==void 0).map(([u,d])=>[u,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([u,d])=>{l.searchParams.append(u,d)})):(a="POST",h=t);const c=new Headers(this.headers);return r&&c.set("Prefer",`count=${r}`),new Ji({method:a,url:l,headers:c,schema:this.schemaName,body:h,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class Tp{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const i=t.node,s=parseInt(i.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const i=this.getWebSocketConstructor();return new i(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Ip="2.89.0",Ap=`realtime-js/${Ip}`,vu="1.0.0",Op="2.0.0",wh=vu,Vo=1e4,kp=1e3,Pp=100;var Kt;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Kt||(Kt={}));var fe;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(fe||(fe={}));var st;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(st||(st={}));var Xo;(function(n){n.websocket="websocket"})(Xo||(Xo={}));var fi;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(fi||(fi={}));class Lp{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let i=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(i))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,i;const s=(i=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&i!==void 0?i:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var t,i;const s=(i=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&i!==void 0?i:{},o=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,t,i){var s,r;const o=e.topic,a=(s=e.ref)!==null&&s!==void 0?s:"",l=(r=e.join_ref)!==null&&r!==void 0?r:"",h=e.payload.event,c=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},u=Object.keys(c).length===0?"":JSON.stringify(c);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+h.length+u.length,f=new ArrayBuffer(this.HEADER_LENGTH+d);let g=new DataView(f),_=0;g.setUint8(_++,this.KINDS.userBroadcastPush),g.setUint8(_++,l.length),g.setUint8(_++,a.length),g.setUint8(_++,o.length),g.setUint8(_++,h.length),g.setUint8(_++,u.length),g.setUint8(_++,t),Array.from(l,p=>g.setUint8(_++,p.charCodeAt(0))),Array.from(a,p=>g.setUint8(_++,p.charCodeAt(0))),Array.from(o,p=>g.setUint8(_++,p.charCodeAt(0))),Array.from(h,p=>g.setUint8(_++,p.charCodeAt(0))),Array.from(u,p=>g.setUint8(_++,p.charCodeAt(0)));var m=new Uint8Array(f.byteLength+i.byteLength);return m.set(new Uint8Array(f),0),m.set(new Uint8Array(i),f.byteLength),m.buffer}decode(e,t){if(this._isArrayBuffer(e)){let i=this._binaryDecode(e);return t(i)}if(typeof e=="string"){const i=JSON.parse(e),[s,r,o,a,l]=i;return t({join_ref:s,ref:r,topic:o,event:a,payload:l})}return t({})}_binaryDecode(e){const t=new DataView(e),i=t.getUint8(0),s=new TextDecoder;switch(i){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,s)}}_decodeUserBroadcast(e,t,i){const s=t.getUint8(1),r=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let l=this.HEADER_LENGTH+4;const h=i.decode(e.slice(l,l+s));l=l+s;const c=i.decode(e.slice(l,l+r));l=l+r;const u=i.decode(e.slice(l,l+o));l=l+o;const d=e.slice(l,e.byteLength),f=a===this.JSON_ENCODING?JSON.parse(i.decode(d)):d,g={type:this.BROADCAST_EVENT,event:c,payload:f};return o>0&&(g.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:g}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([i])=>t.includes(i)))}}class Eu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ne;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(ne||(ne={}));const vh=(n,e,t={})=>{var i;const s=(i=t.skipTypes)!==null&&i!==void 0?i:[];return e?Object.keys(e).reduce((r,o)=>(r[o]=Mp(o,n,e,s),r),{}):{}},Mp=(n,e,t,i)=>{const s=e.find(a=>a.name===n),r=s?.type,o=t[n];return r&&!i.includes(r)?bu(r,o):Yo(o)},bu=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return jp(e,t)}switch(n){case ne.bool:return Dp(e);case ne.float4:case ne.float8:case ne.int2:case ne.int4:case ne.int8:case ne.numeric:case ne.oid:return Fp(e);case ne.json:case ne.jsonb:return Np(e);case ne.timestamp:return Gp(e);case ne.abstime:case ne.date:case ne.daterange:case ne.int4range:case ne.int8range:case ne.money:case ne.reltime:case ne.text:case ne.time:case ne.timestamptz:case ne.timetz:case ne.tsrange:case ne.tstzrange:return Yo(e);default:return Yo(e)}},Yo=n=>n,Dp=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Fp=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Np=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},jp=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,i=n[t];if(n[0]==="{"&&i==="}"){let r;const o=n.slice(1,t);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(a=>bu(e,a))}return n},Gp=n=>typeof n=="string"?n.replace(" ","T"):n,Su=n=>{const e=new URL(n);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class mo{constructor(e,t,i={},s=Vo){this.channel=e,this.event=t,this.payload=i,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var i;return this._hasReceived(e)&&t((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Eh;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Eh||(Eh={}));class Kn{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},s=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Kn.syncState(this.state,s,r,o),this.pendingDiffs.forEach(l=>{this.state=Kn.syncDiff(this.state,l,r,o)}),this.pendingDiffs=[],a()}),this.channel._on(i.diff,{},s=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Kn.syncDiff(this.state,s,r,o),a())}),this.onJoin((s,r,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:r,newPresences:o})}),this.onLeave((s,r,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,i,s){const r=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(r,(h,c)=>{o[h]||(l[h]=c)}),this.map(o,(h,c)=>{const u=r[h];if(u){const d=c.map(m=>m.presence_ref),f=u.map(m=>m.presence_ref),g=c.filter(m=>f.indexOf(m.presence_ref)<0),_=u.filter(m=>d.indexOf(m.presence_ref)<0);g.length>0&&(a[h]=g),_.length>0&&(l[h]=_)}else a[h]=c}),this.syncDiff(r,{joins:a,leaves:l},i,s)}static syncDiff(e,t,i,s){const{joins:r,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return i||(i=()=>{}),s||(s=()=>{}),this.map(r,(a,l)=>{var h;const c=(h=e[a])!==null&&h!==void 0?h:[];if(e[a]=this.cloneDeep(l),c.length>0){const u=e[a].map(f=>f.presence_ref),d=c.filter(f=>u.indexOf(f.presence_ref)<0);e[a].unshift(...d)}i(a,c,l)}),this.map(o,(a,l)=>{let h=e[a];if(!h)return;const c=l.map(u=>u.presence_ref);h=h.filter(u=>c.indexOf(u.presence_ref)<0),e[a]=h,s(a,h,l),h.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(i=>t(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,i)=>{const s=e[i];return"metas"in s?t[i]=s.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):t[i]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var bh;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(bh||(bh={}));var Vn;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Vn||(Vn={}));var Rt;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Rt||(Rt={}));class sn{constructor(e,t={config:{}},i){var s,r;if(this.topic=e,this.params=t,this.socket=i,this.bindings={},this.state=fe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new mo(this,st.join,this.params,this.timeout),this.rejoinTimer=new Eu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=fe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=fe.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=fe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=fe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=fe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(st.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new Kn(this),this.broadcastEndpointURL=Su(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((r=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||r===void 0)&&r.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var i,s,r;if(this.socket.isConnected()||this.socket.connect(),this.state==fe.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,h=(s=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(f=>f.filter))!==null&&s!==void 0?s:[],c=!!this.bindings[Vn.PRESENCE]&&this.bindings[Vn.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,u={},d={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:c}),postgres_changes:h,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(f=>e?.(Rt.CHANNEL_ERROR,f)),this._onClose(()=>e?.(Rt.CLOSED)),this.updateJoinPayload(Object.assign({config:d},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:f})=>{var g;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){e?.(Rt.SUBSCRIBED);return}else{const _=this.bindings.postgres_changes,m=(g=_?.length)!==null&&g!==void 0?g:0,p=[];for(let y=0;y<m;y++){const v=_[y],{filter:{event:w,schema:E,table:b,filter:x}}=v,C=f&&f[y];if(C&&C.event===w&&sn.isFilterValueEqual(C.schema,E)&&sn.isFilterValueEqual(C.table,b)&&sn.isFilterValueEqual(C.filter,x))p.push(Object.assign(Object.assign({},v),{id:C.id}));else{this.unsubscribe(),this.state=fe.errored,e?.(Rt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(Rt.SUBSCRIBED);return}}).receive("error",f=>{this.state=fe.errored,e?.(Rt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e?.(Rt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,i){return this.state===fe.joined&&e===Vn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,i)}async httpSend(e,t,i={}){var s;if(t==null)return Promise.reject("Payload is required for httpSend()");const r={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(r.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:r,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=i.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const h=await a.json();l=h.error||h.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var i,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:r,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(i=t.timeout)!==null&&i!==void 0?i:this.timeout);return await((s=h.body)===null||s===void 0?void 0:s.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,a,l;const h=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&r("ok"),h.receive("ok",()=>r("ok")),h.receive("error",()=>r("error")),h.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=fe.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(st.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(s=>{i=new mo(this,st.leave,{},e),i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=fe.closed,this.bindings={}}async _fetchWithTimeout(e,t,i){const s=new AbortController,r=setTimeout(()=>s.abort(),i),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(r),o}_push(e,t,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new mo(this,e,t,i);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Pp){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,i){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,i){var s,r;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:h,join:c}=st;if(i&&[a,l,h,c].indexOf(o)>=0&&i!==this._joinRef())return;let d=this._onMessage(o,t,i);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var g,_,m;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((m=(_=f.filter)===null||_===void 0?void 0:_.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(f=>f.callback(d,i)):(r=this.bindings[o])===null||r===void 0||r.filter(f=>{var g,_,m,p,y,v;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const w=f.id,E=(g=f.filter)===null||g===void 0?void 0:g.event;return w&&((_=t.ids)===null||_===void 0?void 0:_.includes(w))&&(E==="*"||E?.toLocaleLowerCase()===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const w=(y=(p=f?.filter)===null||p===void 0?void 0:p.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return w==="*"||w===((v=t?.event)===null||v===void 0?void 0:v.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const g=d.data,{schema:_,table:m,commit_timestamp:p,type:y,errors:v}=g;d=Object.assign(Object.assign({},{schema:_,table:m,commit_timestamp:p,eventType:y,new:{},old:{},errors:v}),this._getPayloadRecords(g))}f.callback(d,i)})}_isClosed(){return this.state===fe.closed}_isJoined(){return this.state===fe.joined}_isJoining(){return this.state===fe.joining}_isLeaving(){return this.state===fe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,i){const s=e.toLocaleLowerCase(),r={type:s,filter:t,callback:i};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}_off(e,t){const i=e.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(s=>{var r;return!(((r=s.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===i&&sn.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(st.close,{},e)}_onError(e){this._on(st.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=fe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=vh(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=vh(e.columns,e.old_record)),t}}const po=()=>{},Us={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Up=[1e3,2e3,5e3,1e4],$p=1e4,Bp=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class zp{constructor(e,t){var i;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Vo,this.transport=null,this.heartbeatIntervalMs=Us.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=po,this.ref=0,this.reconnectTimer=null,this.vsn=wh,this.logger=po,this.conn=null,this.sendBuffer=[],this.serializer=new Lp,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...r)=>s(...r):(...r)=>fetch(...r),!(!((i=t?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Xo.websocket}`,this.httpEndpoint=Su(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Tp.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,i){this.logger(e,t,i)}connectionState(){switch(this.conn&&this.conn.readyState){case Kt.connecting:return fi.Connecting;case Kt.open:return fi.Open;case Kt.closing:return fi.Closing;default:return fi.Closed}}isConnected(){return this.connectionState()===fi.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const i=`realtime:${e}`,s=this.getChannels().find(r=>r.topic===i);if(s)return s;{const r=new sn(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:i,payload:s,ref:r}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${i} (${r})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(kp,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Us.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(h){this.log("error","error in heartbeat callback",h)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:i,event:s,payload:r,ref:o}=t,a=o?`(${o})`:"",l=r.status||"";this.log("receive",`${l} ${i} ${s} ${a}`.trim(),r),this.channels.filter(h=>h._isMember(i)).forEach(h=>h._trigger(s,r,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Kt.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Kt.open||this.conn.readyState===Kt.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(st.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const i=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${i}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const i=new Blob([Bp],{type:"application/javascript"});t=URL.createObjectURL(i)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,i=!1;if(e)t=e,i=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),t=this.accessTokenValue}else t=this.accessTokenValue;i?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const r={access_token:t,version:Ap};t&&s.updateJoinPayload(r),s.joinedOnce&&s._isJoined()&&s._push(st.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(i=>{try{i(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(i){this.log("error",`error triggering ${e} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new Eu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Us.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,i,s,r,o,a,l,h,c,u,d,f;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(i=e?.timeout)!==null&&i!==void 0?i:Vo,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:Us.HEARTBEAT_INTERVAL,this.worker=(r=e?.worker)!==null&&r!==void 0?r:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:po,this.vsn=(l=e?.vsn)!==null&&l!==void 0?l:wh,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:g=>Up[g-1]||$p,this.vsn){case vu:this.encode=(c=e?.encode)!==null&&c!==void 0?c:(g,_)=>_(JSON.stringify(g)),this.decode=(u=e?.decode)!==null&&u!==void 0?u:(g,_)=>_(JSON.parse(g));break;case Op:this.encode=(d=e?.encode)!==null&&d!==void 0?d:this.serializer.encode.bind(this.serializer),this.decode=(f=e?.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var os=class extends Error{constructor(n,e){super(n),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Wp(n,e,t){const i=new URL(e,n);if(t)for(const[s,r]of Object.entries(t))r!==void 0&&i.searchParams.set(s,r);return i.toString()}async function Kp(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function Vp(n){const e=n.fetchImpl??globalThis.fetch;return{async request({method:t,path:i,query:s,body:r,headers:o}){const a=Wp(n.baseUrl,i,s),l=await Kp(n.auth),h=await e(a,{method:t,headers:{...r?{"Content-Type":"application/json"}:{},...l,...o},body:r?JSON.stringify(r):void 0}),c=await h.text(),u=(h.headers.get("content-type")||"").includes("application/json"),d=u&&c?JSON.parse(c):c;if(!h.ok){const f=u?d:void 0,g=f?.error;throw new os(g?.message??`Request failed with status ${h.status}`,{status:h.status,icebergType:g?.type,icebergCode:g?.code,details:f})}return{status:h.status,headers:h.headers,data:d}}}}function $s(n){return n.join("")}var Xp=class{constructor(n,e=""){this.client=n,this.prefix=e}async listNamespaces(n){const e=n?{parent:$s(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(i=>({namespace:i}))}async createNamespace(n,e){const t={namespace:n.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${$s(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${$s(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${$s(n.namespace)}`}),!0}catch(e){if(e instanceof os&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(n,e){try{return await this.createNamespace(n,e)}catch(t){if(t instanceof os&&t.status===409)return;throw t}}};function Bi(n){return n.join("")}var Yp=class{constructor(n,e="",t){this.client=n,this.prefix=e,this.accessDelegation=t}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Bi(n.namespace)}/tables`})).data.identifiers}async createTable(n,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Bi(n.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(n,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Bi(n.namespace)}/tables/${n.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(n,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Bi(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(n){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Bi(n.namespace)}/tables/${n.name}`,headers:e})).data.metadata}async tableExists(n){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Bi(n.namespace)}/tables/${n.name}`,headers:e}),!0}catch(t){if(t instanceof os&&t.status===404)return!1;throw t}}async createTableIfNotExists(n,e){try{return await this.createTable(n,e)}catch(t){if(t instanceof os&&t.status===409)return await this.loadTable({namespace:n.namespace,name:e.name});throw t}}},qp=class{constructor(n){let e="v1";n.catalogName&&(e+=`/${n.catalogName}`);const t=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=Vp({baseUrl:t,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new Xp(this.client,e),this.tableOps=new Yp(this.client,e,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,e){return this.namespaceOps.createNamespace(n,e)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,e){return this.tableOps.createTable(n,e)}async updateTable(n,e){return this.tableOps.updateTable(n,e)}async dropTable(n,e){await this.tableOps.dropTable(n,e)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,e){return this.namespaceOps.createNamespaceIfNotExists(n,e)}async createTableIfNotExists(n,e){return this.tableOps.createTableIfNotExists(n,e)}},Mr=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function re(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var Hp=class extends Mr{constructor(n,e,t){super(n),this.name="StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},qo=class extends Mr{constructor(n,e){super(n),this.name="StorageUnknownError",this.originalError=e}};const el=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),Zp=()=>Response,Ho=n=>{if(Array.isArray(n))return n.map(t=>Ho(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,i])=>{const s=t.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));e[s]=Ho(i)}),e},Jp=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Qp=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function as(n){"@babel/helpers - typeof";return as=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},as(n)}function ey(n,e){if(as(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(as(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function ty(n){var e=ey(n,"string");return as(e)=="symbol"?e:e+""}function iy(n,e,t){return(e=ty(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Sh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function j(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Sh(Object(t),!0).forEach(function(i){iy(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Sh(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const yo=n=>{var e;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(e=n.error)===null||e===void 0?void 0:e.message)||JSON.stringify(n)},ny=async(n,e,t)=>{n instanceof await Zp()&&!t?.noResolveJson?n.json().then(i=>{const s=n.status||500,r=i?.statusCode||s+"";e(new Hp(yo(i),s,r))}).catch(i=>{e(new qo(yo(i),i))}):e(new qo(yo(n),n))},sy=(n,e,t,i)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"||!i?s:(Jp(i)?(s.headers=j({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(i)):s.body=i,e?.duplex&&(s.duplex=e.duplex),j(j({},s),t))};async function Ss(n,e,t,i,s,r){return new Promise((o,a)=>{n(t,sy(e,i,s,r)).then(l=>{if(!l.ok)throw l;return i?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>ny(l,a,i))})}async function ls(n,e,t,i){return Ss(n,"GET",e,t,i)}async function nt(n,e,t,i,s){return Ss(n,"POST",e,i,s,t)}async function Zo(n,e,t,i,s){return Ss(n,"PUT",e,i,s,t)}async function ry(n,e,t,i){return Ss(n,"HEAD",e,j(j({},t),{},{noResolveJson:!0}),i)}async function tl(n,e,t,i,s){return Ss(n,"DELETE",e,i,s,t)}var oy=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e}then(n,e){return this.execute().then(n,e)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}}};let xu;xu=Symbol.toStringTag;var ay=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e,this[xu]="BlobDownloadBuilder",this.promise=null}asStream(){return new oy(this.downloadFn,this.shouldThrowOnError)}then(n,e){return this.getPromise().then(n,e)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(re(e))return{data:null,error:e};throw e}}};const ly={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},xh={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var hy=class{constructor(n,e={},t,i){this.shouldThrowOnError=!1,this.url=n,this.headers=e,this.bucketId=t,this.fetch=el(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,e,t,i){var s=this;try{let r;const o=j(j({},xh),i);let a=j(j({},s.headers),n==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&t instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),l&&r.append("metadata",s.encodeMetadata(l)),r.append("",t)):typeof FormData<"u"&&t instanceof FormData?(r=t,r.has("cacheControl")||r.append("cacheControl",o.cacheControl),l&&!r.has("metadata")&&r.append("metadata",s.encodeMetadata(l))):(r=t,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(l))),(typeof ReadableStream<"u"&&r instanceof ReadableStream||r&&typeof r=="object"&&"pipe"in r&&typeof r.pipe=="function")&&!o.duplex&&(o.duplex="half")),i?.headers&&(a=j(j({},a),i.headers));const h=s._removeEmptyFolders(e),c=s._getFinalPath(h),u=await(n=="PUT"?Zo:nt)(s.fetch,`${s.url}/object/${c}`,r,j({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:h,id:u.Id,fullPath:u.Key},error:null}}catch(r){if(s.shouldThrowOnError)throw r;if(re(r))return{data:null,error:r};throw r}}async upload(n,e,t){return this.uploadOrUpdate("POST",n,e,t)}async uploadToSignedUrl(n,e,t,i){var s=this;const r=s._removeEmptyFolders(n),o=s._getFinalPath(r),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const h=j({upsert:xh.upsert},i),c=j(j({},s.headers),{"x-upsert":String(h.upsert)});return typeof Blob<"u"&&t instanceof Blob?(l=new FormData,l.append("cacheControl",h.cacheControl),l.append("",t)):typeof FormData<"u"&&t instanceof FormData?(l=t,l.append("cacheControl",h.cacheControl)):(l=t,c["cache-control"]=`max-age=${h.cacheControl}`,c["content-type"]=h.contentType),{data:{path:r,fullPath:(await Zo(s.fetch,a.toString(),l,{headers:c})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(re(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(n,e){var t=this;try{let i=t._getFinalPath(n);const s=j({},t.headers);e?.upsert&&(s["x-upsert"]="true");const r=await nt(t.fetch,`${t.url}/object/upload/sign/${i}`,{},{headers:s}),o=new URL(t.url+r.url),a=o.searchParams.get("token");if(!a)throw new Mr("No token returned by API");return{data:{signedUrl:o.toString(),path:n,token:a},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(re(i))return{data:null,error:i};throw i}}async update(n,e,t){return this.uploadOrUpdate("PUT",n,e,t)}async move(n,e,t){var i=this;try{return{data:await nt(i.fetch,`${i.url}/object/move`,{bucketId:i.bucketId,sourceKey:n,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:i.headers}),error:null}}catch(s){if(i.shouldThrowOnError)throw s;if(re(s))return{data:null,error:s};throw s}}async copy(n,e,t){var i=this;try{return{data:{path:(await nt(i.fetch,`${i.url}/object/copy`,{bucketId:i.bucketId,sourceKey:n,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:i.headers})).Key},error:null}}catch(s){if(i.shouldThrowOnError)throw s;if(re(s))return{data:null,error:s};throw s}}async createSignedUrl(n,e,t){var i=this;try{let s=i._getFinalPath(n),r=await nt(i.fetch,`${i.url}/object/sign/${s}`,j({expiresIn:e},t?.transform?{transform:t.transform}:{}),{headers:i.headers});const o=t?.download?`&download=${t.download===!0?"":t.download}`:"";return r={signedUrl:encodeURI(`${i.url}${r.signedURL}${o}`)},{data:r,error:null}}catch(s){if(i.shouldThrowOnError)throw s;if(re(s))return{data:null,error:s};throw s}}async createSignedUrls(n,e,t){var i=this;try{const s=await nt(i.fetch,`${i.url}/object/sign/${i.bucketId}`,{expiresIn:e,paths:n},{headers:i.headers}),r=t?.download?`&download=${t.download===!0?"":t.download}`:"";return{data:s.map(o=>j(j({},o),{},{signedUrl:o.signedURL?encodeURI(`${i.url}${o.signedURL}${r}`):null})),error:null}}catch(s){if(i.shouldThrowOnError)throw s;if(re(s))return{data:null,error:s};throw s}}download(n,e){const t=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),s=i?`?${i}`:"",r=this._getFinalPath(n),o=()=>ls(this.fetch,`${this.url}/${t}/${r}${s}`,{headers:this.headers,noResolveJson:!0});return new ay(o,this.shouldThrowOnError)}async info(n){var e=this;const t=e._getFinalPath(n);try{return{data:Ho(await ls(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})),error:null}}catch(i){if(e.shouldThrowOnError)throw i;if(re(i))return{data:null,error:i};throw i}}async exists(n){var e=this;const t=e._getFinalPath(n);try{return await ry(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(i){if(e.shouldThrowOnError)throw i;if(re(i)&&i instanceof qo){const s=i.originalError;if([400,404].includes(s?.status))return{data:!1,error:i}}throw i}}getPublicUrl(n,e){const t=this._getFinalPath(n),i=[],s=e?.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&i.push(s);const r=typeof e?.transform<"u"?"render/image":"object",o=this.transformOptsToQueryString(e?.transform||{});o!==""&&i.push(o);let a=i.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${t}${a}`)}}}async remove(n){var e=this;try{return{data:await tl(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:n},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}}async list(n,e,t){var i=this;try{const s=j(j(j({},ly),e),{},{prefix:n||""});return{data:await nt(i.fetch,`${i.url}/object/list/${i.bucketId}`,s,{headers:i.headers},t),error:null}}catch(s){if(i.shouldThrowOnError)throw s;if(re(s))return{data:null,error:s};throw s}}async listV2(n,e){var t=this;try{const i=j({},n);return{data:await nt(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,i,{headers:t.headers},e),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(re(i))return{data:null,error:i};throw i}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}};const Cu="2.89.0",Ru={"X-Client-Info":`storage-js/${Cu}`};var cy=class{constructor(n,e={},t,i){this.shouldThrowOnError=!1;const s=new URL(n);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=j(j({},Ru),e),this.fetch=el(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var e=this;try{const t=e.listBucketOptionsToQueryString(n);return{data:await ls(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}}async getBucket(n){var e=this;try{return{data:await ls(e.fetch,`${e.url}/bucket/${n}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}}async createBucket(n,e={public:!1}){var t=this;try{return{data:await nt(t.fetch,`${t.url}/bucket`,{id:n,name:n,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(re(i))return{data:null,error:i};throw i}}async updateBucket(n,e){var t=this;try{return{data:await Zo(t.fetch,`${t.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(re(i))return{data:null,error:i};throw i}}async emptyBucket(n){var e=this;try{return{data:await nt(e.fetch,`${e.url}/bucket/${n}/empty`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}}async deleteBucket(n){var e=this;try{return{data:await tl(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}}listBucketOptionsToQueryString(n){const e={};return n&&("limit"in n&&(e.limit=String(n.limit)),"offset"in n&&(e.offset=String(n.offset)),n.search&&(e.search=n.search),n.sortColumn&&(e.sortColumn=n.sortColumn),n.sortOrder&&(e.sortOrder=n.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},uy=class{constructor(n,e={},t){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=j(j({},Ru),e),this.fetch=el(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var e=this;try{return{data:await nt(e.fetch,`${e.url}/bucket`,{name:n},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}}async listBuckets(n){var e=this;try{const t=new URLSearchParams;n?.limit!==void 0&&t.set("limit",n.limit.toString()),n?.offset!==void 0&&t.set("offset",n.offset.toString()),n?.sortColumn&&t.set("sortColumn",n.sortColumn),n?.sortOrder&&t.set("sortOrder",n.sortOrder),n?.search&&t.set("search",n.search);const i=t.toString(),s=i?`${e.url}/bucket?${i}`:`${e.url}/bucket`;return{data:await ls(e.fetch,s,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}}async deleteBucket(n){var e=this;try{return{data:await tl(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(re(t))return{data:null,error:t};throw t}}from(n){var e=this;if(!Qp(n))throw new Mr("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new qp({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),i=this.shouldThrowOnError;return new Proxy(t,{get(s,r){const o=s[r];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(s,a),error:null}}catch(l){if(i)throw l;return{data:null,error:l}}}}})}};const il={"X-Client-Info":`storage-js/${Cu}`,"Content-Type":"application/json"};var Tu=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Be(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var wo=class extends Tu{constructor(n,e,t){super(n),this.name="StorageVectorsApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},dy=class extends Tu{constructor(n,e){super(n),this.name="StorageVectorsUnknownError",this.originalError=e}};const nl=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),fy=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Ch=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),gy=async(n,e,t)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!t?.noResolveJson){const i=n.status||500,s=n;if(typeof s.json=="function")s.json().then(r=>{const o=r?.statusCode||r?.code||i+"";e(new wo(Ch(r),i,o))}).catch(()=>{const r=i+"";e(new wo(s.statusText||`HTTP ${i} error`,i,r))});else{const r=i+"";e(new wo(s.statusText||`HTTP ${i} error`,i,r))}}else e(new dy(Ch(n),n))},_y=(n,e,t,i)=>{const s={method:n,headers:e?.headers||{}};return i?(fy(i)?(s.headers=j({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(i)):s.body=i,j(j({},s),t)):s};async function my(n,e,t,i,s,r){return new Promise((o,a)=>{n(t,_y(e,i,s,r)).then(l=>{if(!l.ok)throw l;if(i?.noResolveJson)return l;const h=l.headers.get("content-type");return!h||!h.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>gy(l,a,i))})}async function ze(n,e,t,i,s){return my(n,"POST",e,i,s,t)}var py=class{constructor(n,e={},t){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=j(j({},il),e),this.fetch=nl(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var e=this;try{return{data:await ze(e.fetch,`${e.url}/CreateIndex`,n,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}async getIndex(n,e){var t=this;try{return{data:await ze(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:n,indexName:e},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Be(i))return{data:null,error:i};throw i}}async listIndexes(n){var e=this;try{return{data:await ze(e.fetch,`${e.url}/ListIndexes`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}async deleteIndex(n,e){var t=this;try{return{data:await ze(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:n,indexName:e},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Be(i))return{data:null,error:i};throw i}}},yy=class{constructor(n,e={},t){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=j(j({},il),e),this.fetch=nl(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var e=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await ze(e.fetch,`${e.url}/PutVectors`,n,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}async getVectors(n){var e=this;try{return{data:await ze(e.fetch,`${e.url}/GetVectors`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}async listVectors(n){var e=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await ze(e.fetch,`${e.url}/ListVectors`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}async queryVectors(n){var e=this;try{return{data:await ze(e.fetch,`${e.url}/QueryVectors`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}async deleteVectors(n){var e=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await ze(e.fetch,`${e.url}/DeleteVectors`,n,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}},wy=class{constructor(n,e={},t){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=j(j({},il),e),this.fetch=nl(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var e=this;try{return{data:await ze(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}async getBucket(n){var e=this;try{return{data:await ze(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:n},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}async listBuckets(n={}){var e=this;try{return{data:await ze(e.fetch,`${e.url}/ListVectorBuckets`,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}async deleteBucket(n){var e=this;try{return{data:await ze(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Be(t))return{data:null,error:t};throw t}}},vy=class extends wy{constructor(n,e={}){super(n,e.headers||{},e.fetch)}from(n){return new Ey(this.url,this.headers,n,this.fetch)}async createBucket(n){var e=()=>super.createBucket,t=this;return e().call(t,n)}async getBucket(n){var e=()=>super.getBucket,t=this;return e().call(t,n)}async listBuckets(n={}){var e=()=>super.listBuckets,t=this;return e().call(t,n)}async deleteBucket(n){var e=()=>super.deleteBucket,t=this;return e().call(t,n)}},Ey=class extends py{constructor(n,e,t,i){super(n,e,i),this.vectorBucketName=t}async createIndex(n){var e=()=>super.createIndex,t=this;return e().call(t,j(j({},n),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(n={}){var e=()=>super.listIndexes,t=this;return e().call(t,j(j({},n),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(n){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,n)}async deleteIndex(n){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,n)}index(n){return new by(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},by=class extends yy{constructor(n,e,t,i,s){super(n,e,s),this.vectorBucketName=t,this.indexName=i}async putVectors(n){var e=()=>super.putVectors,t=this;return e().call(t,j(j({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(n){var e=()=>super.getVectors,t=this;return e().call(t,j(j({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(n={}){var e=()=>super.listVectors,t=this;return e().call(t,j(j({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(n){var e=()=>super.queryVectors,t=this;return e().call(t,j(j({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(n){var e=()=>super.deleteVectors,t=this;return e().call(t,j(j({},n),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},Sy=class extends cy{constructor(n,e={},t,i){super(n,e,t,i)}from(n){return new hy(this.url,this.headers,n,this.fetch)}get vectors(){return new vy(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new uy(this.url+"/iceberg",this.headers,this.fetch)}};const Iu="2.89.0",Qi=30*1e3,Jo=3,vo=Jo*Qi,xy="http://localhost:9999",Cy="supabase.auth.token",Ry={"X-Client-Info":`gotrue-js/${Iu}`},Qo="X-Supabase-Api-Version",Au={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Ty=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Iy=10*60*1e3;class hs extends Error{constructor(e,t,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=i}}function O(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Ay extends hs{constructor(e,t,i){super(e,t,i),this.name="AuthApiError",this.status=t,this.code=i}}function Oy(n){return O(n)&&n.name==="AuthApiError"}class gi extends hs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Nt extends hs{constructor(e,t,i,s){super(e,i,s),this.name=t,this.status=i}}class Ge extends Nt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ky(n){return O(n)&&n.name==="AuthSessionMissingError"}class zi extends Nt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Bs extends Nt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class zs extends Nt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Py(n){return O(n)&&n.name==="AuthImplicitGrantRedirectError"}class Rh extends Nt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ly extends Nt{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class ea extends Nt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Eo(n){return O(n)&&n.name==="AuthRetryableFetchError"}class Th extends Nt{constructor(e,t,i){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=i}}class ta extends Nt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ih=` 	
\r=`.split(""),My=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Ih.length;e+=1)n[Ih[e].charCodeAt(0)]=-2;for(let e=0;e<ar.length;e+=1)n[ar[e].charCodeAt(0)]=e;return n})();function Ah(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(ar[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(ar[i]),e.queuedBits-=6}}function Ou(n,e,t){const i=My[n];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Oh(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},i={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},r=o=>{Ny(o,i,t)};for(let o=0;o<n.length;o+=1)Ou(n.charCodeAt(o),s,r);return e.join("")}function Dy(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Fy(n,e){for(let t=0;t<n.length;t+=1){let i=n.charCodeAt(t);if(i>55295&&i<=56319){const s=(i-55296)*1024&65535;i=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Dy(i,e)}}function Ny(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let i=1;i<6;i+=1)if((n>>7-i&1)===0){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function hn(n){const e=[],t={queue:0,queuedBits:0},i=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)Ou(n.charCodeAt(s),t,i);return new Uint8Array(e)}function jy(n){const e=[];return Fy(n,t=>e.push(t)),new Uint8Array(e)}function wi(n){const e=[],t={queue:0,queuedBits:0},i=s=>{e.push(s)};return n.forEach(s=>Ah(s,t,i)),Ah(null,t,i),e.join("")}function Gy(n){return Math.round(Date.now()/1e3)+n}function Uy(){return Symbol("auth-callback")}const ve=()=>typeof window<"u"&&typeof document<"u",ai={tested:!1,writable:!1},ku=()=>{if(!ve())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ai.tested)return ai.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ai.tested=!0,ai.writable=!0}catch{ai.tested=!0,ai.writable=!1}return ai.writable};function $y(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,r)=>{e[r]=s})}catch{}return t.searchParams.forEach((i,s)=>{e[s]=i}),e}const Pu=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),By=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",en=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},li=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},we=async(n,e)=>{await n.removeItem(e)};class Dr{constructor(){this.promise=new Dr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Dr.promiseConstructor=Promise;function bo(n){const e=n.split(".");if(e.length!==3)throw new ta("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!Ty.test(e[i]))throw new ta("JWT not in base64url format");return{header:JSON.parse(Oh(e[0])),payload:JSON.parse(Oh(e[1])),signature:hn(e[2]),raw:{header:e[0],payload:e[1]}}}async function zy(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Wy(n,e){return new Promise((i,s)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await n(r);if(!e(r,null,o)){i(o);return}}catch(o){if(!e(r,o)){s(o);return}}})()})}function Ky(n){return("0"+n.toString(16)).substr(-2)}function Vy(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=t.length;let s="";for(let r=0;r<56;r++)s+=t.charAt(Math.floor(Math.random()*i));return s}return crypto.getRandomValues(e),Array.from(e,Ky).join("")}async function Xy(n){const t=new TextEncoder().encode(n),i=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(i);return Array.from(s).map(r=>String.fromCharCode(r)).join("")}async function Yy(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Xy(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Wi(n,e,t=!1){const i=Vy();let s=i;t&&(s+="/PASSWORD_RECOVERY"),await en(n,`${e}-code-verifier`,s);const r=await Yy(i);return[r,i===r?"plain":"s256"]}const qy=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Hy(n){const e=n.headers.get(Qo);if(!e||!e.match(qy))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Zy(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Jy(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Qy=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ki(n){if(!Qy.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function So(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const i=t.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function e0(n,e){return new Proxy(n,{get:(t,i,s)=>{if(i==="__isInsecureUserWarningProxy")return!0;if(typeof i=="symbol"){const r=i.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)"||r==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,i,s)}return!e.value&&typeof i=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,i,s)}})}function kh(n){return JSON.parse(JSON.stringify(n))}const ci=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),t0=[502,503,504];async function Ph(n){var e;if(!By(n))throw new ea(ci(n),0);if(t0.includes(n.status))throw new ea(ci(n),n.status);let t;try{t=await n.json()}catch(r){throw new gi(ci(r),r)}let i;const s=Hy(n);if(s&&s.getTime()>=Au["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?i=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(i=t.error_code),i){if(i==="weak_password")throw new Th(ci(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new Ge}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new Th(ci(t),n.status,t.weak_password.reasons);throw new Ay(ci(t),n.status||500,i)}const i0=(n,e,t,i)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(i),Object.assign(Object.assign({},s),t))};async function N(n,e,t,i){var s;const r=Object.assign({},i?.headers);r[Qo]||(r[Qo]=Au["2024-01-01"].name),i?.jwt&&(r.Authorization=`Bearer ${i.jwt}`);const o=(s=i?.query)!==null&&s!==void 0?s:{};i?.redirectTo&&(o.redirect_to=i.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await n0(n,e,t+a,{headers:r,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(l):{data:Object.assign({},l),error:null}}async function n0(n,e,t,i,s,r){const o=i0(e,i,s,r);let a;try{a=await n(t,Object.assign({},o))}catch(l){throw console.error(l),new ea(ci(l),0)}if(a.ok||await Ph(a),i?.noResolveJson)return a;try{return await a.json()}catch(l){await Ph(l)}}function it(n){var e;let t=null;o0(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Gy(n.expires_in)));const i=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:i},error:null}}function Lh(n){const e=it(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,i)=>t&&typeof i=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Vt(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function s0(n){return{data:n,error:null}}function r0(n){const{action_link:e,email_otp:t,hashed_token:i,redirect_to:s,verification_type:r}=n,o=Lr(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:i,redirect_to:s,verification_type:r},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Mh(n){return n}function o0(n){return n.access_token&&n.refresh_token&&n.expires_in}const xo=["global","local","others"];class a0{constructor({url:e="",headers:t={},fetch:i}){this.url=e,this.headers=t,this.fetch=Pu(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=xo[0]){if(xo.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${xo.join(", ")}`);try{return await N(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(O(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,t={}){try{return await N(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Vt})}catch(i){if(O(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:t}=e,i=Lr(e,["options"]),s=Object.assign(Object.assign({},i),t);return"newEmail"in i&&(s.new_email=i?.newEmail,delete s.newEmail),await N(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:r0,redirectTo:t?.redirectTo})}catch(t){if(O(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await N(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Vt})}catch(t){if(O(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,i,s,r,o,a,l;try{const h={nextPage:null,lastPage:0,total:0},c=await N(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(r=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:""},xform:Mh});if(c.error)throw c.error;const u=await c.json(),d=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const _=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(g.split(";")[1].split("=")[1]);h[`${m}Page`]=_}),h.total=parseInt(d)),{data:Object.assign(Object.assign({},u),h),error:null}}catch(h){if(O(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){Ki(e);try{return await N(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Vt})}catch(t){if(O(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Ki(e);try{return await N(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Vt})}catch(i){if(O(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,t=!1){Ki(e);try{return await N(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Vt})}catch(i){if(O(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){Ki(e.userId);try{const{data:t,error:i}=await N(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:i}}catch(t){if(O(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Ki(e.userId),Ki(e.id);try{return{data:await N(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,i,s,r,o,a,l;try{const h={nextPage:null,lastPage:0,total:0},c=await N(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(r=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:""},xform:Mh});if(c.error)throw c.error;const u=await c.json(),d=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const _=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(g.split(";")[1].split("=")[1]);h[`${m}Page`]=_}),h.total=parseInt(d)),{data:Object.assign(Object.assign({},u),h),error:null}}catch(h){if(O(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await N(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(O(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await N(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(O(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await N(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(O(i))return{data:null,error:i};throw i}}async _deleteOAuthClient(e){try{return await N(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await N(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(O(t))return{data:null,error:t};throw t}}}function Dh(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}const Vi={debug:!!(globalThis&&ku()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Lu extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class l0 extends Lu{}async function h0(n,e,t){Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async s=>{if(s){Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new l0(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Vi.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function c0(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Mu(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function u0(n){return parseInt(n,16)}function d0(n){const e=new TextEncoder().encode(n);return"0x"+Array.from(e,i=>i.toString(16).padStart(2,"0")).join("")}function f0(n){var e;const{chainId:t,domain:i,expirationTime:s,issuedAt:r=new Date,nonce:o,notBefore:a,requestId:l,resources:h,scheme:c,uri:u,version:d}=n;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((e=n.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const f=Mu(n.address),g=c?`${c}://${i}`:i,_=n.statement?`${n.statement}
`:"",m=`${g} wants you to sign in with your Ethereum account:
${f}

${_}`;let p=`URI: ${u}
Version: ${d}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${r.toISOString()}`;if(s&&(p+=`
Expiration Time: ${s.toISOString()}`),a&&(p+=`
Not Before: ${a.toISOString()}`),l&&(p+=`
Request ID: ${l}`),h){let y=`
Resources:`;for(const v of h){if(!v||typeof v!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${v}`);y+=`
- ${v}`}p+=y}return`${m}
${p}`}class de extends Error{constructor({message:e,code:t,cause:i,name:s}){var r;super(e,{cause:i}),this.__isWebAuthnError=!0,this.name=(r=s??(i instanceof Error?i.name:void 0))!==null&&r!==void 0?r:"Unknown Error",this.code=t}}class lr extends de{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function g0({error:n,options:e}){var t,i,s;const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new de({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((t=r.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new de({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(e.mediation==="conditional"&&((i=r.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new de({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((s=r.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new de({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new de({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new de({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return r.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new de({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new de({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const o=window.location.hostname;if(Du(o)){if(r.rp.id!==o)return new de({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new de({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new de({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new de({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new de({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function _0({error:n,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new de({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new de({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const i=window.location.hostname;if(Du(i)){if(t.rpId!==i)return new de({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new de({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new de({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new de({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class m0{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const p0=new m0;function y0(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:e,user:t,excludeCredentials:i}=n,s=Lr(n,["challenge","user","excludeCredentials"]),r=hn(e).buffer,o=Object.assign(Object.assign({},t),{id:hn(t.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:r,user:o});if(i&&i.length>0){a.excludeCredentials=new Array(i.length);for(let l=0;l<i.length;l++){const h=i[l];a.excludeCredentials[l]=Object.assign(Object.assign({},h),{id:hn(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return a}function w0(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:e,allowCredentials:t}=n,i=Lr(n,["challenge","allowCredentials"]),s=hn(e).buffer,r=Object.assign(Object.assign({},i),{challenge:s});if(t&&t.length>0){r.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const a=t[o];r.allowCredentials[o]=Object.assign(Object.assign({},a),{id:hn(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return r}function v0(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n;return{id:n.id,rawId:n.id,response:{attestationObject:wi(new Uint8Array(n.response.attestationObject)),clientDataJSON:wi(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function E0(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n,i=n.getClientExtensionResults(),s=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:wi(new Uint8Array(s.authenticatorData)),clientDataJSON:wi(new Uint8Array(s.clientDataJSON)),signature:wi(new Uint8Array(s.signature)),userHandle:s.userHandle?wi(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Du(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function Fh(){var n,e;return!!(ve()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function b0(n){try{const e=await navigator.credentials.create(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new lr("Browser returned unexpected credential type",e)}:{data:null,error:new lr("Empty credential response",e)}}catch(e){return{data:null,error:g0({error:e,options:n})}}}async function S0(n){try{const e=await navigator.credentials.get(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new lr("Browser returned unexpected credential type",e)}:{data:null,error:new lr("Empty credential response",e)}}catch(e){return{data:null,error:_0({error:e,options:n})}}}const x0={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},C0={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function hr(...n){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),t=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),i={};for(const s of n)if(s)for(const r in s){const o=s[r];if(o!==void 0)if(Array.isArray(o))i[r]=o;else if(t(o))i[r]=o;else if(e(o)){const a=i[r];e(a)?i[r]=hr(a,o):i[r]=hr(o)}else i[r]=o}return i}function R0(n,e){return hr(x0,n,e||{})}function T0(n,e){return hr(C0,n,e||{})}class I0{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:i,signal:s},r){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:a};const l=s??p0.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:h}=o.webauthn.credential_options.publicKey;h.name||(h.name=`${h.id}:${i}`),h.displayName||(h.displayName=h.name)}switch(o.webauthn.type){case"create":{const h=R0(o.webauthn.credential_options.publicKey,r?.create),{data:c,error:u}=await b0({publicKey:h,signal:l});return c?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:c}},error:null}:{data:null,error:u}}case"request":{const h=T0(o.webauthn.credential_options.publicKey,r?.request),{data:c,error:u}=await S0(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:h,signal:l}));return c?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:c}},error:null}:{data:null,error:u}}}}catch(o){return O(o)?{data:null,error:o}:{data:null,error:new gi("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:i}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:i})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},r){if(!t)return{data:null,error:new hs("rpId is required for WebAuthn authentication")};try{if(!Fh())return{data:null,error:new gi("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:i},signal:s},{request:r});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:i,credential_response:l.credential_response}})}catch(o){return O(o)?{data:null,error:o}:{data:null,error:new gi("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},r){if(!t)return{data:null,error:new hs("rpId is required for WebAuthn registration")};try{if(!Fh())return{data:null,error:new gi("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(c=>{var u;return(u=c.data)===null||u===void 0?void 0:u.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===e&&d.status!=="unverified")}).then(c=>c?this.client.mfa.unenroll({factorId:c?.id}):void 0),{data:null,error:a};const{data:l,error:h}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:i},signal:s},{create:r});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:i,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:h}}catch(o){return O(o)?{data:null,error:o}:{data:null,error:new gi("Unexpected error in register",o)}}}}c0();const A0={url:xy,storageKey:Cy,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ry,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Nh(n,e,t){return await t()}const Xi={};class cs{get jwks(){var e,t;return(t=(e=Xi[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Xi[this.storageKey]=Object.assign(Object.assign({},Xi[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Xi[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Xi[this.storageKey]=Object.assign(Object.assign({},Xi[this.storageKey]),{cachedAt:e})}constructor(e){var t,i,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const r=Object.assign(Object.assign({},A0),e);if(this.storageKey=r.storageKey,this.instanceID=(t=cs.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,cs.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.instanceID>0&&ve()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=r.persistSession,this.autoRefreshToken=r.autoRefreshToken,this.admin=new a0({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Pu(r.fetch),this.lock=r.lock||Nh,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,this.throwOnError=r.throwOnError,r.lock?this.lock=r.lock:this.persistSession&&ve()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=h0:this.lock=Nh,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new I0(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:ku()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Dh(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Dh(this.memoryStorage)),ve()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Iu}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},i="none";if(ve()&&(t=$y(window.location.href),this._isImplicitGrantCallback(t)?i="implicit":await this._isPKCECallback(t)&&(i="pkce")),ve()&&this.detectSessionInUrl&&i!=="none"){const{data:s,error:r}=await this._getSessionFromURL(t,i);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),Py(r)){const l=(e=r.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:r}}return await this._removeSession(),{error:r}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return O(t)?this._returnResult({error:t}):this._returnResult({error:new gi("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,i,s;try{const r=await N(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:it}),{data:o,error:a}=r;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:h,session:l},error:null})}catch(r){if(O(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signUp(e){var t,i,s;try{let r;if("email"in e){const{email:c,password:u,options:d}=e;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await Wi(this.storage,this.storageKey)),r=await N(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:c,password:u,data:(t=d?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:g},xform:it})}else if("phone"in e){const{phone:c,password:u,options:d}=e;r=await N(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:u,data:(i=d?.data)!==null&&i!==void 0?i:{},channel:(s=d?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:it})}else throw new Bs("You must provide either an email or phone number and a password");const{data:o,error:a}=r;if(a||!o)return await we(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:h,session:l},error:null})}catch(r){if(await we(this.storage,`${this.storageKey}-code-verifier`),O(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:o,options:a}=e;t=await N(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Lh})}else if("phone"in e){const{phone:r,password:o,options:a}=e;t=await N(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Lh})}else throw new Bs("You must provide either an email or phone number and a password");const{data:i,error:s}=t;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!i||!i.session||!i.user){const r=new zi;return this._returnResult({data:{user:null,session:null},error:r})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:s})}catch(t){if(O(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,i,s,r;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(r=e.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,i,s,r,o,a,l,h,c,u,d;let f,g;if("message"in e)f=e.message,g=e.signature;else{const{chain:_,wallet:m,statement:p,options:y}=e;let v;if(ve())if(typeof m=="object")v=m;else{const R=window;if("ethereum"in R&&typeof R.ethereum=="object"&&"request"in R.ethereum&&typeof R.ethereum.request=="function")v=R.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!y?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=m}const w=new URL((t=y?.url)!==null&&t!==void 0?t:window.location.href),E=await v.request({method:"eth_requestAccounts"}).then(R=>R).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!E||E.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const b=Mu(E[0]);let x=(i=y?.signInWithEthereum)===null||i===void 0?void 0:i.chainId;if(!x){const R=await v.request({method:"eth_chainId"});x=u0(R)}const C={domain:w.host,address:b,statement:p,uri:w.href,version:"1",chainId:x,nonce:(s=y?.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(r=y?.signInWithEthereum)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=y?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=y?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(h=y?.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(c=y?.signInWithEthereum)===null||c===void 0?void 0:c.resources};f=f0(C),g=await v.request({method:"personal_sign",params:[d0(f),b]})}try{const{data:_,error:m}=await N(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:g},!((u=e.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(d=e.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:it});if(m)throw m;if(!_||!_.session||!_.user){const p=new zi;return this._returnResult({data:{user:null,session:null},error:p})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign({},_),error:m})}catch(_){if(O(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithSolana(e){var t,i,s,r,o,a,l,h,c,u,d,f;let g,_;if("message"in e)g=e.message,_=e.signature;else{const{chain:m,wallet:p,statement:y,options:v}=e;let w;if(ve())if(typeof p=="object")w=p;else{const b=window;if("solana"in b&&typeof b.solana=="object"&&("signIn"in b.solana&&typeof b.solana.signIn=="function"||"signMessage"in b.solana&&typeof b.solana.signMessage=="function"))w=b.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof p!="object"||!v?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=p}const E=new URL((t=v?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in w&&w.signIn){const b=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},v?.signInWithSolana),{version:"1",domain:E.host,uri:E.href}),y?{statement:y}:null));let x;if(Array.isArray(b)&&b[0]&&typeof b[0]=="object")x=b[0];else if(b&&typeof b=="object"&&"signedMessage"in b&&"signature"in b)x=b;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in x&&"signature"in x&&(typeof x.signedMessage=="string"||x.signedMessage instanceof Uint8Array)&&x.signature instanceof Uint8Array)g=typeof x.signedMessage=="string"?x.signedMessage:new TextDecoder().decode(x.signedMessage),_=x.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${E.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1",`URI: ${E.href}`,`Issued At: ${(s=(i=v?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((r=v?.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${v.signInWithSolana.notBefore}`]:[],...!((o=v?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${v.signInWithSolana.expirationTime}`]:[],...!((a=v?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${v.signInWithSolana.chainId}`]:[],...!((l=v?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${v.signInWithSolana.nonce}`]:[],...!((h=v?.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${v.signInWithSolana.requestId}`]:[],...!((u=(c=v?.signInWithSolana)===null||c===void 0?void 0:c.resources)===null||u===void 0)&&u.length?["Resources",...v.signInWithSolana.resources.map(x=>`- ${x}`)]:[]].join(`
`);const b=await w.signMessage(new TextEncoder().encode(g),"utf8");if(!b||!(b instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");_=b}}try{const{data:m,error:p}=await N(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:wi(_)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:it});if(p)throw p;if(!m||!m.session||!m.user){const y=new zi;return this._returnResult({data:{user:null,session:null},error:y})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:p})}catch(m){if(O(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(e){const t=await li(this.storage,`${this.storageKey}-code-verifier`),[i,s]=(t??"").split("/");try{if(!i&&this.flowType==="pkce")throw new Ly;const{data:r,error:o}=await N(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:it});if(await we(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!r||!r.session||!r.user){const a=new zi;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign(Object.assign({},r),{redirectType:s??null}),error:o})}catch(r){if(await we(this.storage,`${this.storageKey}-code-verifier`),O(r))return this._returnResult({data:{user:null,session:null,redirectType:null},error:r});throw r}}async signInWithIdToken(e){try{const{options:t,provider:i,token:s,access_token:r,nonce:o}=e,a=await N(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:s,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:it}),{data:l,error:h}=a;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!l||!l.session||!l.user){const c=new zi;return this._returnResult({data:{user:null,session:null},error:c})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:h})}catch(t){if(O(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,i,s,r,o;try{if("email"in e){const{email:a,options:l}=e;let h=null,c=null;this.flowType==="pkce"&&([h,c]=await Wi(this.storage,this.storageKey));const{error:u}=await N(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:h,code_challenge_method:c},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}if("phone"in e){const{phone:a,options:l}=e,{data:h,error:c}=await N(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l?.data)!==null&&s!==void 0?s:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h?.message_id},error:c})}throw new Bs("You must provide either an email or phone number.")}catch(a){if(await we(this.storage,`${this.storageKey}-code-verifier`),O(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,i;try{let s,r;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,r=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:o,error:a}=await N(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:s,xform:it});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,h=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:h,session:l},error:null})}catch(s){if(O(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var t,i,s,r,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Wi(this.storage,this.storageKey));const h=await N(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&i!==void 0?i:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:s0});return!((r=h.data)===null||r===void 0)&&r.url&&ve()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(a){if(await we(this.storage,`${this.storageKey}-code-verifier`),O(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:i}=e;if(i)throw i;if(!t)throw new Ge;const{error:s}=await N(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(O(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:i,type:s,options:r}=e,{error:o}=await N(this.fetch,"POST",t,{headers:this.headers,body:{email:i,type:s,gotrue_meta_security:{captcha_token:r?.captchaToken}},redirectTo:r?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:i,type:s,options:r}=e,{data:o,error:a}=await N(this.fetch,"POST",t,{headers:this.headers,body:{phone:i,type:s,gotrue_meta_security:{captcha_token:r?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:a})}throw new Bs("You must provide either an email or phone number and a type")}catch(t){if(O(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await i,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=t();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await li(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<vo:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){const o=await li(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=So()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=e0(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?this._returnResult({data:{session:null},error:r}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(-1,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await N(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Vt}):await this._useSession(async t=>{var i,s,r;const{data:o,error:a}=t;if(a)throw a;return!(!((i=o.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ge}:await N(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0,xform:Vt})})}catch(t){if(O(t))return ky(t)&&(await this._removeSession(),await we(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async i=>{const{data:s,error:r}=i;if(r)throw r;if(!s.session)throw new Ge;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Wi(this.storage,this.storageKey));const{data:h,error:c}=await N(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Vt});if(c)throw c;return o.user=h.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(i){if(await we(this.storage,`${this.storageKey}-code-verifier`),O(i))return this._returnResult({data:{user:null},error:i});throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ge;const t=Date.now()/1e3;let i=t,s=!0,r=null;const{payload:o}=bo(e.access_token);if(o.exp&&(i=o.exp,s=i<=t),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};r=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;r={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:i-t,expires_at:i},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return this._returnResult({data:{user:r.user,session:r},error:null})}catch(t){if(O(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var i;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(i=o.session)!==null&&i!==void 0?i:void 0}if(!e?.refresh_token)throw new Ge;const{data:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?this._returnResult({data:{user:null,session:null},error:r}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(O(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!ve())throw new zs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new zs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Rh("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new zs("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Rh("No code detected.");const{data:y,error:v}=await this._exchangeCodeForSession(e.code);if(v)throw v;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:s,access_token:r,refresh_token:o,expires_in:a,expires_at:l,token_type:h}=e;if(!r||!a||!o||!h)throw new zs("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(a);let d=c+u;l&&(d=parseInt(l));const f=d-c;f*1e3<=Qi&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const g=d-u;c-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,d,c):c-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,d,c);const{data:_,error:m}=await this._getUser(r);if(m)throw m;const p={provider_token:i,provider_refresh_token:s,access_token:r,expires_in:u,expires_at:d,refresh_token:o,token_type:h,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:p,redirectType:e.type},error:null})}catch(i){if(O(i))return this._returnResult({data:{session:null,redirectType:null},error:i});throw i}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await li(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var i;const{data:s,error:r}=t;if(r)return this._returnResult({error:r});const o=(i=s.session)===null||i===void 0?void 0:i.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Oy(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await we(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Uy(),i={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async t=>{var i,s;try{const{data:{session:r},error:o}=t;if(o)throw o;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(r){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e,t={}){let i=null,s=null;this.flowType==="pkce"&&([i,s]=await Wi(this.storage,this.storageKey,!0));try{return await N(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(await we(this.storage,`${this.storageKey}-code-verifier`),O(r))return this._returnResult({data:null,error:r});throw r}}async getUserIdentities(){var e;try{const{data:t,error:i}=await this.getUser();if(i)throw i;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(O(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:i,error:s}=await this._useSession(async r=>{var o,a,l,h,c;const{data:u,error:d}=r;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await N(this.fetch,"GET",f,{headers:this.headers,jwt:(c=(h=u.session)===null||h===void 0?void 0:h.access_token)!==null&&c!==void 0?c:void 0})});if(s)throw s;return ve()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(i?.url),this._returnResult({data:{provider:e.provider,url:i?.url},error:null})}catch(i){if(O(i))return this._returnResult({data:{provider:e.provider,url:null},error:i});throw i}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var i;try{const{error:s,data:{session:r}}=t;if(s)throw s;const{options:o,provider:a,token:l,access_token:h,nonce:c}=e,u=await N(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(i=r?.access_token)!==null&&i!==void 0?i:void 0,body:{provider:a,id_token:l,access_token:h,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:it}),{data:d,error:f}=u;return f?this._returnResult({data:{user:null,session:null},error:f}):!d||!d.session||!d.user?this._returnResult({data:{user:null,session:null},error:new zi}):(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:f}))}catch(s){if(await we(this.storage,`${this.storageKey}-code-verifier`),O(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var i,s;const{data:r,error:o}=t;if(o)throw o;return await N(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(i=r.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(O(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await Wy(async s=>(s>0&&await zy(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await N(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:it})),(s,r)=>{const o=200*Math.pow(2,s);return r&&Eo(r)&&Date.now()+o-i<Qi})}catch(i){if(this._debug(t,"error",i),O(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",i),ve()&&!t.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,t;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const s=await li(this.storage,this.storageKey);if(s&&this.userStorage){let o=await li(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await en(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o?.user)!==null&&e!==void 0?e:So()}else if(s&&!s.user&&!s.user){const o=await li(this.storage,this.storageKey+"-user");o&&o?.user?(s.user=o.user,await we(this.storage,this.storageKey+"-user"),await en(this.storage,this.storageKey,s)):s.user=So()}if(this._debug(i,"session from storage",s),!this._isValidSession(s)){this._debug(i,"session is not valid"),s!==null&&await this._removeSession();return}const r=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<vo;if(this._debug(i,`session has${r?"":" not"} expired with margin of ${vo}s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),Eo(o)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&o?.user?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(i,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(i,"error",s),console.error(s);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var t,i;if(!e)throw new Ge;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Dr;const{data:r,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!r.session)throw new Ge;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const a={data:r.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(s,"error",r),O(r)){const o={data:null,error:r};return Eo(r)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(r),r}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,i=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){r.push(l)}});if(await Promise.all(o),r.length>0){for(let a=0;a<r.length;a+=1)console.error(r[a]);throw r[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await we(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),i=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&t.user&&await en(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const r=kh(s);await en(this.storage,this.storageKey,r)}else{const s=kh(t);await en(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await we(this.storage,this.storageKey),await we(this.storage,this.storageKey+"-code-verifier"),await we(this.storage,this.storageKey+"-user"),this.userStorage&&await we(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ve()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Qi);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((i.expires_at*1e3-e)/Qi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Qi}ms, refresh threshold is ${Jo} ticks`),s<=Jo&&await this._callRefreshToken(i.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Lu)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ve()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,i){const s=[`provider=${encodeURIComponent(t)}`];if(i?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&s.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[r,o]=await Wi(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(i?.queryParams){const r=new URLSearchParams(i.queryParams);s.push(r.toString())}return i?.skipBrowserRedirect&&s.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var i;const{data:s,error:r}=t;return r?this._returnResult({data:null,error:r}):await N(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=s?.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(O(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var i,s;const{data:r,error:o}=t;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:h}=await N(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(i=r?.session)===null||i===void 0?void 0:i.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l?.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(t){if(O(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:s,error:r}=t;if(r)return this._returnResult({data:null,error:r});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?v0(e.webauthn.credential_response):E0(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await N(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(i=s?.session)===null||i===void 0?void 0:i.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(t){if(O(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:s,error:r}=t;if(r)return this._returnResult({data:null,error:r});const o=await N(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(i=s?.session)===null||i===void 0?void 0:i.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:y0(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:w0(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(O(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:i}=await this._challenge({factorId:e.factorId});return i?this._returnResult({data:null,error:i}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:i}=await this.getUser();if(i)return{data:null,error:i};const s={all:[],phone:[],totp:[],webauthn:[]};for(const r of(e=t?.factors)!==null&&e!==void 0?e:[])s.all.push(r),r.status==="verified"&&s[r.factor_type].push(r);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:i},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:r}=bo(i.access_token);let o=null;r.aal&&(o=r.aal);let a=o;((t=(e=i.user.factors)===null||e===void 0?void 0:e.filter(c=>c.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const h=r.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:i},error:s}=t;return s?this._returnResult({data:null,error:s}):i?await N(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:i.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new Ge})})}catch(t){if(O(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async i=>{const{data:{session:s},error:r}=i;if(r)return this._returnResult({data:null,error:r});if(!s)return this._returnResult({data:null,error:new Ge});const o=await N(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ve()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(i){if(O(i))return this._returnResult({data:null,error:i});throw i}}async _denyAuthorization(e,t){try{return await this._useSession(async i=>{const{data:{session:s},error:r}=i;if(r)return this._returnResult({data:null,error:r});if(!s)return this._returnResult({data:null,error:new Ge});const o=await N(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&ve()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(i){if(O(i))return this._returnResult({data:null,error:i});throw i}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:i}=e;return i?this._returnResult({data:null,error:i}):t?await N(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Ge})})}catch(e){if(O(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:i},error:s}=t;return s?this._returnResult({data:null,error:s}):i?(await N(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ge})})}catch(t){if(O(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let i=t.keys.find(a=>a.kid===e);if(i)return i;const s=Date.now();if(i=this.jwks.keys.find(a=>a.kid===e),i&&this.jwks_cached_at+Iy>s)return i;const{data:r,error:o}=await N(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=s,i=r.keys.find(a=>a.kid===e),!i)?null:i}async getClaims(e,t={}){try{let i=e;if(!i){const{data:f,error:g}=await this.getSession();if(g||!f.session)return this._returnResult({data:null,error:g});i=f.session.access_token}const{header:s,payload:r,signature:o,raw:{header:a,payload:l}}=bo(i);t?.allowExpired||Zy(r.exp);const h=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!h){const{error:f}=await this.getUser(i);if(f)throw f;return{data:{claims:r,header:s,signature:o},error:null}}const c=Jy(s.alg),u=await crypto.subtle.importKey("jwk",h,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,o,jy(`${a}.${l}`)))throw new ta("Invalid JWT signature");return{data:{claims:r,header:s,signature:o},error:null}}catch(i){if(O(i))return this._returnResult({data:null,error:i});throw i}}}cs.nextInstanceID={};const O0=cs,k0="2.89.0";let Bn="";typeof Deno<"u"?Bn="deno":typeof document<"u"?Bn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Bn="react-native":Bn="node";const P0={"X-Client-Info":`supabase-js-${Bn}/${k0}`},L0={headers:P0},M0={schema:"public"},D0={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},F0={};function us(n){"@babel/helpers - typeof";return us=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},us(n)}function N0(n,e){if(us(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(us(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function j0(n){var e=N0(n,"string");return us(e)=="symbol"?e:e+""}function G0(n,e,t){return(e=j0(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function jh(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function he(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?jh(Object(t),!0).forEach(function(i){G0(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):jh(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}const U0=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),$0=()=>Headers,B0=(n,e,t)=>{const i=U0(t),s=$0();return async(r,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:n;let h=new s(o?.headers);return h.has("apikey")||h.set("apikey",n),h.has("Authorization")||h.set("Authorization",`Bearer ${l}`),i(r,he(he({},o),{},{headers:h}))}};function z0(n){return n.endsWith("/")?n:n+"/"}function W0(n,e){var t,i;const{db:s,auth:r,realtime:o,global:a}=n,{db:l,auth:h,realtime:c,global:u}=e,d={db:he(he({},l),s),auth:he(he({},h),r),realtime:he(he({},c),o),storage:{},global:he(he(he({},u),a),{},{headers:he(he({},(t=u?.headers)!==null&&t!==void 0?t:{}),(i=a?.headers)!==null&&i!==void 0?i:{})}),accessToken:async()=>""};return n.accessToken?d.accessToken=n.accessToken:delete d.accessToken,d}function K0(n){const e=n?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(z0(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var V0=class extends O0{constructor(n){super(n)}},X0=class{constructor(n,e,t){var i,s;this.supabaseUrl=n,this.supabaseKey=e;const r=K0(n);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",r),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",r),this.storageUrl=new URL("storage/v1",r),this.functionsUrl=new URL("functions/v1",r);const o=`sb-${r.hostname.split(".")[0]}-auth-token`,a={db:M0,realtime:F0,auth:he(he({},D0),{},{storageKey:o}),global:L0},l=W0(t??{},a);if(this.storageKey=(i=l.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(s=l.global.headers)!==null&&s!==void 0?s:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(c,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}});else{var h;this.auth=this._initSupabaseAuthClient((h=l.auth)!==null&&h!==void 0?h:{},this.headers,l.global.fetch)}this.fetch=B0(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(he({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(c=>this.realtime.setAuth(c)).catch(c=>console.warn("Failed to set initial Realtime auth token:",c)),this.rest=new Rp(new URL("rest/v1",r).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new Sy(this.storageUrl.href,this.headers,this.fetch,t?.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Ep(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,e,t)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,e,t;if(n.accessToken)return await n.accessToken();const{data:i}=await n.auth.getSession();return(e=(t=i.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:t,storage:i,userStorage:s,storageKey:r,flowType:o,lock:a,debug:l,throwOnError:h},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new V0({url:this.authUrl.href,headers:he(he({},d),c),storageKey:r,autoRefreshToken:n,persistSession:e,detectSessionInUrl:t,storage:i,userStorage:s,flowType:o,lock:a,debug:l,throwOnError:h,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new zp(this.realtimeUrl.href,he(he({},n),{},{params:he(he({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,e)=>{this._handleTokenChanged(n,"CLIENT",e?.access_token)})}_handleTokenChanged(n,e,t){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Y0=(n,e,t)=>new X0(n,e,t);function q0(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}q0()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const H0="https://mekbftnxhxuwxkdclrkq.supabase.co",Z0="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1la2JmdG54aHh1d3hrZGNscmtxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0NTUzMjUsImV4cCI6MjA4MjAzMTMyNX0.9k4GZLLJQ5Y06Q5NAAhiegmCBZDZs0LhlhNo5ovEsRE",J0=Y0(H0,Z0),Q0=document.getElementById("popup"),ew=document.getElementById("popup-content"),Gh=document.getElementById("popup-closer"),Fr=new mm({element:Q0,autoPan:{animation:{duration:250}}}),tw=new ip({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),Fu=new xn({source:new Zm,visible:!1,title:"OSM Standard"}),Nu=new xn({source:new Cn({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attributions:"Tiles  Esri"}),visible:!0,title:"Satellite"}),ju=new xn({source:new Cn({url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",attributions:"Tiles  Esri"}),visible:!1,title:"Topo Map"}),Gu=new xn({source:new Cn({url:"https://{a-c}.tile.opentopomap.org/{z}/{x}/{y}.png",attributions:" OpenTopoMap"}),visible:!1,title:"OpenTopoMap"}),Uu=new xn({source:new Cn({url:"https://{a-d}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attributions:" CARTO"}),visible:!1,title:"Dark Mode"}),$u=new xn({source:new Cn({url:"https://{a-d}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",attributions:" CARTO"}),visible:!1,title:"Voyager"}),Uh=[{layer:Nu,name:"Satellite",icon:""},{layer:Gu,name:"Topo Map",icon:""},{layer:ju,name:"Esri Topo",icon:""},{layer:Fu,name:"OSM",icon:""},{layer:$u,name:"Voyager",icon:""},{layer:Uu,name:"Dark",icon:""}],Lt=new Da;async function iw(){try{const{data:n,error:e}=await J0.from("BankSampah").select("*");if(e){console.error(" Error ambil data:",e.message);return}console.log(" Data Raw dari Supabase:",n);const t=n.map(i=>{const s=parseFloat(i.latitude),r=parseFloat(i.longitude);return isNaN(r)||isNaN(s)?null:new vn({geometry:new Si(fn([r,s])),Nama:i.Nama||i.nama_bank_sampah,Kecamatan:i.Kecamatan,Kertas:parseInt(i.Kertas||0),Plastik:parseInt(i.Plastik||0),Besi:parseInt(i.Besi||0),Kaca:parseInt(i.Kaca||0),Logam:parseInt(i.Logam||0),Volume_Sampah_kg_per_minggu:parseFloat(i["Volume Sampah (per minggu/kg)"]||i.volume||0),Jumlah_Anggota:parseInt(i.Jumlah_Anggota||0)})}).filter(i=>i!==null);Lt.clear(),Lt.addFeatures(t),qu(),nw(),console.log(` Berhasil plot ${t.length} titik dengan koordinat BENAR.`),cw()}catch(n){console.error("Error loading:",n)}}function nw(){let n=0;Lt.getFeatures().forEach(i=>{const s=parseFloat(i.get("Volume_Sampah_kg_per_minggu"))||0;s>n&&(n=s)});const t=document.getElementById("volume-slider");t&&(t.max=Math.ceil(n),t.value=Math.ceil(n),sl=Math.ceil(n),document.getElementById("volume-value").textContent=`0 - ${Math.ceil(n).toLocaleString()} kg`)}const Bu=new bn({source:new Da({format:tw,url:"data/polygon_riau.json"}),style:new We({fill:new lt({color:"rgba(45, 122, 62, 0.15)"}),stroke:new Dt({color:"#2d7a3e",width:2.5,lineDash:[5,5]})})}),zu={1:"#e74c3c",2:"#e67e22",3:"#f1c40f",4:"#27ae60",5:"#1abc9c"};function Wu(n){let e=0;return n.get("Kertas")===1&&e++,n.get("Plastik")===1&&e++,n.get("Besi")===1&&e++,n.get("Kaca")===1&&e++,n.get("Logam")===1&&e++,e}function sw(n){return{1:"Sangat Terbatas",2:"Terbatas",3:"Sedang",4:"Lengkap",5:"Sangat Lengkap"}[n]||"N/A"}let ui={Kertas:!0,Plastik:!0,Besi:!0,Kaca:!0,Logam:!0};const yn=new bn({source:Lt,visible:!1,style:n=>{if(!n.get("Nama"))return null;let t=!1;if(ui.Kertas&&n.get("Kertas")===1&&(t=!0),ui.Plastik&&n.get("Plastik")===1&&(t=!0),ui.Besi&&n.get("Besi")===1&&(t=!0),ui.Kaca&&n.get("Kaca")===1&&(t=!0),ui.Logam&&n.get("Logam")===1&&(t=!0),Object.values(ui).some(o=>o)&&!t)return null;const s=Wu(n),r=zu[s]||"#999";return new We({image:new Ai({radius:14,fill:new lt({color:r}),stroke:new Dt({color:"#fff",width:2.5})}),text:new Ar({text:s.toString(),font:"bold 11px Arial",fill:new lt({color:"#fff"}),offsetY:1})})}});function rw(){yn.changed()}function Ku(n){const e=parseFloat(n.get("Volume_Sampah_kg_per_minggu"))||0,t=parseInt(n.get("Jumlah_Anggota"))||1;return e/t}function Vu(n){return n<50?{label:"Rendah",color:"#e74c3c"}:n<100?{label:"Sedang",color:"#f39c12"}:n<200?{label:"Tinggi",color:"#27ae60"}:{label:"Sangat Tinggi",color:"#9b59b6"}}let ow=0,sl=1e4;const wn=new bn({source:Lt,visible:!1,style:n=>{if(!n.get("Nama"))return null;const t=parseFloat(n.get("Volume_Sampah_kg_per_minggu"))||0;if(t<ow||t>sl)return null;const i=Ku(n),s=Vu(i),r=Math.log10(i+1),o=Math.max(10,Math.min(30,10+r*6));return new We({image:new Ai({radius:o,fill:new lt({color:s.color}),stroke:new Dt({color:"#fff",width:2.5})})})}}),ia=new Da,ds=new bn({source:ia,visible:!1,style:n=>new We({fill:new lt({color:"rgba(52, 152, 219, 0.15)"}),stroke:new Dt({color:"#3498db",width:2,lineDash:[8,4]})})}),cr=new bn({source:Lt,visible:!1,style:n=>n.get("Nama")?new We({image:new Ai({radius:8,fill:new lt({color:"#3498db"}),stroke:new Dt({color:"#fff",width:2})})}):null});let Xu=2;function Yu(n){const t=300+n*Xu;return Math.min(Math.max(t,500),8e3)}function qu(){ia.clear(),Lt.getFeatures().forEach(e=>{const t=e.get("Nama");if(!t)return;const i=e.getGeometry();if(i&&i.getType()==="Point"){const s=i.getCoordinates(),r=parseFloat(e.get("Volume_Sampah_kg_per_minggu"))||0,o=Yu(r),a=new vn({geometry:new Ma(s,o),nama:t,volume:r,radius:o});ia.addFeature(a)}})}const Hu=new bn({source:Lt,visible:!0,style:n=>n.get("Nama")?new We({image:new ws({anchor:[.5,.5],src:"icon/iconaaa.png",scale:.3})}):null}),at=new gm({target:"map",layers:[Fu,Nu,ju,Gu,Uu,$u,Bu,ds,cr,yn,wn,Hu],view:new _t({center:fn([101.42,.5]),zoom:12,minZoom:5,maxZoom:18}),overlays:[Fr]});iw();function aw(){const n=document.getElementById("basemap-switcher");n&&Uh.forEach(e=>{const t=document.createElement("button");t.className=`basemap-btn ${e.layer.getVisible()?"active":""}`,t.innerHTML=`${e.icon} ${e.name}`,t.title=e.name,t.addEventListener("click",()=>{Uh.forEach(i=>i.layer.setVisible(!1)),e.layer.setVisible(!0),document.querySelectorAll(".basemap-btn").forEach(i=>i.classList.remove("active")),t.classList.add("active")}),n.appendChild(t)})}aw();at.on("singleclick",function(n){const e=at.forEachFeatureAtPixel(n.pixel,t=>t);if(!e){Fr.setPosition(void 0);return}Zu(e,n.coordinate)});function Zu(n,e){const t=n.get("Nama")||n.get("nama");if(!t)return;let i="";if(yn.getVisible()){const l=Wu(n);i=`
      <div class="popup-analysis">
        <span class="analysis-badge" style="background: ${zu[l]}">
           Indeks Diversifikasi: ${l}/5
          <br><small>${sw(l)}</small>
        </span>
      </div>`}if(wn.getVisible()){const l=Ku(n),h=Vu(l);i=`
      <div class="popup-analysis">
        <span class="analysis-badge" style="background: ${h.color}">
           Produktivitas: ${l.toFixed(0)} kg/anggota/minggu
          <br><small>${h.label}</small>
        </span>
      </div>`}if(ds.getVisible()){const l=parseFloat(n.get("Volume_Sampah_kg_per_minggu"))||0;i=`
      <div class="popup-analysis">
        <span class="analysis-badge" style="background: #3498db">
           Zona Jangkauan
          <br><small>Radius: ${(Yu(l)/1e3).toFixed(1)} km</small>
        </span>
      </div>`}const s=n.get("Kecamatan")||"N/A",r=n.get("Volume_Sampah_kg_per_minggu")??"0",o=n.get("Jumlah_Anggota")??"0",a=[];n.get("Kertas")===1&&a.push(" Kertas"),n.get("Plastik")===1&&a.push(" Plastik"),n.get("Besi")===1&&a.push(" Besi"),n.get("Kaca")===1&&a.push(" Kaca"),n.get("Logam")===1&&a.push(" Logam"),ew.innerHTML=`
    <div class="popup-content">
      <h3> ${t}</h3>
      ${i}
      <div class="popup-info">
        <p><i class="fas fa-map-marker-alt"></i> <strong>Kecamatan:</strong> ${s}</p>
        <p><i class="fas fa-weight"></i> <strong>Volume Mingguan:</strong> ${parseFloat(r).toLocaleString()} kg</p>
        <p><i class="fas fa-users"></i> <strong>Jumlah Anggota:</strong> ${o} orang</p>
      </div>
      <div class="popup-jenis">
        <strong> Jenis Sampah:</strong><br>
        <span class="jenis-tags">${a.length?a.join("  "):"Tidak ada data"}</span>
      </div>
    </div>
  `,Fr.setPosition(e)}Gh.onclick=function(){return Fr.setPosition(void 0),Gh.blur(),!1};const $h=document.getElementById("polygon"),Bh=document.getElementById("point");$h&&$h.addEventListener("change",function(){Bu.setVisible(this.checked)});Bh&&Bh.addEventListener("change",function(){Hu.setVisible(this.checked)});function rl(){yn.setVisible(!1),wn.setVisible(!1),ds.setVisible(!1),cr.setVisible(!1),document.getElementById("filter-diversifikasi").style.display="none",document.getElementById("filter-produktivitas").style.display="none",document.getElementById("filter-zona").style.display="none",document.querySelectorAll(".analysis-layer").forEach(n=>n.classList.remove("active"))}const zh=document.getElementById("layer-diversifikasi"),Wh=document.getElementById("filter-diversifikasi");zh&&zh.addEventListener("change",function(){this.checked?(rl(),this.checked=!0,yn.setVisible(!0),Wh.style.display="block",document.getElementById("layer1-container").classList.add("active")):(yn.setVisible(!1),Wh.style.display="none",document.getElementById("layer1-container").classList.remove("active"))});["Kertas","Plastik","Besi","Kaca","Logam"].forEach(n=>{const e=document.getElementById(`filter-${n.toLowerCase()}`);e&&e.addEventListener("change",function(){ui[n]=this.checked,rw()})});const Kh=document.getElementById("layer-produktivitas"),Vh=document.getElementById("filter-produktivitas");Kh&&Kh.addEventListener("change",function(){this.checked?(rl(),this.checked=!0,wn.setVisible(!0),Vh.style.display="block",document.getElementById("layer2-container").classList.add("active")):(wn.setVisible(!1),Vh.style.display="none",document.getElementById("layer2-container").classList.remove("active"))});const Xh=document.getElementById("volume-slider");Xh&&Xh.addEventListener("input",function(){sl=parseInt(this.value),document.getElementById("volume-value").textContent=`0 - ${parseInt(this.value).toLocaleString()} kg`,wn.changed()});const Yh=document.getElementById("layer-zona"),qh=document.getElementById("filter-zona");Yh&&Yh.addEventListener("change",function(){this.checked?(rl(),this.checked=!0,ds.setVisible(!0),cr.setVisible(!0),qh.style.display="block",document.getElementById("layer3-container").classList.add("active")):(ds.setVisible(!1),cr.setVisible(!1),qh.style.display="none",document.getElementById("layer3-container").classList.remove("active"))});const Hh=document.getElementById("radius-slider");Hh&&Hh.addEventListener("input",function(){Xu=parseFloat(this.value),document.getElementById("radius-value").textContent=`${this.value} m/kg`,qu()});at.on("pointermove",function(n){const e=at.forEachFeatureAtPixel(n.pixel,t=>t);at.getTargetElement().style.cursor=e?"pointer":""});const Zh=document.getElementById("zoom-in"),Jh=document.getElementById("zoom-out"),Qh=document.getElementById("reset-view");Zh&&Zh.addEventListener("click",()=>at.getView().animate({zoom:at.getView().getZoom()+1,duration:300}));Jh&&Jh.addEventListener("click",()=>at.getView().animate({zoom:at.getView().getZoom()-1,duration:300}));Qh&&Qh.addEventListener("click",()=>at.getView().animate({center:fn([101.42,.5]),zoom:12,duration:500}));function lw(){const n=new URLSearchParams(window.location.search);return{lat:n.get("lat"),lng:n.get("lng"),zoom:n.get("zoom"),name:n.get("name")}}function hw(n,e,t){const i=Lt.getFeatures();let s=null;const r=parseFloat(n),o=parseFloat(e);if(i.forEach(a=>{const l=a.getGeometry();if(l&&l.getType()==="Point"){const h=l.getCoordinates(),[c,u]=fn([o,r]);Math.abs(h[0]-c)<1&&Math.abs(h[1]-u)<1&&(s=a)}}),s){const a=fn([o,r]);Zu(s,a),console.log(` Popup ditampilkan untuk: ${t}`)}else console.warn("Feature tidak ditemukan di koordinat:",n,e)}function cw(){const n=lw();if(n.lat&&n.lng){const e=parseFloat(n.lat),t=parseFloat(n.lng),i=n.zoom?parseInt(n.zoom):18,s=n.name?decodeURIComponent(n.name):null;!isNaN(e)&&!isNaN(t)&&(console.log(` URL Command Detected: Go to ${s} (${e}, ${t})`),at.getView().animate({center:fn([t,e]),zoom:i,duration:1500}),setTimeout(()=>{hw(e,t,s)},1600))}}
