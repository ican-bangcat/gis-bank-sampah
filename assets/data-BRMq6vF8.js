import"./modulepreload-polyfill-B5Qt9EMX.js";import{createClient as S}from"https://esm.sh/@supabase/supabase-js@2";const A="https://mekbftnxhxuwxkdclrkq.supabase.co",j="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1la2JmdG54aHh1d3hrZGNscmtxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0NTUzMjUsImV4cCI6MjA4MjAzMTMyNX0.9k4GZLLJQ5Y06Q5NAAhiegmCBZDZs0LhlhNo5ovEsRE",J=S(A,j);let l=[],o=[],N=1,r=10;const p=document.getElementById("search-box"),i=document.getElementById("kecamatan-filter"),B=document.getElementById("data-tbody"),x=document.getElementById("loading"),_=document.getElementById("table-container"),L=document.getElementById("no-data"),P=document.getElementById("btn-reset"),w=document.getElementById("stat-total"),T=document.getElementById("stat-filtered"),h=document.getElementById("filter-kertas"),f=document.getElementById("filter-plastik"),I=document.getElementById("filter-besi"),k=document.getElementById("filter-kaca"),E=document.getElementById("filter-logam");async function M(){try{const{data:a,error:n}=await J.from("BankSampah").select("*");if(n){console.error("❌ Error loading data:",n.message),K("Gagal memuat data dari server");return}l=a.map(e=>({No:e.No,Nama:e.Nama||e.nama_bank_sampah||"N/A",Kecamatan:e.Kecamatan||"N/A",Kertas:parseInt(e.Kertas||0),Plastik:parseInt(e.Plastik||0),Besi:parseInt(e.Besi||0),Kaca:parseInt(e.Kaca||0),Logam:parseInt(e.Logam||0),Volume_Sampah_kg_per_minggu:parseFloat(e["Volume Sampah (per minggu/kg)"]||e.volume||0),Jumlah_Anggota:parseInt(e["Jumlah Anggota"]||e.Jumlah_Anggota||0),latitude:parseFloat(e.latitude||0),longitude:parseFloat(e.longitude||0)})),o=[...l],console.log(`✅ Loaded ${l.length} records`),$(),g(),y(),x.style.display="none",_.style.display="block"}catch(a){console.error("Error:",a),K("Terjadi kesalahan saat memuat data")}}function $(){const a=new Set;l.forEach(e=>{e.Kecamatan&&e.Kecamatan!=="N/A"&&a.add(e.Kecamatan)});const n=Array.from(a).sort();i.innerHTML='<option value="">Semua Kecamatan</option>',n.forEach(e=>{const c=document.createElement("option");c.value=e,c.textContent=e,i.appendChild(c)})}function g(){if(o.length===0){B.innerHTML="",L.style.display="block",b(0,0,0);return}L.style.display="none";const a=o.length,n=(N-1)*r,e=r===-1?a:Math.min(n+r,a),c=r===-1?o:o.slice(n,e);B.innerHTML=c.map((t,m)=>{const u=n+m+1,s=[];t.Kertas===1&&s.push('<span class="badge-jenis badge-kertas">Kertas</span>'),t.Plastik===1&&s.push('<span class="badge-jenis badge-plastik">Plastik</span>'),t.Besi===1&&s.push('<span class="badge-jenis badge-besi">Besi</span>'),t.Kaca===1&&s.push('<span class="badge-jenis badge-kaca">Kaca</span>'),t.Logam===1&&s.push('<span class="badge-jenis badge-logam">Logam</span>');const C=s.length>0?s.join(" "):'<span class="text-muted">-</span>';return`
        <tr>
          <td>${u}</td>
          <td><strong>${t.Nama}</strong></td>
          <td>${t.Kecamatan}</td>
          <td>${C}</td>
          <td>${t.Volume_Sampah_kg_per_minggu.toLocaleString()}</td>
          <td>${t.Jumlah_Anggota.toLocaleString()}</td>
          <td>
            <a href="map.html?lat=${t.latitude}&lng=${t.longitude}&zoom=18&name=${encodeURIComponent(t.Nama)}" 
               class="btn-map" 
               title="Lihat di peta">
              <i class="fas fa-map-marker-alt"></i> Peta
            </a>
          </td>
        </tr>
      `}).join(""),b(n+1,e,a)}function b(a,n,e){document.getElementById("showing-start").textContent=a,document.getElementById("showing-end").textContent=n,document.getElementById("showing-total").textContent=e}function y(){w.textContent=l.length,T.textContent=o.length}function d(){const a=p.value.toLowerCase().trim(),n=i.value,e={Kertas:h.checked,Plastik:f.checked,Besi:I.checked,Kaca:k.checked,Logam:E.checked},c=Object.values(e).some(t=>t);o=l.filter(t=>{const m=t.Nama.toLowerCase().includes(a),u=!n||t.Kecamatan===n;let s=!0;return c&&(s=e.Kertas&&t.Kertas===1||e.Plastik&&t.Plastik===1||e.Besi&&t.Besi===1||e.Kaca&&t.Kaca===1||e.Logam&&t.Logam===1),m&&u&&s}),g(),y()}function F(){p.value="",i.value="",h.checked=!0,f.checked=!0,I.checked=!0,k.checked=!0,E.checked=!0,o=[...l],g(),y()}function K(a){x.innerHTML=`
    <i class="fas fa-exclamation-triangle fa-3x" style="color: #e74c3c;"></i>
    <p class="mt-3">${a}</p>
  `}p.addEventListener("input",d);i.addEventListener("change",d);h.addEventListener("change",d);f.addEventListener("change",d);I.addEventListener("change",d);k.addEventListener("change",d);E.addEventListener("change",d);P.addEventListener("click",F);const v=document.getElementById("entries-per-page");v&&v.addEventListener("change",function(){r=parseInt(this.value),N=1,g()});M();
